This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  contacts2.csv
  contacts3.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
23jan2026-2.xml
23jan2026-3.xml
23jan2026.xml
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vercel.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts2.csv">
Name,Phone,Company,Email,Profile Summary,Pain Points
Sarah Johnson,+1-555-0101,TechVentures Inc,sarah.j@techventures.com,CEO of a growing SaaS startup focused on enterprise solutions,Manual processes slowing growth; Need better automation; Struggling with team collaboration
Michael Chen,+1-555-0102,Global Logistics Co,mchen@globallogistics.com,Operations Director managing international supply chain,High shipping costs; Inventory management issues; Lack of real-time tracking
Emily Rodriguez,+1-555-0103,Creative Agency Pro,emily@creativeagency.com,Marketing Director at a mid-sized creative agency,Client communication bottlenecks; Project deadline management; Resource allocation problems
David Thompson,+1-555-0104,FinanceFirst Solutions,d.thompson@financefirst.com,CFO looking to streamline financial operations,Manual reporting takes too long; Data accuracy concerns; Need better forecasting tools
Lisa Anderson,+1-555-0105,HealthCare Partners,landerson@healthcare.com,Hospital administrator overseeing multiple departments,Patient scheduling conflicts; Staff communication gaps; Billing inefficiencies
James Wilson,+1-555-0106,RetailMax Chain,jwilson@retailmax.com,Regional Manager of retail locations,Inconsistent customer experience; Inventory stock-outs; Employee training challenges
Jennifer Martinez,+1-555-0107,EduTech Academy,jmartinez@edutech.com,Principal of online education platform,Student engagement dropping; Content delivery issues; Assessment tracking problems
Robert Taylor,+1-555-0108,Manufacturing Plus,rtaylor@mfgplus.com,Plant Manager focused on production efficiency,Equipment downtime; Quality control inconsistencies; Supply chain delays
Amanda White,+1-555-0109,Consulting Group LLC,awhite@consultinggroup.com,Managing Partner of business consultancy,Client onboarding too slow; Knowledge sharing difficulties; Proposal generation time
Christopher Lee,+1-555-0110,Real Estate Dynamics,clee@redynamics.com,Broker managing multiple property listings,Lead follow-up delays; Document management chaos; Commission tracking errors
Michelle Brown,+1-555-0111,FoodService Corp,mbrown@foodservice.com,Restaurant chain operations director,Inconsistent food quality; Staff turnover high; Vendor management problems
Daniel Garcia,+1-555-0112,Insurance Advisors,dgarcia@insadvisors.com,Agency owner with growing client base,Policy renewal tracking; Claims processing delays; Client communication gaps
Jessica Moore,+1-555-0113,Construction Partners,jmoore@constructionp.com,Project Manager overseeing commercial builds,Budget overruns; Timeline delays; Subcontractor coordination issues
Thomas Jackson,+1-555-0114,Software Innovations,tjackson@softinnov.com,CTO of software development company,Code quality concerns; Developer productivity; Technical debt accumulation
Karen Davis,+1-555-0115,Marketing Solutions,kdavis@mktsolutions.com,Founder of digital marketing agency,Campaign ROI unclear; Client reporting time-consuming; Team capacity planning
Steven Miller,+1-555-0116,Transportation Services,smiller@transservices.com,Fleet Manager with 50+ vehicles,Vehicle maintenance tracking; Driver scheduling conflicts; Fuel cost optimization
Patricia Wilson,+1-555-0117,Legal Associates,pwilson@legalassoc.com,Managing attorney at law firm,Billable hours tracking; Document version control; Client intake process
Richard Martinez,+1-555-0118,E-commerce Ventures,rmartinez@ecomventures.com,Founder of online retail business,Cart abandonment high; Customer support overwhelmed; Returns processing slow
Nancy Anderson,+1-555-0119,HR Solutions Group,nanderson@hrsolutions.com,HR Director for multiple clients,Recruitment takes too long; Employee onboarding inconsistent; Performance review tracking
Charles Thompson,+1-555-0120,Telecommunications Inc,cthompson@telecom.com,VP of Customer Experience,Customer complaints increasing; Service activation delays; Billing disputes frequent
</file>

<file path="public/contacts3.csv">
Name,Phone,Company,Email,Profile Summary,Pain Points
Alex Turner,+1-555-0201,StartupXYZ,alex@startupxyz.com,Founder looking for growth tools,
Maria Santos,+1-555-0202,Design Studio,maria@designstudio.com,,
Kevin Park,+1-555-0203,Tech Consulting,kevin@techconsult.com,IT consultant for SMBs,Legacy systems; Security concerns
Rachel Kim,+1-555-0204,Wellness Center,rachel@wellness.com,Owner of health and wellness business,Client retention; Appointment no-shows
Brian Foster,+1-555-0205,Auto Dealership,brian@autodealer.com,,
Sophie Chen,+1-555-0206,Fashion Boutique,sophie@fashionboutique.com,Retail owner expanding online,Inventory sync issues
Marcus Johnson,+1-555-0207,Coffee Chain,marcus@coffeeshop.com,Multi-location cafe manager,Staff scheduling
Nicole Grant,+1-555-0208,Photography Studio,nicole@photostudio.com,,
Derek Wright,+1-555-0209,Accounting Firm,derek@accountingfirm.com,CPA managing 100+ clients,Tax season overwhelm; Document collection
Olivia Ross,+1-555-0210,Event Planning,olivia@eventplan.com,Corporate event coordinator,Vendor coordination; Budget tracking
Andrew Bell,+1-555-0211,Fitness Gym,andrew@fitnessgym.com,,
Hannah Price,+1-555-0212,Dental Practice,hannah@dentalpractice.com,Practice manager,Patient reminders; Insurance verification
Eric Stone,+1-555-0213,Landscaping Co,eric@landscaping.com,Owner of landscaping business,Seasonal staffing; Quote follow-up
Megan Hill,+1-555-0214,Pet Services,megan@petservices.com,,
Justin Cooper,+1-555-0215,Moving Company,justin@movingco.com,Operations lead,Booking conflicts; Equipment tracking
Vanessa Reed,+1-555-0216,Salon & Spa,vanessa@salonspa.com,Spa owner with 3 locations,Staff utilization
Brandon Hayes,+1-555-0217,Security Systems,brandon@securitysys.com,,
Kimberly Ward,+1-555-0218,Interior Design,kim@interiordesign.com,Designer for residential clients,Project timeline management
Gregory Scott,+1-555-0219,Plumbing Services,greg@plumbingservices.com,Master plumber,Emergency dispatch; Parts inventory
Melissa Torres,+1-555-0220,Catering Business,melissa@catering.com,Catering manager,Menu planning; Dietary restrictions tracking
</file>

<file path="23jan2026-3.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
23jan2026-2.xml
23jan2026.xml
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vercel.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X, Phone, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact, CallLog, IntentLabel } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [running, setRunning] = useState(false);
  const [selectedContactForTranscript, setSelectedContactForTranscript] = useState<Contact | null>(null);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!id || !campaign) return;
    
    const pendingContacts = contacts.filter(c => c.status === 'pending');
    
    if (pendingContacts.length === 0) {
      alert('No pending contacts to call');
      return;
    }

    if (!window.confirm(`Start calling ${pendingContacts.length} pending contacts? (Simulated for 10 seconds)`)) {
      return;
    }

    setRunning(true);

    // Update all pending contacts to 'calling' status
    for (const contact of pendingContacts) {
      await supabase
        .from('contacts')
        .update({ status: 'calling' })
        .eq('id', contact.id);
    }

    await fetchCampaignData();

    // Simulate calls after 10 seconds
    setTimeout(async () => {
      const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
      
      for (const contact of pendingContacts) {
        // Random intent
        const intent = intents[Math.floor(Math.random() * intents.length)];
        
        // Random duration between 60-240 seconds (1-4 minutes)
        const duration = Math.floor(Math.random() * 180) + 60;
        
        // Generate transcript
        const transcript = generateTranscript(contact, intent);
        
        // Generate AI summary
        const aiSummary = generateAISummary(contact, intent);
        
        // Create call log
        await supabase
          .from('call_logs')
          .insert([{
            contact_id: contact.id,
            campaign_id: id,
            call_date: new Date().toISOString(),
            duration,
            transcript,
            recording_url: `https://example.com/recordings/${contact.id}-${Date.now()}.mp3`,
            ai_summary: aiSummary,
            intent_label: intent,
            pain_points_discussed: contact.pain_points.slice(0, 2),
            usps_used: campaign.selected_usps.slice(0, 2)
          }]);
        
        // Update contact status to completed
        await supabase
          .from('contacts')
          .update({ status: 'completed' })
          .eq('id', contact.id);
      }

      setRunning(false);
      await fetchCampaignData();
      alert(`Campaign completed! Called ${pendingContacts.length} contacts.`);
    }, 10000);
  };

  const generateTranscript = (contact: Contact, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'your business needs';
    
    const intros = [
      `AI: Hi ${contact.name}, this is Alex calling from our company. How are you today?`,
      `AI: Good morning ${contact.name}, my name is Alex. I hope I'm not catching you at a bad time?`,
      `AI: Hello ${contact.name}, this is Alex. Do you have a quick moment to chat?`
    ];
    
    const intro = intros[Math.floor(Math.random() * intros.length)];
    
    if (intent === 'positive') {
      return `${intro}

${contact.name}: I'm doing well, thanks. What's this about?

AI: I'm reaching out because I noticed you might be experiencing challenges with ${painPoint}. We've helped companies like ${contact.company || 'yours'} solve similar issues. Would you be interested in learning more?

${contact.name}: Yes, actually! We've been struggling with that. Tell me more.

AI: Great! Let me share how we've helped other clients improve their ${painPoint}. We have a solution that typically reduces these issues by 40-60% within the first month.

${contact.name}: That sounds interesting. Can we schedule a demo?

AI: Absolutely! I'd love to show you how it works. Let me get that set up for you right away.`;
    } else if (intent === 'no-interest') {
      return `${intro}

${contact.name}: I'm busy right now. What is this regarding?

AI: I understand you're busy. I'm calling about ${painPoint} solutions. We've worked with companies like ${contact.company || 'yours'} to help improve their operations.

${contact.name}: We're not interested right now. We have other priorities.

AI: I completely understand. Would it be helpful if I sent you some information you could review when you have time?

${contact.name}: No thanks, we're all set for now.

AI: No problem at all. Thank you for your time, ${contact.name}. Have a great day!`;
    } else { // follow-up
      return `${intro}

${contact.name}: Hi, I'm actually in the middle of something right now.

AI: I completely understand. I'm calling about solutions for ${painPoint}. Does this sound like something that might be relevant to you?

${contact.name}: Potentially, but this week is really hectic. Can you call back next week?

AI: Absolutely! I'll make a note to follow up with you next week. What day works best for you?

${contact.name}: Tuesday afternoon would be better.

AI: Perfect! I'll reach out Tuesday afternoon. Thanks for your time, ${contact.name}!`;
    }
  };

  const generateAISummary = (contact: Contact, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'operational challenges';
    
    if (intent === 'positive') {
      return `Positive conversation with ${contact.name}. Strong interest in our solution for ${painPoint}. Contact mentioned they've been actively looking for solutions. Ready to schedule demo. High potential lead.`;
    } else if (intent === 'no-interest') {
      return `Spoke with ${contact.name}. Currently not interested in solutions for ${painPoint}. Cited other priorities. Polite but firm. Not the right time. Recommend follow-up in 6 months.`;
    } else {
      return `Brief conversation with ${contact.name}. Interested but timing is not ideal. Currently dealing with busy period. Agreed to follow-up call next Tuesday afternoon. Moderate potential.`;
    }
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                disabled={running}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                <Play className="w-5 h-5" />
                {running ? 'Running...' : 'Run Campaign'}
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Call Result</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={9} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3 relative group">
      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
        <div className="flex items-center gap-1">
          <input
            type="text"
            value={editValue}
            onChange={(e) => setEditValue(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
            className="w-full px-2 py-1 border border-primary rounded text-sm"
            autoFocus
          />
          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
            <Check className="w-4 h-4" />
          </button>
          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
            <X className="w-4 h-4" />
          </button>
        </div>
      ) : (
        <>
          <div
            onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
            className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2"
          >
            <span className="truncate max-w-[200px]">
              {contact.profile_summary || '-'}
            </span>
            <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
          </div>
          {contact.profile_summary && contact.profile_summary.length > 40 && (
            <div className="absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-3 shadow-lg z-10 max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
              {contact.profile_summary}
            </div>
          )}
        </>
      )}
    </td>

                    {/* Pain Points */}
<td className="px-6 py-3 relative group">
  {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
    <div className="flex items-center gap-1">
      <input
        type="text"
        value={editValue}
        onChange={(e) => setEditValue(e.target.value)}
        onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
        placeholder="Use ; to separate"
        className="w-full px-2 py-1 border border-primary rounded text-sm"
        autoFocus
      />
      <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
        <Check className="w-4 h-4" />
      </button>
      <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
        <X className="w-4 h-4" />
      </button>
    </div>
  ) : (
    <>
      <div
        onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
        className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2"
      >
        <span className="truncate max-w-[200px] text-red-700">
          {contact.pain_points.length > 0 ? contact.pain_points.join('  ') : '-'}
        </span>
        <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
      </div>
      {contact.pain_points.length > 0 && (
        <div className="absolute left-0 top-full mt-1 bg-white text-gray-900 text-xs rounded-lg p-3 shadow-lg border border-gray-200 z-10 max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
          <div className="flex flex-wrap gap-2">
            {contact.pain_points.map((point: string, idx: number) => (
              <span key={idx} className="px-2 py-1 bg-red-100 text-red-700 rounded">
                {point}
              </span>
            ))}
          </div>
        </div>
      )}
    </>
  )}
</td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      {contact.status === 'completed' ? (
                        <button
                          onClick={() => setSelectedContactForTranscript(contact)}
                          className="flex items-center gap-1 text-primary hover:underline text-sm"
                        >
                          <FileText className="w-4 h-4" />
                          View Call
                        </button>
                      ) : (
                        <span className="text-gray-400 text-xs">-</span>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}

      {/* Transcript Modal */}
      {selectedContactForTranscript && (
        <TranscriptModal
          contact={selectedContactForTranscript}
          campaignId={id!}
          onClose={() => setSelectedContactForTranscript(null)}
        />
      )}
    </div>
  );
};

// Transcript Modal Component
interface TranscriptModalProps {
  contact: Contact;
  campaignId: string;
  onClose: () => void;
}

const TranscriptModal = ({ contact, campaignId, onClose }: TranscriptModalProps) => {
  const [callLog, setCallLog] = useState<CallLog | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLog();
  }, []);

  const fetchCallLog = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .eq('campaign_id', campaignId)
        .order('call_date', { ascending: false })
        .limit(1)
        .single();

      if (error) throw error;
      setCallLog(data);
    } catch (err) {
      console.error('Error fetching call log:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {loading ? (
            <p className="text-center py-8 text-gray-500">Loading call details...</p>
          ) : !callLog ? (
            <p className="text-center py-8 text-gray-500">No call log found</p>
          ) : (
            <div className="space-y-6">
              {/* Call Metadata */}
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-gray-600">
                    {new Date(callLog.call_date).toLocaleString()}  {Math.floor(callLog.duration / 60)}m {callLog.duration % 60}s
                  </p>
                </div>
                <span className={`px-3 py-1 rounded-full text-sm font-medium ${getIntentColor(callLog.intent_label)}`}>
                  {getIntentLabel(callLog.intent_label)}
                </span>
              </div>

              {/* Recording */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Call Recording</h3>
                <div className="bg-gray-100 rounded-lg p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5 text-gray-600" />
                    <div>
                      <p className="text-sm font-medium text-gray-900">Recording Available</p>
                      <p className="text-xs text-gray-500">Duration: {Math.floor(callLog.duration / 60)}:{String(callLog.duration % 60).padStart(2, '0')}</p>
                    </div>
                  </div>
                  <a
                    href={callLog.recording_url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="px-4 py-2 bg-primary text-white text-sm rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    Play Recording
                  </a>
                </div>
              </div>

              {/* AI Summary */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">AI Summary</h3>
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p className="text-sm text-gray-800">{callLog.ai_summary}</p>
                </div>
              </div>

              {/* Pain Points Discussed */}
              {callLog.pain_points_discussed.length > 0 && (
                <div>
                  <h3 className="font-semibold text-gray-900 mb-2">Pain Points Discussed</h3>
                  <div className="flex flex-wrap gap-2">
                    {callLog.pain_points_discussed.map((point, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {point}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Transcript */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Full Transcript</h3>
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-96 overflow-y-auto">
                  <pre className="text-sm text-gray-800 whitespace-pre-wrap font-sans">{callLog.transcript}</pre>
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map((campaign: CampaignWithStats) => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, CallLog, IntentLabel } from '../types';

interface ContactWithCampaignData extends Contact {
  campaigns?: {
    name: string;
  };
}

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: string;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts: ContactWithCampaign[] = (contactsData || []).map((contact: ContactWithCampaignData) => ({
        ...contact,
        campaign_name: contact.campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
interface ContactDetailModalProps {
  contact: ContactWithCampaign;
  onClose: () => void;
}

const ContactDetailModal = ({ contact, onClose }: ContactDetailModalProps) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${getIntentColor(log.intent_label)}`}>
                        {getIntentLabel(log.intent_label)}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="23jan2026-2.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
23jan2026.xml
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addCampaign({
      name: formData.name,
      description: formData.description,
      status: formData.status,
      callWindow: {
        startTime: formData.startTime,
        endTime: formData.endTime,
        timezone: formData.timezone
      },
      selectedUSPs: formData.selectedUSPs,
      totalContacts: 0,
      calledCount: 0,
      pendingCount: 0
    });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {data.usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selectedUSPs.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, usp.id] });
                          } else {
                            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

interface ParsedContact {
  name: string;
  phone: string;
  company: string;
  email: string;
  profileSummary: string;
  painPoints: string[];
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      // Parse CSV
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      // Check required fields
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts: ParsedContact[] = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        // Handle pain points (could be comma-separated or single)
        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profileSummary: contactData.profilesummary || contactData['profile summary'] || '',
          painPoints: painPointsArray
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData, CallStatus, IntentLabel } from '../types';
import { DataContext } from './DataContextDefinition';

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: Omit<Campaign, 'id' | 'createdAt'>) => {
    const newCampaign: Campaign = {
      ...campaign,
      id: `camp_${Date.now()}`,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: Partial<Campaign>) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.map(c => c.id === id ? { ...c, ...updates } : c)
    }));
  };

  const deleteCampaign = (id: string) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.filter(c => c.id !== id),
      contacts: prev.contacts.map(contact => ({
        ...contact,
        campaigns: contact.campaigns.filter(cp => cp.campaignId !== id)
      })),
      callLogs: prev.callLogs.filter(log => log.campaignId !== id)
    }));
  };

  const addUSP = (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => {
    const newUSP: USP = {
      ...usp,
      id: `usp_${Date.now()}`,
      usageCount: 0,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: Partial<USP>) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.map(u => u.id === id ? { ...u, ...updates } : u)
    }));
  };

  const deleteUSP = (id: string) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.filter(u => u.id !== id)
    }));
  };

  const addContacts = (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => {
    setData(prev => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find(c => c.id === campaignId) : null;

      contacts.forEach(newContact => {
        const existingIndex = updatedContacts.findIndex(c => c.phone === newContact.phone);
        
        if (existingIndex >= 0) {
          // Merge with existing contact
          const existing = updatedContacts[existingIndex];
          if (campaignId && campaign) {
            const hasAssociation = existing.campaigns.some(cp => cp.campaignId === campaignId);
            if (!hasAssociation) {
              existing.campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
            }
          }
        } else {
          // Add new contact
          const contact: Contact = {
            ...newContact,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      // Update campaign counts
      const updatedCampaigns = prev.campaigns.map(c => {
        if (c.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter(contact =>
            contact.campaigns.some(cp => cp.campaignId === campaignId)
          );
          return {
            ...c,
            totalContacts: contactsInCampaign.length,
            pendingCount: contactsInCampaign.filter(contact =>
              contact.campaigns.find(cp => cp.campaignId === campaignId)?.status === 'pending'
            ).length
          };
        }
        return c;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find(c => c.id === campaignId);
    if (!campaign) return;

    // Simulate calls after 10 seconds
    setTimeout(() => {
      setData(prev => {
        const newCallLogs: CallLog[] = [];
        const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map(contact => {
          const campaignAssoc = contact.campaigns.find(cp => cp.campaignId === campaignId);
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60; // 1-4 minutes
            
            const callLog: CallLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contactId: contact.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${contact.name}, this is Alex from our company calling about ${contact.painPoints[0] || 'your business needs'}...\n\n${contact.name}: ${intent === 'positive' ? 'Yes, I\'m interested! Tell me more.' : intent === 'no-interest' ? 'Not interested, thanks.' : 'Can you call back next week? We\'re busy right now.'}\n\nAI: ${intent === 'positive' ? 'Great! Let me share how we can help...' : intent === 'no-interest' ? 'I understand. Thank you for your time.' : 'Absolutely! I\'ll follow up next week.'}`,
              recordingUrl: '#',
              aiSummary: intent === 'positive' 
                ? `Prospect showed strong interest. Mentioned challenges with ${contact.painPoints[0] || 'their current solution'}. Ready for next steps.`
                : intent === 'no-interest'
                ? `Prospect declined. Not the right time. No clear pain points identified.`
                : `Prospect interested but needs more time. Requested follow-up next week.`,
              intentLabel: intent,
              painPointsDiscussed: contact.painPoints.slice(0, 2),
              uspsUsed: campaign.selectedUSPs.slice(0, 2)
            };

            newCallLogs.push(callLog);

            return {
              ...contact,
              campaigns: contact.campaigns.map(cp =>
                cp.campaignId === campaignId ? { ...cp, status: 'completed' as CallStatus } : cp
              ),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return contact;
        });

        const updatedCampaigns = prev.campaigns.map(c => {
          if (c.id === campaignId) {
            return {
              ...c,
              calledCount: c.totalContacts,
              pendingCount: 0,
              status: 'completed' as const
            };
          }
          return c;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData } from '../types';

export interface DataContextType {
  data: AppData;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'createdAt'>) => void;
  updateCampaign: (id: string, updates: Partial<Campaign>) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => void;
  updateUSP: (id: string, updates: Partial<USP>) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X, Phone, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact, CallLog, IntentLabel } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [running, setRunning] = useState(false);
  const [selectedContactForTranscript, setSelectedContactForTranscript] = useState<Contact | null>(null);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!id || !campaign) return;
    
    const pendingContacts = contacts.filter(c => c.status === 'pending');
    
    if (pendingContacts.length === 0) {
      alert('No pending contacts to call');
      return;
    }

    if (!window.confirm(`Start calling ${pendingContacts.length} pending contacts? (Simulated for 10 seconds)`)) {
      return;
    }

    setRunning(true);

    // Update all pending contacts to 'calling' status
    for (const contact of pendingContacts) {
      await supabase
        .from('contacts')
        .update({ status: 'calling' })
        .eq('id', contact.id);
    }

    await fetchCampaignData();

    // Simulate calls after 10 seconds
    setTimeout(async () => {
      const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
      
      for (const contact of pendingContacts) {
        // Random intent
        const intent = intents[Math.floor(Math.random() * intents.length)];
        
        // Random duration between 60-240 seconds (1-4 minutes)
        const duration = Math.floor(Math.random() * 180) + 60;
        
        // Generate transcript
        const transcript = generateTranscript(contact, intent);
        
        // Generate AI summary
        const aiSummary = generateAISummary(contact, intent);
        
        // Create call log
        await supabase
          .from('call_logs')
          .insert([{
            contact_id: contact.id,
            campaign_id: id,
            call_date: new Date().toISOString(),
            duration,
            transcript,
            recording_url: `https://example.com/recordings/${contact.id}-${Date.now()}.mp3`,
            ai_summary: aiSummary,
            intent_label: intent,
            pain_points_discussed: contact.pain_points.slice(0, 2),
            usps_used: campaign.selected_usps.slice(0, 2)
          }]);
        
        // Update contact status to completed
        await supabase
          .from('contacts')
          .update({ status: 'completed' })
          .eq('id', contact.id);
      }

      setRunning(false);
      await fetchCampaignData();
      alert(`Campaign completed! Called ${pendingContacts.length} contacts.`);
    }, 10000);
  };

  const generateTranscript = (contact: Contact, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'your business needs';
    
    const intros = [
      `AI: Hi ${contact.name}, this is Alex calling from our company. How are you today?`,
      `AI: Good morning ${contact.name}, my name is Alex. I hope I'm not catching you at a bad time?`,
      `AI: Hello ${contact.name}, this is Alex. Do you have a quick moment to chat?`
    ];
    
    const intro = intros[Math.floor(Math.random() * intros.length)];
    
    if (intent === 'positive') {
      return `${intro}

${contact.name}: I'm doing well, thanks. What's this about?

AI: I'm reaching out because I noticed you might be experiencing challenges with ${painPoint}. We've helped companies like ${contact.company || 'yours'} solve similar issues. Would you be interested in learning more?

${contact.name}: Yes, actually! We've been struggling with that. Tell me more.

AI: Great! Let me share how we've helped other clients improve their ${painPoint}. We have a solution that typically reduces these issues by 40-60% within the first month.

${contact.name}: That sounds interesting. Can we schedule a demo?

AI: Absolutely! I'd love to show you how it works. Let me get that set up for you right away.`;
    } else if (intent === 'no-interest') {
      return `${intro}

${contact.name}: I'm busy right now. What is this regarding?

AI: I understand you're busy. I'm calling about ${painPoint} solutions. We've worked with companies like ${contact.company || 'yours'} to help improve their operations.

${contact.name}: We're not interested right now. We have other priorities.

AI: I completely understand. Would it be helpful if I sent you some information you could review when you have time?

${contact.name}: No thanks, we're all set for now.

AI: No problem at all. Thank you for your time, ${contact.name}. Have a great day!`;
    } else { // follow-up
      return `${intro}

${contact.name}: Hi, I'm actually in the middle of something right now.

AI: I completely understand. I'm calling about solutions for ${painPoint}. Does this sound like something that might be relevant to you?

${contact.name}: Potentially, but this week is really hectic. Can you call back next week?

AI: Absolutely! I'll make a note to follow up with you next week. What day works best for you?

${contact.name}: Tuesday afternoon would be better.

AI: Perfect! I'll reach out Tuesday afternoon. Thanks for your time, ${contact.name}!`;
    }
  };

  const generateAISummary = (contact: Contact, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'operational challenges';
    
    if (intent === 'positive') {
      return `Positive conversation with ${contact.name}. Strong interest in our solution for ${painPoint}. Contact mentioned they've been actively looking for solutions. Ready to schedule demo. High potential lead.`;
    } else if (intent === 'no-interest') {
      return `Spoke with ${contact.name}. Currently not interested in solutions for ${painPoint}. Cited other priorities. Polite but firm. Not the right time. Recommend follow-up in 6 months.`;
    } else {
      return `Brief conversation with ${contact.name}. Interested but timing is not ideal. Currently dealing with busy period. Agreed to follow-up call next Tuesday afternoon. Moderate potential.`;
    }
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                disabled={running}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                <Play className="w-5 h-5" />
                {running ? 'Running...' : 'Run Campaign'}
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Call Result</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={9} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3 relative group">
      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
        <div className="flex items-center gap-1">
          <input
            type="text"
            value={editValue}
            onChange={(e) => setEditValue(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
            className="w-full px-2 py-1 border border-primary rounded text-sm"
            autoFocus
          />
          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
            <Check className="w-4 h-4" />
          </button>
          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
            <X className="w-4 h-4" />
          </button>
        </div>
      ) : (
        <>
          <div
            onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
            className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2"
          >
            <span className="truncate max-w-[200px]">
              {contact.profile_summary || '-'}
            </span>
            <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
          </div>
          {contact.profile_summary && contact.profile_summary.length > 40 && (
            <div className="absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-3 shadow-lg z-10 max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
              {contact.profile_summary}
            </div>
          )}
        </>
      )}
    </td>

                    {/* Pain Points - REPLACE THIS */}
    <td className="px-6 py-3 relative group">
      {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
        <div className="flex items-center gap-1">
          <input
            type="text"
            value={editValue}
            onChange={(e) => setEditValue(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
            placeholder="Use ; to separate"
            className="w-full px-2 py-1 border border-primary rounded text-sm"
            autoFocus
          />
          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
            <Check className="w-4 h-4" />
          </button>
          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
            <X className="w-4 h-4" />
          </button>
        </div>
      ) : (
        <>
          <div
            onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
            className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2"
          >
            <span className="truncate max-w-[200px] text-red-700">
              {contact.pain_points.length > 0 ? contact.pain_points.join('  ') : '-'}
            </span>
            <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
          </div>
          {contact.pain_points.length > 0 && (
            <div className="absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-3 shadow-lg z-10 max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
              <div className="flex flex-wrap gap-2">
                {contact.pain_points.map((point: string, idx: number) => (
                  <span key={idx} className="px-2 py-1 bg-red-100 text-red-700 rounded">
                    {point}
                  </span>
                ))}
              </div>
            </div>
          )}
        </>
      )}
    </td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      {contact.status === 'completed' ? (
                        <button
                          onClick={() => setSelectedContactForTranscript(contact)}
                          className="flex items-center gap-1 text-primary hover:underline text-sm"
                        >
                          <FileText className="w-4 h-4" />
                          View Call
                        </button>
                      ) : (
                        <span className="text-gray-400 text-xs">-</span>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}

      {/* Transcript Modal */}
      {selectedContactForTranscript && (
        <TranscriptModal
          contact={selectedContactForTranscript}
          campaignId={id!}
          onClose={() => setSelectedContactForTranscript(null)}
        />
      )}
    </div>
  );
};

// Transcript Modal Component
interface TranscriptModalProps {
  contact: Contact;
  campaignId: string;
  onClose: () => void;
}

const TranscriptModal = ({ contact, campaignId, onClose }: TranscriptModalProps) => {
  const [callLog, setCallLog] = useState<CallLog | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLog();
  }, []);

  const fetchCallLog = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .eq('campaign_id', campaignId)
        .order('call_date', { ascending: false })
        .limit(1)
        .single();

      if (error) throw error;
      setCallLog(data);
    } catch (err) {
      console.error('Error fetching call log:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {loading ? (
            <p className="text-center py-8 text-gray-500">Loading call details...</p>
          ) : !callLog ? (
            <p className="text-center py-8 text-gray-500">No call log found</p>
          ) : (
            <div className="space-y-6">
              {/* Call Metadata */}
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-gray-600">
                    {new Date(callLog.call_date).toLocaleString()}  {Math.floor(callLog.duration / 60)}m {callLog.duration % 60}s
                  </p>
                </div>
                <span className={`px-3 py-1 rounded-full text-sm font-medium ${getIntentColor(callLog.intent_label)}`}>
                  {getIntentLabel(callLog.intent_label)}
                </span>
              </div>

              {/* Recording */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Call Recording</h3>
                <div className="bg-gray-100 rounded-lg p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5 text-gray-600" />
                    <div>
                      <p className="text-sm font-medium text-gray-900">Recording Available</p>
                      <p className="text-xs text-gray-500">Duration: {Math.floor(callLog.duration / 60)}:{String(callLog.duration % 60).padStart(2, '0')}</p>
                    </div>
                  </div>
                  <a
                    href={callLog.recording_url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="px-4 py-2 bg-primary text-white text-sm rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    Play Recording
                  </a>
                </div>
              </div>

              {/* AI Summary */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">AI Summary</h3>
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p className="text-sm text-gray-800">{callLog.ai_summary}</p>
                </div>
              </div>

              {/* Pain Points Discussed */}
              {callLog.pain_points_discussed.length > 0 && (
                <div>
                  <h3 className="font-semibold text-gray-900 mb-2">Pain Points Discussed</h3>
                  <div className="flex flex-wrap gap-2">
                    {callLog.pain_points_discussed.map((point, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {point}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Transcript */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Full Transcript</h3>
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-96 overflow-y-auto">
                  <pre className="text-sm text-gray-800 whitespace-pre-wrap font-sans">{callLog.transcript}</pre>
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map((campaign: CampaignWithStats) => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, CallLog, IntentLabel } from '../types';

interface ContactWithCampaignData extends Contact {
  campaigns?: {
    name: string;
  };
}

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: string;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts: ContactWithCampaign[] = (contactsData || []).map((contact: ContactWithCampaignData) => ({
        ...contact,
        campaign_name: contact.campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
interface ContactDetailModalProps {
  contact: ContactWithCampaign;
  onClose: () => void;
}

const ContactDetailModal = ({ contact, onClose }: ContactDetailModalProps) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${getIntentColor(log.intent_label)}`}>
                        {getIntentLabel(log.intent_label)}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="23jan2026.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addCampaign({
      name: formData.name,
      description: formData.description,
      status: formData.status,
      callWindow: {
        startTime: formData.startTime,
        endTime: formData.endTime,
        timezone: formData.timezone
      },
      selectedUSPs: formData.selectedUSPs,
      totalContacts: 0,
      calledCount: 0,
      pendingCount: 0
    });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {data.usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selectedUSPs.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, usp.id] });
                          } else {
                            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

interface ParsedContact {
  name: string;
  phone: string;
  company: string;
  email: string;
  profileSummary: string;
  painPoints: string[];
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      // Parse CSV
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      // Check required fields
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts: ParsedContact[] = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        // Handle pain points (could be comma-separated or single)
        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profileSummary: contactData.profilesummary || contactData['profile summary'] || '',
          painPoints: painPointsArray
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData, CallStatus, IntentLabel } from '../types';
import { DataContext } from './DataContextDefinition';

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: Omit<Campaign, 'id' | 'createdAt'>) => {
    const newCampaign: Campaign = {
      ...campaign,
      id: `camp_${Date.now()}`,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: Partial<Campaign>) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.map(c => c.id === id ? { ...c, ...updates } : c)
    }));
  };

  const deleteCampaign = (id: string) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.filter(c => c.id !== id),
      contacts: prev.contacts.map(contact => ({
        ...contact,
        campaigns: contact.campaigns.filter(cp => cp.campaignId !== id)
      })),
      callLogs: prev.callLogs.filter(log => log.campaignId !== id)
    }));
  };

  const addUSP = (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => {
    const newUSP: USP = {
      ...usp,
      id: `usp_${Date.now()}`,
      usageCount: 0,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: Partial<USP>) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.map(u => u.id === id ? { ...u, ...updates } : u)
    }));
  };

  const deleteUSP = (id: string) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.filter(u => u.id !== id)
    }));
  };

  const addContacts = (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => {
    setData(prev => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find(c => c.id === campaignId) : null;

      contacts.forEach(newContact => {
        const existingIndex = updatedContacts.findIndex(c => c.phone === newContact.phone);
        
        if (existingIndex >= 0) {
          // Merge with existing contact
          const existing = updatedContacts[existingIndex];
          if (campaignId && campaign) {
            const hasAssociation = existing.campaigns.some(cp => cp.campaignId === campaignId);
            if (!hasAssociation) {
              existing.campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
            }
          }
        } else {
          // Add new contact
          const contact: Contact = {
            ...newContact,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      // Update campaign counts
      const updatedCampaigns = prev.campaigns.map(c => {
        if (c.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter(contact =>
            contact.campaigns.some(cp => cp.campaignId === campaignId)
          );
          return {
            ...c,
            totalContacts: contactsInCampaign.length,
            pendingCount: contactsInCampaign.filter(contact =>
              contact.campaigns.find(cp => cp.campaignId === campaignId)?.status === 'pending'
            ).length
          };
        }
        return c;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find(c => c.id === campaignId);
    if (!campaign) return;

    // Simulate calls after 10 seconds
    setTimeout(() => {
      setData(prev => {
        const newCallLogs: CallLog[] = [];
        const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map(contact => {
          const campaignAssoc = contact.campaigns.find(cp => cp.campaignId === campaignId);
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60; // 1-4 minutes
            
            const callLog: CallLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contactId: contact.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${contact.name}, this is Alex from our company calling about ${contact.painPoints[0] || 'your business needs'}...\n\n${contact.name}: ${intent === 'positive' ? 'Yes, I\'m interested! Tell me more.' : intent === 'no-interest' ? 'Not interested, thanks.' : 'Can you call back next week? We\'re busy right now.'}\n\nAI: ${intent === 'positive' ? 'Great! Let me share how we can help...' : intent === 'no-interest' ? 'I understand. Thank you for your time.' : 'Absolutely! I\'ll follow up next week.'}`,
              recordingUrl: '#',
              aiSummary: intent === 'positive' 
                ? `Prospect showed strong interest. Mentioned challenges with ${contact.painPoints[0] || 'their current solution'}. Ready for next steps.`
                : intent === 'no-interest'
                ? `Prospect declined. Not the right time. No clear pain points identified.`
                : `Prospect interested but needs more time. Requested follow-up next week.`,
              intentLabel: intent,
              painPointsDiscussed: contact.painPoints.slice(0, 2),
              uspsUsed: campaign.selectedUSPs.slice(0, 2)
            };

            newCallLogs.push(callLog);

            return {
              ...contact,
              campaigns: contact.campaigns.map(cp =>
                cp.campaignId === campaignId ? { ...cp, status: 'completed' as CallStatus } : cp
              ),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return contact;
        });

        const updatedCampaigns = prev.campaigns.map(c => {
          if (c.id === campaignId) {
            return {
              ...c,
              calledCount: c.totalContacts,
              pendingCount: 0,
              status: 'completed' as const
            };
          }
          return c;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData } from '../types';

export interface DataContextType {
  data: AppData;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'createdAt'>) => void;
  updateCampaign: (id: string, updates: Partial<Campaign>) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => void;
  updateUSP: (id: string, updates: Partial<USP>) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    // Convert pain_points string to array
    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!window.confirm('Start calling all pending contacts? (Simulated for 10 seconds)')) return;

    // TODO: Implement actual campaign run logic
    alert('Campaign simulation will be implemented with RingCentral integration');
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
              >
                <Play className="w-5 h-5" />
                Run Campaign
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={8} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2 max-w-xs truncate"
                        >
                          <span className="truncate">{contact.profile_summary || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            placeholder="Use ; to separate"
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group"
                        >
                          {contact.pain_points.length > 0 ? (
                            <div className="flex flex-wrap gap-1">
                              {contact.pain_points.map((point, idx) => (
                                <span key={idx} className="px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded">
                                  {point}
                                </span>
                              ))}
                            </div>
                          ) : (
                            <span className="text-gray-400">-</span>
                          )}
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 inline ml-2" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

     {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState } from 'react';
import { Plus, Upload, Phone, Clock, Trash2, Play } from 'lucide-react';
import { useData } from '../hooks/useData';
import type { Campaign } from '../types';
import CreateCampaignModal from '../components/common/CreateCampaignModal';
import UploadContactsModal from '../components/common/UploadContactsModal';

const CampaignsPage = () => {
  const { data, deleteCampaign, runCampaign } = useData();
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [selectedCampaign, setSelectedCampaign] = useState<Campaign | null>(null);
  const [showUploadModal, setShowUploadModal] = useState(false);

  const handleRunCampaign = (campaignId: string) => {
    if (window.confirm('Start calling all pending contacts in this campaign? Calls will complete in 10 seconds.')) {
      runCampaign(campaignId);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => setShowCreateModal(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      </div>

      {data.campaigns.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
          <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
          <button
            onClick={() => setShowCreateModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {data.campaigns.map(campaign => (
            <div key={campaign.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">{campaign.name}</h3>
                  <p className="text-gray-600 text-sm mb-3">{campaign.description}</p>
                  <div className="flex items-center gap-4 text-sm">
                    <span className={`px-3 py-1 rounded-full ${
                      campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                      campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-gray-100 text-gray-800'
                    }`}>
                      {campaign.status}
                    </span>
                    <span className="text-gray-600">
                      <Clock className="w-4 h-4 inline mr-1" />
                      {campaign.callWindow.startTime} - {campaign.callWindow.endTime} {campaign.callWindow.timezone}
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => deleteCampaign(campaign.id)}
                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                >
                  <Trash2 className="w-5 h-5" />
                </button>
              </div>

              <div className="grid grid-cols-3 gap-4 mb-4">
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-gray-900">{campaign.totalContacts}</div>
                  <div className="text-sm text-gray-600">Total Contacts</div>
                </div>
                <div className="bg-blue-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-blue-900">{campaign.pendingCount}</div>
                  <div className="text-sm text-blue-600">Pending</div>
                </div>
                <div className="bg-green-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-green-900">{campaign.calledCount}</div>
                  <div className="text-sm text-green-600">Called</div>
                </div>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    setSelectedCampaign(campaign);
                    setShowUploadModal(true);
                  }}
                  className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <Upload className="w-4 h-4" />
                  Upload Contacts
                </button>
                {campaign.pendingCount > 0 && (
                  <button
                    onClick={() => handleRunCampaign(campaign.id)}
                    className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    <Play className="w-4 h-4" />
                    Run Campaign
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      )}

      {showCreateModal && (
        <CreateCampaignModal onClose={() => setShowCreateModal(false)} />
      )}

      {showUploadModal && selectedCampaign && (
        <UploadContactsModal
          campaignId={selectedCampaign.id}
          onClose={() => {
            setShowUploadModal(false);
            setSelectedCampaign(null);
          }}
        />
      )}
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, Campaign, CallLog, IntentLabel } from '../types';

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts = (contactsData || []).map(contact => ({
        ...contact,
        campaign_name: (contact as any).campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
const ContactDetailModal = ({ contact, onClose }: { contact: ContactWithCampaign; onClose: () => void }) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <FileText className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        log.intent_label === 'positive' ? 'bg-green-100 text-green-800' :
                        log.intent_label === 'no-interest' ? 'bg-red-100 text-red-800' :
                        'bg-yellow-100 text-yellow-800'
                      }`}>
                        {log.intent_label}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
</file>

<file path="23jan2026.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addCampaign({
      name: formData.name,
      description: formData.description,
      status: formData.status,
      callWindow: {
        startTime: formData.startTime,
        endTime: formData.endTime,
        timezone: formData.timezone
      },
      selectedUSPs: formData.selectedUSPs,
      totalContacts: 0,
      calledCount: 0,
      pendingCount: 0
    });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {data.usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selectedUSPs.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, usp.id] });
                          } else {
                            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

interface ParsedContact {
  name: string;
  phone: string;
  company: string;
  email: string;
  profileSummary: string;
  painPoints: string[];
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      // Parse CSV
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      // Check required fields
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts: ParsedContact[] = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        // Handle pain points (could be comma-separated or single)
        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profileSummary: contactData.profilesummary || contactData['profile summary'] || '',
          painPoints: painPointsArray
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData, CallStatus, IntentLabel } from '../types';
import { DataContext } from './DataContextDefinition';

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: Omit<Campaign, 'id' | 'createdAt'>) => {
    const newCampaign: Campaign = {
      ...campaign,
      id: `camp_${Date.now()}`,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: Partial<Campaign>) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.map(c => c.id === id ? { ...c, ...updates } : c)
    }));
  };

  const deleteCampaign = (id: string) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.filter(c => c.id !== id),
      contacts: prev.contacts.map(contact => ({
        ...contact,
        campaigns: contact.campaigns.filter(cp => cp.campaignId !== id)
      })),
      callLogs: prev.callLogs.filter(log => log.campaignId !== id)
    }));
  };

  const addUSP = (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => {
    const newUSP: USP = {
      ...usp,
      id: `usp_${Date.now()}`,
      usageCount: 0,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: Partial<USP>) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.map(u => u.id === id ? { ...u, ...updates } : u)
    }));
  };

  const deleteUSP = (id: string) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.filter(u => u.id !== id)
    }));
  };

  const addContacts = (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => {
    setData(prev => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find(c => c.id === campaignId) : null;

      contacts.forEach(newContact => {
        const existingIndex = updatedContacts.findIndex(c => c.phone === newContact.phone);
        
        if (existingIndex >= 0) {
          // Merge with existing contact
          const existing = updatedContacts[existingIndex];
          if (campaignId && campaign) {
            const hasAssociation = existing.campaigns.some(cp => cp.campaignId === campaignId);
            if (!hasAssociation) {
              existing.campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
            }
          }
        } else {
          // Add new contact
          const contact: Contact = {
            ...newContact,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      // Update campaign counts
      const updatedCampaigns = prev.campaigns.map(c => {
        if (c.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter(contact =>
            contact.campaigns.some(cp => cp.campaignId === campaignId)
          );
          return {
            ...c,
            totalContacts: contactsInCampaign.length,
            pendingCount: contactsInCampaign.filter(contact =>
              contact.campaigns.find(cp => cp.campaignId === campaignId)?.status === 'pending'
            ).length
          };
        }
        return c;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find(c => c.id === campaignId);
    if (!campaign) return;

    // Simulate calls after 10 seconds
    setTimeout(() => {
      setData(prev => {
        const newCallLogs: CallLog[] = [];
        const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map(contact => {
          const campaignAssoc = contact.campaigns.find(cp => cp.campaignId === campaignId);
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60; // 1-4 minutes
            
            const callLog: CallLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contactId: contact.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${contact.name}, this is Alex from our company calling about ${contact.painPoints[0] || 'your business needs'}...\n\n${contact.name}: ${intent === 'positive' ? 'Yes, I\'m interested! Tell me more.' : intent === 'no-interest' ? 'Not interested, thanks.' : 'Can you call back next week? We\'re busy right now.'}\n\nAI: ${intent === 'positive' ? 'Great! Let me share how we can help...' : intent === 'no-interest' ? 'I understand. Thank you for your time.' : 'Absolutely! I\'ll follow up next week.'}`,
              recordingUrl: '#',
              aiSummary: intent === 'positive' 
                ? `Prospect showed strong interest. Mentioned challenges with ${contact.painPoints[0] || 'their current solution'}. Ready for next steps.`
                : intent === 'no-interest'
                ? `Prospect declined. Not the right time. No clear pain points identified.`
                : `Prospect interested but needs more time. Requested follow-up next week.`,
              intentLabel: intent,
              painPointsDiscussed: contact.painPoints.slice(0, 2),
              uspsUsed: campaign.selectedUSPs.slice(0, 2)
            };

            newCallLogs.push(callLog);

            return {
              ...contact,
              campaigns: contact.campaigns.map(cp =>
                cp.campaignId === campaignId ? { ...cp, status: 'completed' as CallStatus } : cp
              ),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return contact;
        });

        const updatedCampaigns = prev.campaigns.map(c => {
          if (c.id === campaignId) {
            return {
              ...c,
              calledCount: c.totalContacts,
              pendingCount: 0,
              status: 'completed' as const
            };
          }
          return c;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData } from '../types';

export interface DataContextType {
  data: AppData;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'createdAt'>) => void;
  updateCampaign: (id: string, updates: Partial<Campaign>) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => void;
  updateUSP: (id: string, updates: Partial<USP>) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    // Convert pain_points string to array
    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!window.confirm('Start calling all pending contacts? (Simulated for 10 seconds)')) return;

    // TODO: Implement actual campaign run logic
    alert('Campaign simulation will be implemented with RingCentral integration');
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
              >
                <Play className="w-5 h-5" />
                Run Campaign
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={8} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2 max-w-xs truncate"
                        >
                          <span className="truncate">{contact.profile_summary || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            placeholder="Use ; to separate"
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group"
                        >
                          {contact.pain_points.length > 0 ? (
                            <div className="flex flex-wrap gap-1">
                              {contact.pain_points.map((point, idx) => (
                                <span key={idx} className="px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded">
                                  {point}
                                </span>
                              ))}
                            </div>
                          ) : (
                            <span className="text-gray-400">-</span>
                          )}
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 inline ml-2" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

     {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState } from 'react';
import { Plus, Upload, Phone, Clock, Trash2, Play } from 'lucide-react';
import { useData } from '../hooks/useData';
import type { Campaign } from '../types';
import CreateCampaignModal from '../components/common/CreateCampaignModal';
import UploadContactsModal from '../components/common/UploadContactsModal';

const CampaignsPage = () => {
  const { data, deleteCampaign, runCampaign } = useData();
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [selectedCampaign, setSelectedCampaign] = useState<Campaign | null>(null);
  const [showUploadModal, setShowUploadModal] = useState(false);

  const handleRunCampaign = (campaignId: string) => {
    if (window.confirm('Start calling all pending contacts in this campaign? Calls will complete in 10 seconds.')) {
      runCampaign(campaignId);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => setShowCreateModal(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      </div>

      {data.campaigns.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
          <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
          <button
            onClick={() => setShowCreateModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {data.campaigns.map(campaign => (
            <div key={campaign.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">{campaign.name}</h3>
                  <p className="text-gray-600 text-sm mb-3">{campaign.description}</p>
                  <div className="flex items-center gap-4 text-sm">
                    <span className={`px-3 py-1 rounded-full ${
                      campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                      campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-gray-100 text-gray-800'
                    }`}>
                      {campaign.status}
                    </span>
                    <span className="text-gray-600">
                      <Clock className="w-4 h-4 inline mr-1" />
                      {campaign.callWindow.startTime} - {campaign.callWindow.endTime} {campaign.callWindow.timezone}
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => deleteCampaign(campaign.id)}
                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                >
                  <Trash2 className="w-5 h-5" />
                </button>
              </div>

              <div className="grid grid-cols-3 gap-4 mb-4">
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-gray-900">{campaign.totalContacts}</div>
                  <div className="text-sm text-gray-600">Total Contacts</div>
                </div>
                <div className="bg-blue-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-blue-900">{campaign.pendingCount}</div>
                  <div className="text-sm text-blue-600">Pending</div>
                </div>
                <div className="bg-green-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-green-900">{campaign.calledCount}</div>
                  <div className="text-sm text-green-600">Called</div>
                </div>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    setSelectedCampaign(campaign);
                    setShowUploadModal(true);
                  }}
                  className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <Upload className="w-4 h-4" />
                  Upload Contacts
                </button>
                {campaign.pendingCount > 0 && (
                  <button
                    onClick={() => handleRunCampaign(campaign.id)}
                    className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    <Play className="w-4 h-4" />
                    Run Campaign
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      )}

      {showCreateModal && (
        <CreateCampaignModal onClose={() => setShowCreateModal(false)} />
      )}

      {showUploadModal && selectedCampaign && (
        <UploadContactsModal
          campaignId={selectedCampaign.id}
          onClose={() => {
            setShowUploadModal(false);
            setSelectedCampaign(null);
          }}
        />
      )}
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, Campaign, CallLog, IntentLabel } from '../types';

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts = (contactsData || []).map(contact => ({
        ...contact,
        campaign_name: (contact as any).campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
const ContactDetailModal = ({ contact, onClose }: { contact: ContactWithCampaign; onClose: () => void }) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <FileText className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        log.intent_label === 'positive' ? 'bg-green-100 text-green-800' :
                        log.intent_label === 'no-interest' ? 'bg-red-100 text-red-800' :
                        'bg-yellow-100 text-yellow-800'
                      }`}>
                        {log.intent_label}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vercel.json">
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import { DataContext } from './DataContextDefinition';

interface AppData {
  campaigns: unknown[];
  contacts: unknown[];
  usps: unknown[];
  callLogs: unknown[];
}

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved) as AppData;
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: unknown) => {
    const newCampaign = {
      ...campaign as Record<string, unknown>,
      id: `camp_${Date.now()}`,
      created_at: new Date().toISOString()
    };
    setData((prev: AppData) => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: unknown) => {
    setData((prev: AppData) => ({
      ...prev,
      campaigns: prev.campaigns.map((c: unknown) => {
        const campaign = c as Record<string, unknown>;
        return campaign.id === id ? { ...campaign, ...updates as Record<string, unknown> } : campaign;
      })
    }));
  };

  const deleteCampaign = (id: string) => {
    setData((prev: AppData) => ({
      ...prev,
      campaigns: prev.campaigns.filter((c: unknown) => (c as Record<string, unknown>).id !== id),
      contacts: prev.contacts.map((contact: unknown) => {
        const c = contact as Record<string, unknown>;
        return {
          ...c,
          campaigns: (c.campaigns as unknown[] || []).filter((cp: unknown) => 
            (cp as Record<string, unknown>).campaignId !== id
          )
        };
      }),
      callLogs: prev.callLogs.filter((log: unknown) => 
        (log as Record<string, unknown>).campaignId !== id
      )
    }));
  };

  const addUSP = (usp: unknown) => {
    const newUSP = {
      ...usp as Record<string, unknown>,
      id: `usp_${Date.now()}`,
      usage_count: 0,
      created_at: new Date().toISOString()
    };
    setData((prev: AppData) => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: unknown) => {
    setData((prev: AppData) => ({
      ...prev,
      usps: prev.usps.map((u: unknown) => {
        const usp = u as Record<string, unknown>;
        return usp.id === id ? { ...usp, ...updates as Record<string, unknown> } : usp;
      })
    }));
  };

  const deleteUSP = (id: string) => {
    setData((prev: AppData) => ({
      ...prev,
      usps: prev.usps.filter((u: unknown) => (u as Record<string, unknown>).id !== id)
    }));
  };

  const addContacts = (contacts: unknown[], campaignId?: string) => {
    setData((prev: AppData) => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find((c: unknown) => 
        (c as Record<string, unknown>).id === campaignId
      ) as Record<string, unknown> | undefined : null;

      contacts.forEach((newContact: unknown) => {
        const nc = newContact as Record<string, unknown>;
        const existingIndex = updatedContacts.findIndex((c: unknown) => 
          (c as Record<string, unknown>).phone === nc.phone
        );
        
        if (existingIndex >= 0) {
          const existing = updatedContacts[existingIndex] as Record<string, unknown>;
          if (campaignId && campaign) {
            const campaigns = (existing.campaigns as unknown[] || []);
            const hasAssociation = campaigns.some((cp: unknown) => 
              (cp as Record<string, unknown>).campaignId === campaignId
            );
            if (!hasAssociation) {
              campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
              existing.campaigns = campaigns;
            }
          }
        } else {
          const contact = {
            ...nc,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      const updatedCampaigns = prev.campaigns.map((c: unknown) => {
        const camp = c as Record<string, unknown>;
        if (camp.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter((contact: unknown) => {
            const ct = contact as Record<string, unknown>;
            return (ct.campaigns as unknown[] || []).some((cp: unknown) => 
              (cp as Record<string, unknown>).campaignId === campaignId
            );
          });
          return {
            ...camp,
            total_contacts: contactsInCampaign.length,
            pending_count: contactsInCampaign.filter((contact: unknown) => {
              const ct = contact as Record<string, unknown>;
              const assoc = (ct.campaigns as unknown[] || []).find((cp: unknown) => 
                (cp as Record<string, unknown>).campaignId === campaignId
              ) as Record<string, unknown> | undefined;
              return assoc?.status === 'pending';
            }).length
          };
        }
        return camp;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find((c: unknown) => 
      (c as Record<string, unknown>).id === campaignId
    ) as Record<string, unknown> | undefined;
    if (!campaign) return;

    setTimeout(() => {
      setData((prev: AppData) => {
        const newCallLogs: unknown[] = [];
        const intents = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map((contact: unknown) => {
          const ct = contact as Record<string, unknown>;
          const campaignAssoc = (ct.campaigns as unknown[] || []).find((cp: unknown) => 
            (cp as Record<string, unknown>).campaignId === campaignId
          ) as Record<string, unknown> | undefined;
          
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60;
            
            const callLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contact_id: ct.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${ct.name}, this is Alex from our company...\n\n${ct.name}: Response here...`,
              recordingUrl: '#',
              aiSummary: 'Call summary here',
              intentLabel: intent,
              painPointsDiscussed: ((ct.pain_points as unknown[] || []).slice(0, 2)),
              uspsUsed: ((campaign.selected_usps as unknown[] || []).slice(0, 2))
            };

            newCallLogs.push(callLog);

            return {
              ...ct,
              campaigns: (ct.campaigns as unknown[] || []).map((cp: unknown) => {
                const c = cp as Record<string, unknown>;
                return c.campaignId === campaignId ? { ...c, status: 'completed' } : c;
              }),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return ct;
        });

        const updatedCampaigns = prev.campaigns.map((c: unknown) => {
          const camp = c as Record<string, unknown>;
          if (camp.id === campaignId) {
            return {
              ...camp,
              called_count: camp.total_contacts,
              pending_count: 0,
              status: 'completed'
            };
          }
          return camp;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';

export interface DataContextType {
  data: {
    campaigns: unknown[];
    contacts: unknown[];
    usps: unknown[];
    callLogs: unknown[];
  };
  addCampaign: (campaign: unknown) => void;
  updateCampaign: (id: string, updates: unknown) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: unknown) => void;
  updateUSP: (id: string, updates: unknown) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: unknown[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';
import type { Campaign } from '../../types';


interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

const handleSubmit = (e: React.FormEvent) => {
  e.preventDefault();
  addCampaign({
    name: formData.name,
    description: formData.description,
    status: formData.status,
    timezone: formData.timezone,
    call_window_start: formData.startTime,
    call_window_end: formData.endTime,
    pause_between_calls: 30,
    selected_usps: formData.selectedUSPs,
    total_contacts: 0,
    called_count: 0,
    pending_count: 0,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  } as Omit<Campaign, 'id' | 'createdAt'>);
  onClose();
};

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                 {data.usps.map((usp: unknown) => {
  const u = usp as { id: string; title: string; description: string };
  return (
    <label key={u.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
      <input
        type="checkbox"
        checked={formData.selectedUSPs.includes(u.id)}
        onChange={e => {
          if (e.target.checked) {
            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, u.id] });
          } else {
            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== u.id) });
          }
        }}
        className="mt-1"
      />
      <div>
        <div className="font-medium text-gray-900 text-sm">{u.title}</div>
        <div className="text-xs text-gray-500">{u.description}</div>
      </div>
    </label>
  );
})}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profile_summary: contactData.profilesummary || contactData['profile summary'] || '',
          pain_points: painPointsArray,
          status: 'pending' as const,
          campaign_id: campaignId,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

</files>
</file>

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X, ChevronDown, Upload, Users, FileText, Phone } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact, ContactWithCampaignStatus, CallLog, IntentLabel } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<ContactWithCampaignStatus[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [running, setRunning] = useState(false);
  const [selectedContactForTranscript, setSelectedContactForTranscript] = useState<ContactWithCampaignStatus | null>(null);
  const [showAddMenu, setShowAddMenu] = useState(false);
  const [showCSVUploadModal, setShowCSVUploadModal] = useState(false);
  const [showExistingContactsModal, setShowExistingContactsModal] = useState(false);
  const [csvFile, setCSVFile] = useState<File | null>(null);
  const [csvUploading, setCSVUploading] = useState(false);
  const [allContacts, setAllContacts] = useState<Contact[]>([]);
  const [selectedContactIds, setSelectedContactIds] = useState<string[]>([]);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts for this campaign via campaign_contacts
      const { data: campaignContactsData, error: campaignContactsError } = await supabase
        .from('campaign_contacts')
        .select(`
          id,
          status,
          outcome_status,
          created_at,
          updated_at,
          contacts (
            id,
            name,
            phone,
            company,
            email,
            profile_summary,
            pain_points,
            created_at,
            updated_at
          )
        `)
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (campaignContactsError) throw campaignContactsError;

      // Transform the data to flat structure
      const transformedContacts: ContactWithCampaignStatus[] = (campaignContactsData || [])
        .filter((cc) => cc.contacts)
        .map((cc) => {
          const contactData = Array.isArray(cc.contacts) ? cc.contacts[0] : cc.contacts;
          return {
            ...contactData,
            campaign_contact_id: cc.id,
            status: cc.status,
            outcome_status: cc.outcome_status
          };
        });

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const fetchAllContacts = async () => {
    try {
      const { data, error } = await supabase
        .from('contacts')
        .select('*')
        .order('name');

      if (error) throw error;
      
      // Filter out contacts already in this campaign
      const contactIdsInCampaign = contacts.map(c => c.id);
      const availableContacts = (data || []).filter(c => !contactIdsInCampaign.includes(c.id));
      
      setAllContacts(availableContacts);
    } catch (err) {
      console.error('Error fetching contacts:', err);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    // Update the contact table (not campaign_contacts)
    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    try {
      // First, create the contact
      const { data: contactData, error: contactError } = await supabase
        .from('contacts')
        .insert([{
          name: newContact.name,
          phone: newContact.phone,
          company: newContact.company || null,
          email: newContact.email || null,
          profile_summary: newContact.profile_summary || null,
          pain_points: newContact.pain_points 
            ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
            : []
        }])
        .select()
        .single();

      if (contactError) throw contactError;

      // Then, add to campaign via campaign_contacts
      const { error: campaignContactError } = await supabase
        .from('campaign_contacts')
        .insert([{
          campaign_id: id,
          contact_id: contactData.id,
          status: 'pending'
        }]);

      if (campaignContactError) throw campaignContactError;

      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    } catch (err) {
      console.error('Error adding contact:', err);
      alert('Error adding contact. Please try again.');
    }
  };

  const handleAddExistingContacts = async () => {
    if (!id || selectedContactIds.length === 0) {
      alert('Please select at least one contact');
      return;
    }

    try {
      const campaignContactsToInsert = selectedContactIds.map(contactId => ({
        campaign_id: id,
        contact_id: contactId,
        status: 'pending'
      }));

      const { error } = await supabase
        .from('campaign_contacts')
        .insert(campaignContactsToInsert);

      if (error) throw error;

      alert(`Successfully added ${selectedContactIds.length} contacts to campaign!`);
      setShowExistingContactsModal(false);
      setSelectedContactIds([]);
      await fetchCampaignData();
    } catch (err) {
      console.error('Error adding existing contacts:', err);
      alert('Error adding contacts. Some may already be in this campaign.');
    }
  };

  const handleDeleteContact = async (contact: ContactWithCampaignStatus) => {
    if (!window.confirm('Remove this contact from the campaign?')) return;

    // Delete from campaign_contacts (removes from campaign, but keeps contact)
    const { error } = await supabase
      .from('campaign_contacts')
      .delete()
      .eq('id', contact.campaign_contact_id);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const handleCSVUpload = async () => {
    if (!csvFile || !id) return;

    setCSVUploading(true);
    const reader = new FileReader();

    reader.onload = async (e) => {
      try {
        const text = e.target?.result as string;
        const lines = text.split('\n').filter(line => line.trim());
        
        const dataLines = lines.slice(1);
        
        const contactsToInsert = dataLines.map(line => {
          const fields = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
          const cleanFields = fields.map(field => field.replace(/^"|"$/g, '').trim());
          
          const [name, phone, company, email, profile_summary, pain_points] = cleanFields;
          
          return {
            name: name || '',
            phone: phone || '',
            company: company || null,
            email: email || null,
            profile_summary: profile_summary || null,
            pain_points: pain_points ? pain_points.split(';').map(p => p.trim()).filter(p => p) : []
          };
        }).filter(contact => contact.name && contact.phone);

        if (contactsToInsert.length === 0) {
          alert('No valid contacts found in CSV.');
          setCSVUploading(false);
          return;
        }

        // Insert contacts first
        const { data: insertedContacts, error: contactError } = await supabase
          .from('contacts')
          .insert(contactsToInsert)
          .select();

        if (contactError) throw contactError;

        // Then add to campaign via campaign_contacts
        const campaignContactsToInsert = insertedContacts.map(contact => ({
          campaign_id: id,
          contact_id: contact.id,
          status: 'pending'
        }));

        const { error: campaignContactError } = await supabase
          .from('campaign_contacts')
          .insert(campaignContactsToInsert);

        if (campaignContactError) throw campaignContactError;

        alert(`Successfully imported ${insertedContacts.length} contacts!`);
        setShowCSVUploadModal(false);
        setCSVFile(null);
        await fetchCampaignData();
      } catch (error) {
        console.error('Error uploading CSV:', error);
        alert('Error uploading contacts.');
      } finally {
        setCSVUploading(false);
      }
    };

    reader.readAsText(csvFile);
  };

  const runCampaign = async () => {
    if (!id || !campaign) return;
    
    const pendingContacts = contacts.filter(c => c.status === 'pending');
    
    if (pendingContacts.length === 0) {
      alert('No pending contacts to call');
      return;
    }

    if (!window.confirm(`Start calling ${pendingContacts.length} pending contacts?`)) {
      return;
    }

    setRunning(true);

    // Update to calling status via campaign_contacts
    for (const contact of pendingContacts) {
      await supabase
        .from('campaign_contacts')
        .update({ status: 'calling' })
        .eq('id', contact.campaign_contact_id);
    }

    await fetchCampaignData();

    setTimeout(async () => {
      const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
      
      for (const contact of pendingContacts) {
        const intent = intents[Math.floor(Math.random() * intents.length)];
        const outcomeStatus = outcomeStatuses[Math.floor(Math.random() * outcomeStatuses.length)];
        const duration = Math.floor(Math.random() * 180) + 60;
        
        const transcript = generateTranscript(contact, intent);
        const aiSummary = generateAISummary(contact, intent);
        
        // Create call log
        await supabase
          .from('call_logs')
          .insert([{
            contact_id: contact.id,
            campaign_id: id,
            campaign_contact_id: contact.campaign_contact_id,
            call_date: new Date().toISOString(),
            duration,
            transcript,
            recording_url: `https://example.com/recordings/${contact.id}-${Date.now()}.mp3`,
            ai_summary: aiSummary,
            intent_label: intent,
            pain_points_discussed: contact.pain_points.slice(0, 2),
            usps_used: campaign.selected_usps.slice(0, 2)
          }]);
        
        // Update campaign_contacts status
        await supabase
          .from('campaign_contacts')
          .update({ 
            status: 'completed',
            outcome_status: outcomeStatus
          })
          .eq('id', contact.campaign_contact_id);
      }

      setRunning(false);
      await fetchCampaignData();
      alert(`Campaign completed! Called ${pendingContacts.length} contacts.`);
    }, 10000);
  };

  const generateTranscript = (contact: ContactWithCampaignStatus, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'your business needs';
    const intros = [
      `AI: Hi ${contact.name}, this is Alex calling from our company. How are you today?`,
      `AI: Good morning ${contact.name}, my name is Alex. I hope I'm not catching you at a bad time?`,
      `AI: Hello ${contact.name}, this is Alex. Do you have a quick moment to chat?`
    ];
    const intro = intros[Math.floor(Math.random() * intros.length)];
    
    if (intent === 'positive') {
      return `${intro}\n\n${contact.name}: I'm doing well, thanks. What's this about?\n\nAI: I'm reaching out because I noticed you might be experiencing challenges with ${painPoint}. We've helped companies like ${contact.company || 'yours'} solve similar issues. Would you be interested in learning more?\n\n${contact.name}: Yes, actually! We've been struggling with that. Tell me more.\n\nAI: Great! Let me share how we've helped other clients improve their ${painPoint}. We have a solution that typically reduces these issues by 40-60% within the first month.\n\n${contact.name}: That sounds interesting. Can we schedule a demo?\n\nAI: Absolutely! I'd love to show you how it works. Let me get that set up for you right away.`;
    } else if (intent === 'no-interest') {
      return `${intro}\n\n${contact.name}: I'm busy right now. What is this regarding?\n\nAI: I understand you're busy. I'm calling about ${painPoint} solutions. We've worked with companies like ${contact.company || 'yours'} to help improve their operations.\n\n${contact.name}: We're not interested right now. We have other priorities.\n\nAI: I completely understand. Would it be helpful if I sent you some information you could review when you have time?\n\n${contact.name}: No thanks, we're all set for now.\n\nAI: No problem at all. Thank you for your time, ${contact.name}. Have a great day!`;
    } else {
      return `${intro}\n\n${contact.name}: Hi, I'm actually in the middle of something right now.\n\nAI: I completely understand. I'm calling about solutions for ${painPoint}. Does this sound like something that might be relevant to you?\n\n${contact.name}: Potentially, but this week is really hectic. Can you call back next week?\n\nAI: Absolutely! I'll make a note to follow up with you next week. What day works best for you?\n\n${contact.name}: Tuesday afternoon would be better.\n\nAI: Perfect! I'll reach out Tuesday afternoon. Thanks for your time, ${contact.name}!`;
    }
  };

  const generateAISummary = (contact: ContactWithCampaignStatus, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'operational challenges';
    
    if (intent === 'positive') {
      return `Positive conversation with ${contact.name}. Strong interest in our solution for ${painPoint}. Contact mentioned they've been actively looking for solutions. Ready to schedule demo. High potential lead.`;
    } else if (intent === 'no-interest') {
      return `Spoke with ${contact.name}. Currently not interested in solutions for ${painPoint}. Cited other priorities. Polite but firm. Not the right time. Recommend follow-up in 6 months.`;
    } else {
      return `Brief conversation with ${contact.name}. Interested but timing is not ideal. Currently dealing with busy period. Agreed to follow-up call next Tuesday afternoon. Moderate potential.`;
    }
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  const outcomeStatuses = [
    'no answer', 
    'not interested', 
    'receptionist', 
    'qualified', 
    'bad timing', 
    'invalid number', 
    'DNC', 
    'meeting scheduled', 
    'wrong person', 
    'disconnected'
  ];

  const getCallStatusColor = (status: string): string => {
    switch (status) {
      case 'completed':
        return 'bg-green-100 text-green-800';
      case 'calling':
        return 'bg-yellow-100 text-yellow-800';
      case '2nd call':
      case 'third call pending':
        return 'bg-purple-100 text-purple-800';
      case 'pending':
      default:
        return 'bg-blue-100 text-blue-800';
    }
  };

  const getOutcomeStatusColor = (status: string | null): string => {
    if (!status) return 'bg-gray-100 text-gray-500';
    
    switch (status) {
      case 'qualified':
      case 'meeting scheduled':
        return 'bg-green-100 text-green-800';
      case 'not interested':
      case 'DNC':
      case 'invalid number':
      case 'disconnected':
        return 'bg-red-100 text-red-800';
      case 'bad timing':
      case 'receptionist':
        return 'bg-yellow-100 text-yellow-800';
      case 'no answer':
      case 'wrong person':
        return 'bg-orange-100 text-orange-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button onClick={() => navigate('/campaigns')} className="text-primary hover:underline">
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header - keeping existing layout */}
      <div className="mb-8">
        <button onClick={() => navigate('/campaigns')} className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4">
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && <p className="text-gray-600">{campaign.description}</p>}
          </div>
          <div className="flex items-center gap-3">
            <button onClick={() => setShowSettings(true)} className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button onClick={runCampaign} disabled={running} className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50">
                <Play className="w-5 h-5" />
                {running ? 'Running...' : 'Run Campaign'}
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          
          <div className="relative">
            <div className="flex gap-2">
              <button onClick={() => setAddingRow(true)} className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm">
                <Plus className="w-4 h-4" />
                Add Contact
              </button>
              
              <button onClick={() => setShowAddMenu(!showAddMenu)} className="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                <span>More Options</span>
                <ChevronDown className="w-4 h-4" />
              </button>
            </div>

            {showAddMenu && (
              <>
                <div className="fixed inset-0 z-10" onClick={() => setShowAddMenu(false)} />
                <div className="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                  <button
                    onClick={() => {
                      setShowAddMenu(false);
                      setShowCSVUploadModal(true);
                    }}
                    className="w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors text-left"
                  >
                    <Upload className="w-4 h-4" />
                    <span>Upload from CSV</span>
                  </button>
                  <button
                    onClick={() => {
                      setShowAddMenu(false);
                      fetchAllContacts();
                      setShowExistingContactsModal(true);
                    }}
                    className="w-full flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors text-left"
                  >
                    <Users className="w-4 h-4" />
                    <span>Add from Existing Contacts</span>
                  </button>
                </div>
              </>
            )}
          </div>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full relative">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Call Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Outcome Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Call Result</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input type="text" value={newContact.name} onChange={(e) => setNewContact({ ...newContact, name: e.target.value })} placeholder="Name *" className="w-full px-2 py-1 border border-gray-300 rounded text-sm" autoFocus />
                  </td>
                  <td className="px-6 py-3">
                    <input type="text" value={newContact.phone} onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })} placeholder="Phone *" className="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
                  </td>
                  <td className="px-6 py-3">
                    <input type="text" value={newContact.company} onChange={(e) => setNewContact({ ...newContact, company: e.target.value })} placeholder="Company" className="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
                  </td>
                  <td className="px-6 py-3">
                    <input type="email" value={newContact.email} onChange={(e) => setNewContact({ ...newContact, email: e.target.value })} placeholder="Email" className="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
                  </td>
                  <td className="px-6 py-3">
                    <input type="text" value={newContact.profile_summary} onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })} placeholder="Profile Summary" className="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
                  </td>
                  <td className="px-6 py-3">
                    <input type="text" value={newContact.pain_points} onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })} placeholder="Pain points (use ; to separate)" className="w-full px-2 py-1 border border-gray-300 rounded text-sm" />
                  </td>
                  <td className="px-6 py-3"><span className="text-xs text-gray-500">pending</span></td>
                  <td className="px-6 py-3"><span className="text-xs text-gray-400">-</span></td>
                  <td className="px-6 py-3"><span className="text-xs text-gray-400">-</span></td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button onClick={handleAddContact} className="p-1 text-green-600 hover:bg-green-50 rounded">
                        <Check className="w-4 h-4" />
                      </button>
                      <button onClick={() => { setAddingRow(false); setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' }); }} className="p-1 text-red-600 hover:bg-red-50 rounded">
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={10} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.campaign_contact_id} className="hover:bg-gray-50 relative">
                    {/* Contact cells - keeping the same structure but using contact.id for editing */}
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input type="text" value={editValue} onChange={(e) => setEditValue(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleCellSave()} className="w-full px-2 py-1 border border-primary rounded text-sm" autoFocus />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded"><Check className="w-4 h-4" /></button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded"><X className="w-4 h-4" /></button>
                        </div>
                      ) : (
                        <div onClick={() => handleCellClick(contact.id, 'name', contact.name)} className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2">
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      <div onClick={() => handleCellClick(contact.id, 'phone', contact.phone)} className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2">
                        <span>{contact.phone}</span>
                        <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                      </div>
                    </td>

                    <td className="px-6 py-3">
                      <div onClick={() => handleCellClick(contact.id, 'company', contact.company || '')} className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2">
                        <span>{contact.company || '-'}</span>
                        <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                      </div>
                    </td>

                    <td className="px-6 py-3">
                      <div onClick={() => handleCellClick(contact.id, 'email', contact.email || '')} className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2">
                        <span>{contact.email || '-'}</span>
                        <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                      </div>
                    </td>

                    <td className="px-6 py-3">
                      <div className="relative group">
                        <div onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')} className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2">
                          <span className="truncate max-w-[200px]">{contact.profile_summary || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
                        </div>
                        {contact.profile_summary && (
                          <div className="fixed bg-white text-gray-900 text-xs rounded-lg p-3 shadow-xl border border-gray-200 z-[100] max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none whitespace-normal">
                            {contact.profile_summary}
                          </div>
                        )}
                      </div>
                    </td>

                    <td className="px-6 py-3">
                      <div className="relative group">
                        <div onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)} className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2">
                          <span className="truncate max-w-[200px] text-red-700">{contact.pain_points.length > 0 ? contact.pain_points.join('  ') : '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
                        </div>
                        {contact.pain_points.length > 0 && (
                          <div className="fixed bg-white text-gray-900 text-xs rounded-lg p-3 shadow-xl border border-gray-200 z-[100] max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
                            <div className="flex flex-wrap gap-2">
                              {contact.pain_points.map((point: string, idx: number) => (
                                <span key={idx} className="px-2 py-1 bg-red-100 text-red-700 rounded">{point}</span>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    </td>

                    <td className="px-6 py-3">
                      <button className={`px-2.5 py-1 rounded-full text-xs font-medium ${getCallStatusColor(contact.status)}`}>
                        {contact.status}
                      </button>
                    </td>

                    <td className="px-6 py-3">
                      {contact.outcome_status ? (
                        <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${getOutcomeStatusColor(contact.outcome_status)}`}>
                          {contact.outcome_status}
                        </span>
                      ) : (
                        <span className="text-gray-400 text-xs">-</span>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {contact.status === 'completed' ? (
                        <button onClick={() => setSelectedContactForTranscript(contact)} className="flex items-center gap-1 text-primary hover:underline text-sm">
                          <FileText className="w-4 h-4" />
                          View Call
                        </button>
                      ) : (
                        <span className="text-gray-400 text-xs">-</span>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <button onClick={() => handleDeleteContact(contact)} className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors">
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Modals */}
      {showSettings && <CampaignSettingsModal campaign={campaign} onClose={() => setShowSettings(false)} onUpdate={fetchCampaignData} />}
      
      {selectedContactForTranscript && <TranscriptModal contact={selectedContactForTranscript} campaignId={id!} onClose={() => setSelectedContactForTranscript(null)} />}

      {/* CSV Upload Modal */}
      {showCSVUploadModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl max-w-lg w-full p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-semibold text-gray-900">Upload Contacts from CSV</h2>
              <button onClick={() => { setShowCSVUploadModal(false); setCSVFile(null); }} className="text-gray-400 hover:text-gray-600">
                <X className="w-6 h-6" />
              </button>
            </div>
            <div className="space-y-4">
              <div>
                <p className="text-sm text-gray-600 mb-2">CSV should have the following columns (in order):</p>
                <ul className="text-xs text-gray-500 list-disc list-inside space-y-1 mb-4">
                  <li>Name (required)</li>
                  <li>Phone (required)</li>
                  <li>Company (optional)</li>
                  <li>Email (optional)</li>
                  <li>Profile Summary (optional)</li>
                  <li>Pain Points (optional, use ; to separate multiple)</li>
                </ul>
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Select CSV File</label>
                <input type="file" accept=".csv" onChange={(e) => setCSVFile(e.target.files?.[0] || null)} className="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none" />
              </div>
              {csvFile && (
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-3">
                  <p className="text-sm text-blue-800"><strong>Selected:</strong> {csvFile.name}</p>
                </div>
              )}
              <div className="flex gap-3 pt-4">
                <button onClick={() => { setShowCSVUploadModal(false); setCSVFile(null); }} className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                <button onClick={handleCSVUpload} disabled={!csvFile || csvUploading} className="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                  {csvUploading ? 'Uploading...' : 'Upload'}
                </button>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* Add Existing Contacts Modal */}
      {showExistingContactsModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto p-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-semibold text-gray-900">Add from Existing Contacts</h2>
              <button onClick={() => { setShowExistingContactsModal(false); setSelectedContactIds([]); }} className="text-gray-400 hover:text-gray-600">
                <X className="w-6 h-6" />
              </button>
            </div>

            {allContacts.length === 0 ? (
              <p className="text-center py-8 text-gray-500">No available contacts. All contacts are already in this campaign.</p>
            ) : (
              <>
                <div className="mb-4">
                  <p className="text-sm text-gray-600">Select contacts to add to this campaign:</p>
                </div>
                <div className="space-y-2 mb-6 max-h-96 overflow-y-auto">
                  {allContacts.map(contact => (
                    <label key={contact.id} className="flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                      <input
                        type="checkbox"
                        checked={selectedContactIds.includes(contact.id)}
                        onChange={(e) => {
                          if (e.target.checked) {
                            setSelectedContactIds([...selectedContactIds, contact.id]);
                          } else {
                            setSelectedContactIds(selectedContactIds.filter(id => id !== contact.id));
                          }
                        }}
                        className="w-4 h-4"
                      />
                      <div className="flex-1">
                        <p className="font-medium text-gray-900">{contact.name}</p>
                        <p className="text-sm text-gray-600">{contact.phone} {contact.company && ` ${contact.company}`}</p>
                      </div>
                    </label>
                  ))}
                </div>
                <div className="flex gap-3">
                  <button onClick={() => { setShowExistingContactsModal(false); setSelectedContactIds([]); }} className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">Cancel</button>
                  <button onClick={handleAddExistingContacts} disabled={selectedContactIds.length === 0} className="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Add {selectedContactIds.length > 0 ? `(${selectedContactIds.length})` : ''} Contacts
                  </button>
                </div>
              </>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

// Transcript Modal - same as before
interface TranscriptModalProps {
  contact: ContactWithCampaignStatus;
  campaignId: string;
  onClose: () => void;
}

const TranscriptModal = ({ contact, campaignId, onClose }: TranscriptModalProps) => {
  const [callLog, setCallLog] = useState<CallLog | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLog();
  }, []);

  const fetchCallLog = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .eq('campaign_id', campaignId)
        .order('call_date', { ascending: false })
        .limit(1)
        .single();

      if (error) throw error;
      setCallLog(data);
    } catch (err) {
      console.error('Error fetching call log:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive': return 'bg-green-100 text-green-800';
      case 'no-interest': return 'bg-red-100 text-red-800';
      case 'follow-up': return 'bg-yellow-100 text-yellow-800';
      default: return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {loading ? (
            <p className="text-center py-8 text-gray-500">Loading call details...</p>
          ) : !callLog ? (
            <p className="text-center py-8 text-gray-500">No call log found</p>
          ) : (
            <div className="space-y-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-gray-600">{new Date(callLog.call_date).toLocaleString()}  {Math.floor(callLog.duration / 60)}m {callLog.duration % 60}s</p>
                </div>
                <span className={`px-3 py-1 rounded-full text-sm font-medium ${getIntentColor(callLog.intent_label)}`}>{getIntentLabel(callLog.intent_label)}</span>
              </div>

              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Call Recording</h3>
                <div className="bg-gray-100 rounded-lg p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5 text-gray-600" />
                    <div>
                      <p className="text-sm font-medium text-gray-900">Recording Available</p>
                      <p className="text-xs text-gray-500">Duration: {Math.floor(callLog.duration / 60)}:{String(callLog.duration % 60).padStart(2, '0')}</p>
                    </div>
                  </div>
                  <a href={callLog.recording_url} target="_blank" rel="noopener noreferrer" className="px-4 py-2 bg-primary text-white text-sm rounded-lg hover:bg-primary-dark transition-colors">
                    Play Recording
                  </a>
                </div>
              </div>

              <div>
                <h3 className="font-semibold text-gray-900 mb-2">AI Summary</h3>
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p className="text-sm text-gray-800">{callLog.ai_summary}</p>
                </div>
              </div>

              {callLog.pain_points_discussed.length > 0 && (
                <div>
                  <h3 className="font-semibold text-gray-900 mb-2">Pain Points Discussed</h3>
                  <div className="flex flex-wrap gap-2">
                    {callLog.pain_points_discussed.map((point, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">{point}</span>
                    ))}
                  </div>
                </div>
              )}

              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Full Transcript</h3>
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-96 overflow-y-auto">
                  <pre className="text-sm text-gray-800 whitespace-pre-wrap font-sans">{callLog.transcript}</pre>
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button onClick={onClose} className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign } from '../types';

interface CampaignWithStats extends Campaign {
  total_contacts: number;
  pending_contacts: number;
  completed_contacts: number;
}

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);

      const { data: campaignsData, error } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Fetch contact counts for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: campaignContacts } = await supabase
            .from('campaign_contacts')
            .select('status')
            .eq('campaign_id', campaign.id);

          const total = campaignContacts?.length || 0;
          const pending = campaignContacts?.filter(cc => cc.status === 'pending').length || 0;
          const completed = campaignContacts?.filter(cc => cc.status === 'completed').length || 0;

          return {
            ...campaign,
            total_contacts: total,
            pending_contacts: pending,
            completed_contacts: completed
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Are you sure you want to delete this campaign? This will remove all associated data.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', id);

      if (error) throw error;

      await fetchCampaigns();
      setShowActionsMenu(null);
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Error deleting campaign. Please try again.');
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaigns...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="flex items-center justify-between mb-8">
        <div>
          <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
          <p className="text-gray-600">Manage your calling campaigns</p>
        </div>
        <button
          onClick={() => navigate('/campaigns/create')}
          className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
        >
          <Plus className="w-5 h-5" />
          New Campaign
        </button>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {campaigns.length === 0 ? (
          <div className="p-12 text-center">
            <p className="text-gray-500 mb-4">No campaigns yet</p>
            <button
              onClick={() => navigate('/campaigns/create')}
              className="text-primary hover:underline"
            >
              Create your first campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contacts</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pending</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Completed</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Created</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {campaigns.map((campaign) => (
                <tr
                  key={campaign.id}
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                  className="hover:bg-gray-50 cursor-pointer"
                >
                  <td className="px-6 py-4">
                    <div>
                      <div className="font-medium text-gray-900">{campaign.name}</div>
                      {campaign.description && (
                        <div className="text-sm text-gray-500 truncate max-w-md">{campaign.description}</div>
                      )}
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                      campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                      campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-gray-100 text-gray-800'
                    }`}>
                      {campaign.status}
                    </span>
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-900">{campaign.total_contacts}</td>
                  <td className="px-6 py-4 text-sm text-gray-900">{campaign.pending_contacts}</td>
                  <td className="px-6 py-4 text-sm text-gray-900">{campaign.completed_contacts}</td>
                  <td className="px-6 py-4 text-sm text-gray-500">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Clock, Trash2, Play } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign } from '../types';
import CreateCampaignModal from '../components/common/CreateCampaignModal';

interface CampaignWithStats extends Campaign {
  total_contacts: number;
  pending_contacts: number;
  completed_contacts: number;
}

const CampaignsPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [showCreateModal, setShowCreateModal] = useState(false);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);

      const { data: campaignsData, error } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Fetch contact counts for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: campaignContacts } = await supabase
            .from('campaign_contacts')
            .select('status')
            .eq('campaign_id', campaign.id);

          const total = campaignContacts?.length || 0;
          const pending = campaignContacts?.filter(cc => cc.status === 'pending').length || 0;
          const completed = campaignContacts?.filter(cc => cc.status === 'completed').length || 0;

          return {
            ...campaign,
            total_contacts: total,
            pending_contacts: pending,
            completed_contacts: completed
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const deleteCampaign = async (campaignId: string) => {
    if (!window.confirm('Are you sure you want to delete this campaign?')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaignId);

      if (error) throw error;

      await fetchCampaigns();
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Error deleting campaign. Please try again.');
    }
  };

  const runCampaign = (campaignId: string) => {
    navigate(`/campaigns/${campaignId}`);
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaigns...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="flex items-center justify-between mb-8">
        <div>
          <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
          <p className="text-gray-600">Manage your calling campaigns</p>
        </div>
        <button
          onClick={() => setShowCreateModal(true)}
          className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
        >
          <Plus className="w-5 h-5" />
          New Campaign
        </button>
      </div>

      {campaigns.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <p className="text-gray-500 mb-4">No campaigns yet</p>
          <button
            onClick={() => setShowCreateModal(true)}
            className="text-primary hover:underline"
          >
            Create your first campaign
          </button>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {campaigns.map((campaign) => (
            <div
              key={campaign.id}
              className="bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-shadow cursor-pointer"
              onClick={() => navigate(`/campaigns/${campaign.id}`)}
            >
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <h3 className="text-lg font-semibold text-gray-900 mb-1">{campaign.name}</h3>
                  {campaign.description && (
                    <p className="text-sm text-gray-600 line-clamp-2">{campaign.description}</p>
                  )}
                </div>
                <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                  campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                  campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                  'bg-gray-100 text-gray-800'
                }`}>
                  {campaign.status}
                </span>
              </div>

              <div className="grid grid-cols-3 gap-4 mb-4">
                <div>
                  <div className="text-2xl font-semibold text-gray-900">{campaign.total_contacts}</div>
                  <div className="text-xs text-gray-600">Total</div>
                </div>
                <div>
                  <div className="text-2xl font-semibold text-blue-900">{campaign.pending_contacts}</div>
                  <div className="text-xs text-blue-600">Pending</div>
                </div>
                <div>
                  <div className="text-2xl font-semibold text-green-900">{campaign.completed_contacts}</div>
                  <div className="text-xs text-green-600">Completed</div>
                </div>
              </div>

              <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
                <Clock className="w-4 h-4" />
                <span>{campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}</span>
              </div>

              <div className="flex items-center gap-2">
                {campaign.pending_contacts > 0 && (
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      runCampaign(campaign.id);
                    }}
                    className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
                  >
                    <Play className="w-4 h-4" />
                    Run Campaign
                  </button>
                )}
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    deleteCampaign(campaign.id);
                  }}
                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
              </div>
            </div>
          ))}
        </div>
      )}

      {showCreateModal && (
        <CreateCampaignModal
          onClose={() => {
            setShowCreateModal(false);
            fetchCampaigns();
          }}
        />
      )}
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Search, Phone, Mail, Building2, FileText, X, ChevronDown, ChevronUp } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, CallLog, IntentLabel } from '../types';

interface ContactWithCampaigns extends Contact {
  campaigns: Array<{
    campaign_id: string;
    campaign_name: string;
    status: string;
    outcome_status: string | null;
  }>;
  total_calls: number;
  last_call_date: string | null;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaigns[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaigns | null>(null);
  const [callHistory, setCallHistory] = useState<CallLog[]>([]);
  const [loadingCallHistory, setLoadingCallHistory] = useState(false);
  const [expandedContactId, setExpandedContactId] = useState<string | null>(null);

  useEffect(() => {
    fetchContacts();
  }, []);

  const fetchContacts = async () => {
    try {
      setLoading(true);

      // Fetch all contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .order('name');

      if (contactsError) throw contactsError;

      // Fetch campaign associations for each contact
      const contactsWithCampaigns: ContactWithCampaigns[] = await Promise.all(
        (contactsData || []).map(async (contact) => {
          // Get campaigns this contact is in
          const { data: campaignContactsData } = await supabase
            .from('campaign_contacts')
            .select(`
              campaign_id,
              status,
              outcome_status,
              campaigns (
                name
              )
            `)
            .eq('contact_id', contact.id);

          interface CampaignContactData {
            campaign_id: string;
            status: string;
            outcome_status: string | null;
            campaigns: Array<{ name: string }> | null;
          }

          const campaigns = (campaignContactsData || []).map((cc: CampaignContactData) => ({
            campaign_id: cc.campaign_id,
            campaign_name: (Array.isArray(cc.campaigns) && cc.campaigns[0]?.name) || 'Unknown Campaign',
            status: cc.status,
            outcome_status: cc.outcome_status
          }));

          // Get call count and last call date
          const { data: callLogsData } = await supabase
            .from('call_logs')
            .select('call_date')
            .eq('contact_id', contact.id)
            .order('call_date', { ascending: false });

          return {
            ...contact,
            campaigns,
            total_calls: callLogsData?.length || 0,
            last_call_date: callLogsData?.[0]?.call_date || null
          };
        })
      );

      setContacts(contactsWithCampaigns);
    } catch (err) {
      console.error('Error fetching contacts:', err);
    } finally {
      setLoading(false);
    }
  };

  const fetchCallHistory = async (contactId: string) => {
    try {
      setLoadingCallHistory(true);

      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contactId)
        .order('call_date', { ascending: false });

      if (error) throw error;

      setCallHistory(data || []);
    } catch (err) {
      console.error('Error fetching call history:', err);
    } finally {
      setLoadingCallHistory(false);
    }
  };

  const handleContactClick = async (contact: ContactWithCampaigns) => {
    setSelectedContact(contact);
    await fetchCallHistory(contact.id);
  };

  const filteredContacts = contacts.filter(contact =>
    contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
    contact.phone.toLowerCase().includes(searchQuery.toLowerCase()) ||
    contact.company?.toLowerCase().includes(searchQuery.toLowerCase()) ||
    contact.email?.toLowerCase().includes(searchQuery.toLowerCase())
  );

  const getStatusColor = (status: string): string => {
    switch (status) {
      case 'completed':
        return 'bg-green-100 text-green-800';
      case 'calling':
        return 'bg-yellow-100 text-yellow-800';
      case 'pending':
        return 'bg-blue-100 text-blue-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getOutcomeColor = (outcome: string | null): string => {
    if (!outcome) return 'bg-gray-100 text-gray-500';
    
    switch (outcome) {
      case 'qualified':
      case 'meeting scheduled':
        return 'bg-green-100 text-green-800';
      case 'not interested':
      case 'DNC':
        return 'bg-red-100 text-red-800';
      case 'bad timing':
      case 'receptionist':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading contacts...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
        <p className="text-gray-600">Manage all your contacts across campaigns</p>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-3 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{contacts.length}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">
            {contacts.reduce((sum, c) => sum + c.campaigns.length, 0)}
          </div>
          <div className="text-sm text-blue-600">Campaign Associations</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">
            {contacts.reduce((sum, c) => sum + c.total_calls, 0)}
          </div>
          <div className="text-sm text-green-600">Total Calls</div>
        </div>
      </div>

      {/* Search */}
      <div className="bg-white rounded-xl border border-gray-200 mb-6 p-4">
        <div className="relative">
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
          <input
            type="text"
            placeholder="Search contacts by name, phone, company, or email..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
          />
        </div>
      </div>

      {/* Contacts List */}
      <div className="bg-white rounded-xl border border-gray-200">
        <div className="divide-y divide-gray-200">
          {filteredContacts.length === 0 ? (
            <div className="p-12 text-center text-gray-500">
              No contacts found
            </div>
          ) : (
            filteredContacts.map((contact) => (
              <div key={contact.id} className="p-6 hover:bg-gray-50 transition-colors">
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h3 className="text-lg font-semibold text-gray-900">{contact.name}</h3>
                      {contact.total_calls > 0 && (
                        <span className="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">
                          {contact.total_calls} {contact.total_calls === 1 ? 'call' : 'calls'}
                        </span>
                      )}
                    </div>

                    <div className="grid grid-cols-2 gap-x-6 gap-y-2 mb-3">
                      <div className="flex items-center gap-2 text-sm text-gray-600">
                        <Phone className="w-4 h-4" />
                        {contact.phone}
                      </div>
                      {contact.email && (
                        <div className="flex items-center gap-2 text-sm text-gray-600">
                          <Mail className="w-4 h-4" />
                          {contact.email}
                        </div>
                      )}
                      {contact.company && (
                        <div className="flex items-center gap-2 text-sm text-gray-600">
                          <Building2 className="w-4 h-4" />
                          {contact.company}
                        </div>
                      )}
                      {contact.last_call_date && (
                        <div className="text-sm text-gray-600">
                          Last call: {new Date(contact.last_call_date).toLocaleDateString()}
                        </div>
                      )}
                    </div>

                    {/* Campaigns */}
                    {contact.campaigns.length > 0 && (
                      <div className="mb-3">
                        <button
                          onClick={() => setExpandedContactId(expandedContactId === contact.id ? null : contact.id)}
                          className="flex items-center gap-2 text-sm font-medium text-gray-700 hover:text-gray-900"
                        >
                          {expandedContactId === contact.id ? (
                            <ChevronUp className="w-4 h-4" />
                          ) : (
                            <ChevronDown className="w-4 h-4" />
                          )}
                          {contact.campaigns.length} {contact.campaigns.length === 1 ? 'Campaign' : 'Campaigns'}
                        </button>

                        {expandedContactId === contact.id && (
                          <div className="mt-3 space-y-2 pl-6">
                            {contact.campaigns.map((campaign, idx) => (
                              <div key={idx} className="flex items-center gap-2 text-sm">
                                <span className="font-medium text-gray-900">{campaign.campaign_name}</span>
                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(campaign.status)}`}>
                                  {campaign.status}
                                </span>
                                {campaign.outcome_status && (
                                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${getOutcomeColor(campaign.outcome_status)}`}>
                                    {campaign.outcome_status}
                                  </span>
                                )}
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    )}

                    {/* Pain Points Preview */}
                    {contact.pain_points.length > 0 && (
                      <div className="flex flex-wrap gap-2">
                        {contact.pain_points.slice(0, 3).map((point, idx) => (
                          <span key={idx} className="px-2 py-1 bg-red-50 text-red-700 text-xs rounded">
                            {point}
                          </span>
                        ))}
                        {contact.pain_points.length > 3 && (
                          <span className="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">
                            +{contact.pain_points.length - 3} more
                          </span>
                        )}
                      </div>
                    )}
                  </div>

                  <button
                    onClick={() => handleContactClick(contact)}
                    className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
                  >
                    <FileText className="w-4 h-4" />
                    View History
                  </button>
                </div>
              </div>
            ))
          )}
        </div>
      </div>

      {/* Contact Detail Modal with Call History */}
      {selectedContact && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div className="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between">
              <div>
                <h2 className="text-2xl font-semibold text-gray-900">{selectedContact.name}</h2>
                <div className="flex items-center gap-4 mt-2 text-sm text-gray-600">
                  <span className="flex items-center gap-1">
                    <Phone className="w-4 h-4" />
                    {selectedContact.phone}
                  </span>
                  {selectedContact.email && (
                    <span className="flex items-center gap-1">
                      <Mail className="w-4 h-4" />
                      {selectedContact.email}
                    </span>
                  )}
                  {selectedContact.company && (
                    <span className="flex items-center gap-1">
                      <Building2 className="w-4 h-4" />
                      {selectedContact.company}
                    </span>
                  )}
                </div>
              </div>
              <button onClick={() => setSelectedContact(null)} className="text-gray-400 hover:text-gray-600">
                <X className="w-6 h-6" />
              </button>
            </div>

            <div className="p-6">
              {/* Contact Info */}
              {selectedContact.profile_summary && (
                <div className="mb-6">
                  <h3 className="font-semibold text-gray-900 mb-2">Profile Summary</h3>
                  <p className="text-sm text-gray-700">{selectedContact.profile_summary}</p>
                </div>
              )}

              {selectedContact.pain_points.length > 0 && (
                <div className="mb-6">
                  <h3 className="font-semibold text-gray-900 mb-2">Pain Points</h3>
                  <div className="flex flex-wrap gap-2">
                    {selectedContact.pain_points.map((point, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {point}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Campaigns */}
              {selectedContact.campaigns.length > 0 && (
                <div className="mb-6">
                  <h3 className="font-semibold text-gray-900 mb-3">Campaigns ({selectedContact.campaigns.length})</h3>
                  <div className="space-y-2">
                    {selectedContact.campaigns.map((campaign, idx) => (
                      <div key={idx} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span className="font-medium text-gray-900">{campaign.campaign_name}</span>
                        <div className="flex items-center gap-2">
                          <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(campaign.status)}`}>
                            {campaign.status}
                          </span>
                          {campaign.outcome_status && (
                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getOutcomeColor(campaign.outcome_status)}`}>
                              {campaign.outcome_status}
                            </span>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Call History */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-3">
                  Call History ({callHistory.length})
                </h3>

                {loadingCallHistory ? (
                  <p className="text-center py-8 text-gray-500">Loading call history...</p>
                ) : callHistory.length === 0 ? (
                  <p className="text-center py-8 text-gray-500">No calls yet</p>
                ) : (
                  <div className="space-y-4">
                    {callHistory.map((call) => (
                      <CallHistoryItem 
                        key={call.id} 
                        call={call}
                        getIntentColor={getIntentColor}
                        getIntentLabel={getIntentLabel}
                      />
                    ))}
                  </div>
                )}
              </div>
            </div>

            <div className="sticky bottom-0 bg-white border-t border-gray-200 p-6 flex justify-end">
              <button
                onClick={() => setSelectedContact(null)}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

// Call History Item Component
interface CallHistoryItemProps {
  call: CallLog;
  getIntentColor: (intent: IntentLabel) => string;
  getIntentLabel: (intent: IntentLabel) => string;
}

const CallHistoryItem = ({ call, getIntentColor, getIntentLabel }: CallHistoryItemProps) => {
  const [showTranscript, setShowTranscript] = useState(false);
  const [campaignName, setCampaignName] = useState<string>('');

  useEffect(() => {
    let mounted = true;
    
    const fetchCampaignName = async () => {
      const { data } = await supabase
        .from('campaigns')
        .select('name')
        .eq('id', call.campaign_id)
        .single();

      if (data && mounted) {
        setCampaignName(data.name);
      }
    };

    fetchCampaignName();

    return () => {
      mounted = false;
    };
  }, [call.campaign_id]);

  return (
    <div className="border border-gray-200 rounded-lg p-4">
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-3">
          <span className="text-sm font-medium text-gray-900">
            {new Date(call.call_date).toLocaleDateString()} at {new Date(call.call_date).toLocaleTimeString()}
          </span>
          <span className={`px-2 py-1 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
            {getIntentLabel(call.intent_label)}
          </span>
        </div>
        <span className="text-xs text-gray-500">
          {Math.floor(call.duration / 60)}m {call.duration % 60}s
        </span>
      </div>

      {campaignName && (
        <p className="text-sm text-gray-600 mb-2">Campaign: {campaignName}</p>
      )}

      <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3">
        <p className="text-sm text-gray-800">{call.ai_summary}</p>
      </div>

      {call.pain_points_discussed.length > 0 && (
        <div className="mb-3">
          <p className="text-xs font-medium text-gray-600 mb-2">Pain Points Discussed:</p>
          <div className="flex flex-wrap gap-2">
            {call.pain_points_discussed.map((point, idx) => (
              <span key={idx} className="px-2 py-1 bg-red-100 text-red-700 text-xs rounded">
                {point}
              </span>
            ))}
          </div>
        </div>
      )}

      <div className="flex gap-2">
        <button
          onClick={() => setShowTranscript(!showTranscript)}
          className="text-sm text-primary hover:underline"
        >
          {showTranscript ? 'Hide' : 'View'} Transcript
        </button>
        <span className="text-gray-300"></span>
        <a
          href={call.recording_url}
          target="_blank"
          rel="noopener noreferrer"
          className="text-sm text-primary hover:underline"
        >
          Play Recording
        </a>
      </div>

      {showTranscript && (
        <div className="mt-3 bg-gray-50 border border-gray-200 rounded-lg p-3 max-h-64 overflow-y-auto">
          <pre className="text-xs text-gray-800 whitespace-pre-wrap font-sans">{call.transcript}</pre>
        </div>
      )}
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Phone, Users, TrendingUp, Clock } from 'lucide-react';
import { supabase } from '../lib/supabase';

interface DashboardStats {
  totalCampaigns: number;
  activeCampaigns: number;
  totalContacts: number;
  totalCalls: number;
  pendingCalls: number;
  completedCalls: number;
}

interface CampaignWithContactStats {
  id: string;
  name: string;
  description: string | null;
  status: string;
  created_at: string;
  totalContacts: number;
  pendingContacts: number;
}

const OverviewPage = () => {
  const navigate = useNavigate();
  const [stats, setStats] = useState<DashboardStats>({
    totalCampaigns: 0,
    activeCampaigns: 0,
    totalContacts: 0,
    totalCalls: 0,
    pendingCalls: 0,
    completedCalls: 0
  });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('status');

      const totalCampaigns = campaignsData?.length || 0;
      const activeCampaigns = campaignsData?.filter(c => c.status === 'active').length || 0;

      // Fetch contacts
      const { data: contactsData } = await supabase
        .from('contacts')
        .select('id');

      const totalContacts = contactsData?.length || 0;

      // Fetch campaign_contacts for call stats
      const { data: campaignContactsData } = await supabase
        .from('campaign_contacts')
        .select('status');

      const pendingCalls = campaignContactsData?.filter(cc => cc.status === 'pending').length || 0;
      const completedCalls = campaignContactsData?.filter(cc => cc.status === 'completed').length || 0;

      // Fetch call logs
      const { data: callLogsData } = await supabase
        .from('call_logs')
        .select('id');

      const totalCalls = callLogsData?.length || 0;

      setStats({
        totalCampaigns,
        activeCampaigns,
        totalContacts,
        totalCalls,
        pendingCalls,
        completedCalls
      });
    } catch (err) {
      console.error('Error fetching dashboard data:', err);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading dashboard...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Your calling campaign dashboard</p>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center justify-between mb-4">
            <div className="p-3 bg-purple-100 rounded-lg">
              <Phone className="w-6 h-6 text-purple-600" />
            </div>
          </div>
          <div className="text-2xl font-semibold text-gray-900 mb-1">{stats.totalCampaigns}</div>
          <div className="text-sm text-gray-600">Total Campaigns</div>
          <div className="text-xs text-gray-500 mt-2">{stats.activeCampaigns} active</div>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center justify-between mb-4">
            <div className="p-3 bg-blue-100 rounded-lg">
              <Users className="w-6 h-6 text-blue-600" />
            </div>
          </div>
          <div className="text-2xl font-semibold text-gray-900 mb-1">{stats.totalContacts}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center justify-between mb-4">
            <div className="p-3 bg-green-100 rounded-lg">
              <TrendingUp className="w-6 h-6 text-green-600" />
            </div>
          </div>
          <div className="text-2xl font-semibold text-gray-900 mb-1">{stats.totalCalls}</div>
          <div className="text-sm text-gray-600">Total Calls Made</div>
          <div className="text-xs text-gray-500 mt-2">{stats.completedCalls} completed</div>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center justify-between mb-4">
            <div className="p-3 bg-yellow-100 rounded-lg">
              <Clock className="w-6 h-6 text-yellow-600" />
            </div>
          </div>
          <div className="text-2xl font-semibold text-gray-900 mb-1">{stats.pendingCalls}</div>
          <div className="text-sm text-gray-600">Pending Calls</div>
        </div>
      </div>

      {/* Quick Actions */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div className="bg-gradient-to-br from-primary to-primary-dark rounded-xl p-6 text-white">
          <h3 className="text-xl font-semibold mb-2">Start a New Campaign</h3>
          <p className="text-white/80 mb-4">Create a new calling campaign and add contacts to get started</p>
          <button
            onClick={() => navigate('/campaigns/create')}
            className="px-4 py-2 bg-white text-primary rounded-lg hover:bg-gray-100 transition-colors font-medium"
          >
            Create Campaign
          </button>
        </div>

        <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white">
          <h3 className="text-xl font-semibold mb-2">Manage Contacts</h3>
          <p className="text-white/80 mb-4">View and organize all your contacts across campaigns</p>
          <button
            onClick={() => navigate('/contacts')}
            className="px-4 py-2 bg-white text-blue-600 rounded-lg hover:bg-gray-100 transition-colors font-medium"
          >
            View Contacts
          </button>
        </div>
      </div>

      {/* Recent Campaigns */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-xl font-semibold text-gray-900">Recent Campaigns</h2>
          <button
            onClick={() => navigate('/campaigns')}
            className="text-sm text-primary hover:underline"
          >
            View All
          </button>
        </div>
        
        <RecentCampaignsList />
      </div>
    </div>
  );
};

// Recent Campaigns List Component
const RecentCampaignsList = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithContactStats[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchRecentCampaigns();
  }, []);

  const fetchRecentCampaigns = async () => {
    try {
      const { data, error } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(5);

      if (error) throw error;

      // Fetch contact counts for each campaign
      const campaignsWithStats = await Promise.all(
        (data || []).map(async (campaign) => {
          const { data: campaignContacts } = await supabase
            .from('campaign_contacts')
            .select('status')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            totalContacts: campaignContacts?.length || 0,
            pendingContacts: campaignContacts?.filter(cc => cc.status === 'pending').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching recent campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return <div className="text-center py-8 text-gray-500">Loading campaigns...</div>;
  }

  if (campaigns.length === 0) {
    return (
      <div className="text-center py-8 text-gray-500">
        No campaigns yet. Create your first campaign to get started.
      </div>
    );
  }

  return (
    <div className="space-y-3">
      {campaigns.map((campaign) => (
        <div
          key={campaign.id}
          onClick={() => navigate(`/campaigns/${campaign.id}`)}
          className="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors"
        >
          <div className="flex-1">
            <div className="flex items-center gap-3">
              <h3 className="font-medium text-gray-900">{campaign.name}</h3>
              <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                'bg-gray-100 text-gray-800'
              }`}>
                {campaign.status}
              </span>
            </div>
            {campaign.description && (
              <p className="text-sm text-gray-600 mt-1">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-6 text-sm">
            <div className="text-center">
              <div className="font-semibold text-gray-900">{campaign.totalContacts}</div>
              <div className="text-gray-500">Contacts</div>
            </div>
            <div className="text-center">
              <div className="font-semibold text-blue-900">{campaign.pendingContacts}</div>
              <div className="text-blue-600">Pending</div>
            </div>
          </div>
        </div>
      ))}
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const deleteUSP = async (id: string) => {
    if (!window.confirm('Are you sure you want to delete this USP?')) return;

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Error deleting USP');
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading USPs...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="flex items-center justify-between mb-8">
        <div>
          <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
          <p className="text-gray-600">Manage your unique selling propositions</p>
        </div>
        <button
          onClick={() => {
            setEditingUSP(null);
            setShowModal(true);
          }}
          className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
        >
          <Plus className="w-5 h-5" />
          Add USP
        </button>
      </div>

      {usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <p className="text-gray-500 mb-4">No USPs yet</p>
          <button
            onClick={() => setShowModal(true)}
            className="text-primary hover:underline"
          >
            Create your first USP
          </button>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {usps.map((usp) => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-3">
                <h3 className="text-lg font-semibold text-gray-900 flex-1">{usp.title}</h3>
                <div className="flex items-center gap-1">
                  <button
                    onClick={() => {
                      setEditingUSP(usp);
                      setShowModal(true);
                    }}
                    className="p-1 text-gray-600 hover:bg-gray-100 rounded transition-colors"
                  >
                    <Edit2 className="w-4 h-4" />
                  </button>
                  <button
                    onClick={() => deleteUSP(usp.id)}
                    className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                </div>
              </div>

              <p className="text-sm text-gray-600 mb-3">{usp.description}</p>

              {usp.category && (
                <div className="mb-3">
                  <span className="px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded">
                    {usp.category}
                  </span>
                </div>
              )}

              {usp.pain_point_tags && usp.pain_point_tags.length > 0 && (
                <div className="flex flex-wrap gap-2 mb-3">
                  {usp.pain_point_tags.map((tag: string, idx: number) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {tag}
                    </span>
                  ))}
                </div>
              )}

              <div className="text-sm text-gray-500">
                Used in {usp.usage_count || 0} campaigns
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSave={() => {
            fetchUSPs();
            setShowModal(false);
            setEditingUSP(null);
          }}
        />
      )}
    </div>
  );
};

// USP Modal Component
interface USPModalProps {
  usp: USP | null;
  onClose: () => void;
  onSave: () => void;
}

const USPModal = ({ usp, onClose, onSave }: USPModalProps) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    category: usp?.category || '',
    pain_point_tags: (usp?.pain_point_tags || []) as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter((t: string) => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!formData.title || !formData.description) {
      alert('Title and description are required');
      return;
    }

    try {
      setSaving(true);

      if (usp) {
        // Update existing USP
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            category: formData.category || null,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new USP
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            category: formData.category || null,
            pain_point_tags: formData.pain_point_tags,
            usage_count: 0
          }]);

        if (error) throw error;
      }

      onSave();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Error saving USP. Please try again.');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full p-6">
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Create New USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Title *
            </label>
            <input
              type="text"
              value={formData.title}
              onChange={(e) => setFormData({ ...formData, title: e.target.value })}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Description *
            </label>
            <textarea
              value={formData.description}
              onChange={(e) => setFormData({ ...formData, description: e.target.value })}
              rows={4}
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Category
            </label>
            <input
              type="text"
              value={formData.category}
              onChange={(e) => setFormData({ ...formData, category: e.target.value })}
              placeholder="e.g., Cost Savings, Efficiency, Security"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Pain Point Tags
            </label>
            <div className="flex gap-2 mb-2">
              <input
                type="text"
                value={tagInput}
                onChange={(e) => setTagInput(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    handleAddTag();
                  }
                }}
                placeholder="Add a pain point tag"
                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
              />
              <button
                type="button"
                onClick={handleAddTag}
                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
              >
                Add
              </button>
            </div>
            <div className="flex flex-wrap gap-2">
              {formData.pain_point_tags.map((tag: string) => (
                <span 
                  key={tag}
                  className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                >
                  {tag}
                  <button
                    type="button"
                    onClick={() => handleRemoveTag(tag)}
                    className="hover:text-red-900"
                  >
                    <X className="w-3 h-3" />
                  </button>
                </span>
              ))}
            </div>
          </div>

          <div className="flex gap-3 pt-4">
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Create USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
// Updated types to reflect new database structure

export type CampaignStatus = 'active' | 'paused' | 'completed';

export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  total_contacts: number;
  called_count: number;
  pending_count: number;
  created_at: string;
  updated_at: string;
}

// Contact is now independent of campaigns
export interface Contact {
  id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  created_at: string;
  updated_at: string;
}

// New junction table type
export interface CampaignContact {
  id: string;
  campaign_id: string;
  contact_id: string;
  status: string; // pending, calling, completed, 2nd call, third call pending
  outcome_status: string | null; // no answer, qualified, etc.
  created_at: string;
  updated_at: string;
}

// Extended type for when we need contact info with campaign status
export interface ContactWithCampaignStatus extends Contact {
  campaign_contact_id: string; // The campaign_contacts.id
  status: string;
  outcome_status: string | null;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  campaign_contact_id: string | null;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  category: string | null;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="23jan2026-2.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
23jan2026.xml
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addCampaign({
      name: formData.name,
      description: formData.description,
      status: formData.status,
      callWindow: {
        startTime: formData.startTime,
        endTime: formData.endTime,
        timezone: formData.timezone
      },
      selectedUSPs: formData.selectedUSPs,
      totalContacts: 0,
      calledCount: 0,
      pendingCount: 0
    });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {data.usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selectedUSPs.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, usp.id] });
                          } else {
                            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

interface ParsedContact {
  name: string;
  phone: string;
  company: string;
  email: string;
  profileSummary: string;
  painPoints: string[];
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      // Parse CSV
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      // Check required fields
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts: ParsedContact[] = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        // Handle pain points (could be comma-separated or single)
        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profileSummary: contactData.profilesummary || contactData['profile summary'] || '',
          painPoints: painPointsArray
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData, CallStatus, IntentLabel } from '../types';
import { DataContext } from './DataContextDefinition';

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: Omit<Campaign, 'id' | 'createdAt'>) => {
    const newCampaign: Campaign = {
      ...campaign,
      id: `camp_${Date.now()}`,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: Partial<Campaign>) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.map(c => c.id === id ? { ...c, ...updates } : c)
    }));
  };

  const deleteCampaign = (id: string) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.filter(c => c.id !== id),
      contacts: prev.contacts.map(contact => ({
        ...contact,
        campaigns: contact.campaigns.filter(cp => cp.campaignId !== id)
      })),
      callLogs: prev.callLogs.filter(log => log.campaignId !== id)
    }));
  };

  const addUSP = (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => {
    const newUSP: USP = {
      ...usp,
      id: `usp_${Date.now()}`,
      usageCount: 0,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: Partial<USP>) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.map(u => u.id === id ? { ...u, ...updates } : u)
    }));
  };

  const deleteUSP = (id: string) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.filter(u => u.id !== id)
    }));
  };

  const addContacts = (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => {
    setData(prev => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find(c => c.id === campaignId) : null;

      contacts.forEach(newContact => {
        const existingIndex = updatedContacts.findIndex(c => c.phone === newContact.phone);
        
        if (existingIndex >= 0) {
          // Merge with existing contact
          const existing = updatedContacts[existingIndex];
          if (campaignId && campaign) {
            const hasAssociation = existing.campaigns.some(cp => cp.campaignId === campaignId);
            if (!hasAssociation) {
              existing.campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
            }
          }
        } else {
          // Add new contact
          const contact: Contact = {
            ...newContact,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      // Update campaign counts
      const updatedCampaigns = prev.campaigns.map(c => {
        if (c.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter(contact =>
            contact.campaigns.some(cp => cp.campaignId === campaignId)
          );
          return {
            ...c,
            totalContacts: contactsInCampaign.length,
            pendingCount: contactsInCampaign.filter(contact =>
              contact.campaigns.find(cp => cp.campaignId === campaignId)?.status === 'pending'
            ).length
          };
        }
        return c;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find(c => c.id === campaignId);
    if (!campaign) return;

    // Simulate calls after 10 seconds
    setTimeout(() => {
      setData(prev => {
        const newCallLogs: CallLog[] = [];
        const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map(contact => {
          const campaignAssoc = contact.campaigns.find(cp => cp.campaignId === campaignId);
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60; // 1-4 minutes
            
            const callLog: CallLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contactId: contact.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${contact.name}, this is Alex from our company calling about ${contact.painPoints[0] || 'your business needs'}...\n\n${contact.name}: ${intent === 'positive' ? 'Yes, I\'m interested! Tell me more.' : intent === 'no-interest' ? 'Not interested, thanks.' : 'Can you call back next week? We\'re busy right now.'}\n\nAI: ${intent === 'positive' ? 'Great! Let me share how we can help...' : intent === 'no-interest' ? 'I understand. Thank you for your time.' : 'Absolutely! I\'ll follow up next week.'}`,
              recordingUrl: '#',
              aiSummary: intent === 'positive' 
                ? `Prospect showed strong interest. Mentioned challenges with ${contact.painPoints[0] || 'their current solution'}. Ready for next steps.`
                : intent === 'no-interest'
                ? `Prospect declined. Not the right time. No clear pain points identified.`
                : `Prospect interested but needs more time. Requested follow-up next week.`,
              intentLabel: intent,
              painPointsDiscussed: contact.painPoints.slice(0, 2),
              uspsUsed: campaign.selectedUSPs.slice(0, 2)
            };

            newCallLogs.push(callLog);

            return {
              ...contact,
              campaigns: contact.campaigns.map(cp =>
                cp.campaignId === campaignId ? { ...cp, status: 'completed' as CallStatus } : cp
              ),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return contact;
        });

        const updatedCampaigns = prev.campaigns.map(c => {
          if (c.id === campaignId) {
            return {
              ...c,
              calledCount: c.totalContacts,
              pendingCount: 0,
              status: 'completed' as const
            };
          }
          return c;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData } from '../types';

export interface DataContextType {
  data: AppData;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'createdAt'>) => void;
  updateCampaign: (id: string, updates: Partial<Campaign>) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => void;
  updateUSP: (id: string, updates: Partial<USP>) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X, Phone, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact, CallLog, IntentLabel } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [running, setRunning] = useState(false);
  const [selectedContactForTranscript, setSelectedContactForTranscript] = useState<Contact | null>(null);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!id || !campaign) return;
    
    const pendingContacts = contacts.filter(c => c.status === 'pending');
    
    if (pendingContacts.length === 0) {
      alert('No pending contacts to call');
      return;
    }

    if (!window.confirm(`Start calling ${pendingContacts.length} pending contacts? (Simulated for 10 seconds)`)) {
      return;
    }

    setRunning(true);

    // Update all pending contacts to 'calling' status
    for (const contact of pendingContacts) {
      await supabase
        .from('contacts')
        .update({ status: 'calling' })
        .eq('id', contact.id);
    }

    await fetchCampaignData();

    // Simulate calls after 10 seconds
    setTimeout(async () => {
      const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
      
      for (const contact of pendingContacts) {
        // Random intent
        const intent = intents[Math.floor(Math.random() * intents.length)];
        
        // Random duration between 60-240 seconds (1-4 minutes)
        const duration = Math.floor(Math.random() * 180) + 60;
        
        // Generate transcript
        const transcript = generateTranscript(contact, intent);
        
        // Generate AI summary
        const aiSummary = generateAISummary(contact, intent);
        
        // Create call log
        await supabase
          .from('call_logs')
          .insert([{
            contact_id: contact.id,
            campaign_id: id,
            call_date: new Date().toISOString(),
            duration,
            transcript,
            recording_url: `https://example.com/recordings/${contact.id}-${Date.now()}.mp3`,
            ai_summary: aiSummary,
            intent_label: intent,
            pain_points_discussed: contact.pain_points.slice(0, 2),
            usps_used: campaign.selected_usps.slice(0, 2)
          }]);
        
        // Update contact status to completed
        await supabase
          .from('contacts')
          .update({ status: 'completed' })
          .eq('id', contact.id);
      }

      setRunning(false);
      await fetchCampaignData();
      alert(`Campaign completed! Called ${pendingContacts.length} contacts.`);
    }, 10000);
  };

  const generateTranscript = (contact: Contact, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'your business needs';
    
    const intros = [
      `AI: Hi ${contact.name}, this is Alex calling from our company. How are you today?`,
      `AI: Good morning ${contact.name}, my name is Alex. I hope I'm not catching you at a bad time?`,
      `AI: Hello ${contact.name}, this is Alex. Do you have a quick moment to chat?`
    ];
    
    const intro = intros[Math.floor(Math.random() * intros.length)];
    
    if (intent === 'positive') {
      return `${intro}

${contact.name}: I'm doing well, thanks. What's this about?

AI: I'm reaching out because I noticed you might be experiencing challenges with ${painPoint}. We've helped companies like ${contact.company || 'yours'} solve similar issues. Would you be interested in learning more?

${contact.name}: Yes, actually! We've been struggling with that. Tell me more.

AI: Great! Let me share how we've helped other clients improve their ${painPoint}. We have a solution that typically reduces these issues by 40-60% within the first month.

${contact.name}: That sounds interesting. Can we schedule a demo?

AI: Absolutely! I'd love to show you how it works. Let me get that set up for you right away.`;
    } else if (intent === 'no-interest') {
      return `${intro}

${contact.name}: I'm busy right now. What is this regarding?

AI: I understand you're busy. I'm calling about ${painPoint} solutions. We've worked with companies like ${contact.company || 'yours'} to help improve their operations.

${contact.name}: We're not interested right now. We have other priorities.

AI: I completely understand. Would it be helpful if I sent you some information you could review when you have time?

${contact.name}: No thanks, we're all set for now.

AI: No problem at all. Thank you for your time, ${contact.name}. Have a great day!`;
    } else { // follow-up
      return `${intro}

${contact.name}: Hi, I'm actually in the middle of something right now.

AI: I completely understand. I'm calling about solutions for ${painPoint}. Does this sound like something that might be relevant to you?

${contact.name}: Potentially, but this week is really hectic. Can you call back next week?

AI: Absolutely! I'll make a note to follow up with you next week. What day works best for you?

${contact.name}: Tuesday afternoon would be better.

AI: Perfect! I'll reach out Tuesday afternoon. Thanks for your time, ${contact.name}!`;
    }
  };

  const generateAISummary = (contact: Contact, intent: IntentLabel): string => {
    const painPoint = contact.pain_points[0] || 'operational challenges';
    
    if (intent === 'positive') {
      return `Positive conversation with ${contact.name}. Strong interest in our solution for ${painPoint}. Contact mentioned they've been actively looking for solutions. Ready to schedule demo. High potential lead.`;
    } else if (intent === 'no-interest') {
      return `Spoke with ${contact.name}. Currently not interested in solutions for ${painPoint}. Cited other priorities. Polite but firm. Not the right time. Recommend follow-up in 6 months.`;
    } else {
      return `Brief conversation with ${contact.name}. Interested but timing is not ideal. Currently dealing with busy period. Agreed to follow-up call next Tuesday afternoon. Moderate potential.`;
    }
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                disabled={running}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                <Play className="w-5 h-5" />
                {running ? 'Running...' : 'Run Campaign'}
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Call Result</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-400">-</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={9} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3 relative group">
      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
        <div className="flex items-center gap-1">
          <input
            type="text"
            value={editValue}
            onChange={(e) => setEditValue(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
            className="w-full px-2 py-1 border border-primary rounded text-sm"
            autoFocus
          />
          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
            <Check className="w-4 h-4" />
          </button>
          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
            <X className="w-4 h-4" />
          </button>
        </div>
      ) : (
        <>
          <div
            onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
            className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2"
          >
            <span className="truncate max-w-[200px]">
              {contact.profile_summary || '-'}
            </span>
            <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
          </div>
          {contact.profile_summary && contact.profile_summary.length > 40 && (
            <div className="absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-3 shadow-lg z-10 max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
              {contact.profile_summary}
            </div>
          )}
        </>
      )}
    </td>

                    {/* Pain Points - REPLACE THIS */}
    <td className="px-6 py-3 relative group">
      {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
        <div className="flex items-center gap-1">
          <input
            type="text"
            value={editValue}
            onChange={(e) => setEditValue(e.target.value)}
            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
            placeholder="Use ; to separate"
            className="w-full px-2 py-1 border border-primary rounded text-sm"
            autoFocus
          />
          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
            <Check className="w-4 h-4" />
          </button>
          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
            <X className="w-4 h-4" />
          </button>
        </div>
      ) : (
        <>
          <div
            onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
            className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm flex items-center gap-2"
          >
            <span className="truncate max-w-[200px] text-red-700">
              {contact.pain_points.length > 0 ? contact.pain_points.join('  ') : '-'}
            </span>
            <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
          </div>
          {contact.pain_points.length > 0 && (
            <div className="absolute left-0 top-full mt-1 bg-gray-900 text-white text-xs rounded-lg p-3 shadow-lg z-10 max-w-md opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all pointer-events-none">
              <div className="flex flex-wrap gap-2">
                {contact.pain_points.map((point: string, idx: number) => (
                  <span key={idx} className="px-2 py-1 bg-red-100 text-red-700 rounded">
                    {point}
                  </span>
                ))}
              </div>
            </div>
          )}
        </>
      )}
    </td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      {contact.status === 'completed' ? (
                        <button
                          onClick={() => setSelectedContactForTranscript(contact)}
                          className="flex items-center gap-1 text-primary hover:underline text-sm"
                        >
                          <FileText className="w-4 h-4" />
                          View Call
                        </button>
                      ) : (
                        <span className="text-gray-400 text-xs">-</span>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}

      {/* Transcript Modal */}
      {selectedContactForTranscript && (
        <TranscriptModal
          contact={selectedContactForTranscript}
          campaignId={id!}
          onClose={() => setSelectedContactForTranscript(null)}
        />
      )}
    </div>
  );
};

// Transcript Modal Component
interface TranscriptModalProps {
  contact: Contact;
  campaignId: string;
  onClose: () => void;
}

const TranscriptModal = ({ contact, campaignId, onClose }: TranscriptModalProps) => {
  const [callLog, setCallLog] = useState<CallLog | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLog();
  }, []);

  const fetchCallLog = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .eq('campaign_id', campaignId)
        .order('call_date', { ascending: false })
        .limit(1)
        .single();

      if (error) throw error;
      setCallLog(data);
    } catch (err) {
      console.error('Error fetching call log:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {loading ? (
            <p className="text-center py-8 text-gray-500">Loading call details...</p>
          ) : !callLog ? (
            <p className="text-center py-8 text-gray-500">No call log found</p>
          ) : (
            <div className="space-y-6">
              {/* Call Metadata */}
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-gray-600">
                    {new Date(callLog.call_date).toLocaleString()}  {Math.floor(callLog.duration / 60)}m {callLog.duration % 60}s
                  </p>
                </div>
                <span className={`px-3 py-1 rounded-full text-sm font-medium ${getIntentColor(callLog.intent_label)}`}>
                  {getIntentLabel(callLog.intent_label)}
                </span>
              </div>

              {/* Recording */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Call Recording</h3>
                <div className="bg-gray-100 rounded-lg p-4 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <Phone className="w-5 h-5 text-gray-600" />
                    <div>
                      <p className="text-sm font-medium text-gray-900">Recording Available</p>
                      <p className="text-xs text-gray-500">Duration: {Math.floor(callLog.duration / 60)}:{String(callLog.duration % 60).padStart(2, '0')}</p>
                    </div>
                  </div>
                  <a
                    href={callLog.recording_url}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="px-4 py-2 bg-primary text-white text-sm rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    Play Recording
                  </a>
                </div>
              </div>

              {/* AI Summary */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">AI Summary</h3>
                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <p className="text-sm text-gray-800">{callLog.ai_summary}</p>
                </div>
              </div>

              {/* Pain Points Discussed */}
              {callLog.pain_points_discussed.length > 0 && (
                <div>
                  <h3 className="font-semibold text-gray-900 mb-2">Pain Points Discussed</h3>
                  <div className="flex flex-wrap gap-2">
                    {callLog.pain_points_discussed.map((point, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {point}
                      </span>
                    ))}
                  </div>
                </div>
              )}

              {/* Transcript */}
              <div>
                <h3 className="font-semibold text-gray-900 mb-2">Full Transcript</h3>
                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-96 overflow-y-auto">
                  <pre className="text-sm text-gray-800 whitespace-pre-wrap font-sans">{callLog.transcript}</pre>
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map((campaign: CampaignWithStats) => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, CallLog, IntentLabel } from '../types';

interface ContactWithCampaignData extends Contact {
  campaigns?: {
    name: string;
  };
}

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: string;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts: ContactWithCampaign[] = (contactsData || []).map((contact: ContactWithCampaignData) => ({
        ...contact,
        campaign_name: contact.campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
interface ContactDetailModalProps {
  contact: ContactWithCampaign;
  onClose: () => void;
}

const ContactDetailModal = ({ contact, onClose }: ContactDetailModalProps) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  const getIntentColor = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'bg-green-100 text-green-800';
      case 'no-interest':
        return 'bg-red-100 text-red-800';
      case 'follow-up':
        return 'bg-yellow-100 text-yellow-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  };

  const getIntentLabel = (intent: IntentLabel): string => {
    switch (intent) {
      case 'positive':
        return 'Positive';
      case 'no-interest':
        return 'No Interest';
      case 'follow-up':
        return 'Follow-up';
      default:
        return intent;
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${getIntentColor(log.intent_label)}`}>
                        {getIntentLabel(log.intent_label)}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="23jan2026.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addCampaign({
      name: formData.name,
      description: formData.description,
      status: formData.status,
      callWindow: {
        startTime: formData.startTime,
        endTime: formData.endTime,
        timezone: formData.timezone
      },
      selectedUSPs: formData.selectedUSPs,
      totalContacts: 0,
      calledCount: 0,
      pendingCount: 0
    });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {data.usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selectedUSPs.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, usp.id] });
                          } else {
                            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

interface ParsedContact {
  name: string;
  phone: string;
  company: string;
  email: string;
  profileSummary: string;
  painPoints: string[];
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      // Parse CSV
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      // Check required fields
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts: ParsedContact[] = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        // Handle pain points (could be comma-separated or single)
        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profileSummary: contactData.profilesummary || contactData['profile summary'] || '',
          painPoints: painPointsArray
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData, CallStatus, IntentLabel } from '../types';
import { DataContext } from './DataContextDefinition';

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: Omit<Campaign, 'id' | 'createdAt'>) => {
    const newCampaign: Campaign = {
      ...campaign,
      id: `camp_${Date.now()}`,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: Partial<Campaign>) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.map(c => c.id === id ? { ...c, ...updates } : c)
    }));
  };

  const deleteCampaign = (id: string) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.filter(c => c.id !== id),
      contacts: prev.contacts.map(contact => ({
        ...contact,
        campaigns: contact.campaigns.filter(cp => cp.campaignId !== id)
      })),
      callLogs: prev.callLogs.filter(log => log.campaignId !== id)
    }));
  };

  const addUSP = (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => {
    const newUSP: USP = {
      ...usp,
      id: `usp_${Date.now()}`,
      usageCount: 0,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: Partial<USP>) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.map(u => u.id === id ? { ...u, ...updates } : u)
    }));
  };

  const deleteUSP = (id: string) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.filter(u => u.id !== id)
    }));
  };

  const addContacts = (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => {
    setData(prev => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find(c => c.id === campaignId) : null;

      contacts.forEach(newContact => {
        const existingIndex = updatedContacts.findIndex(c => c.phone === newContact.phone);
        
        if (existingIndex >= 0) {
          // Merge with existing contact
          const existing = updatedContacts[existingIndex];
          if (campaignId && campaign) {
            const hasAssociation = existing.campaigns.some(cp => cp.campaignId === campaignId);
            if (!hasAssociation) {
              existing.campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
            }
          }
        } else {
          // Add new contact
          const contact: Contact = {
            ...newContact,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      // Update campaign counts
      const updatedCampaigns = prev.campaigns.map(c => {
        if (c.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter(contact =>
            contact.campaigns.some(cp => cp.campaignId === campaignId)
          );
          return {
            ...c,
            totalContacts: contactsInCampaign.length,
            pendingCount: contactsInCampaign.filter(contact =>
              contact.campaigns.find(cp => cp.campaignId === campaignId)?.status === 'pending'
            ).length
          };
        }
        return c;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find(c => c.id === campaignId);
    if (!campaign) return;

    // Simulate calls after 10 seconds
    setTimeout(() => {
      setData(prev => {
        const newCallLogs: CallLog[] = [];
        const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map(contact => {
          const campaignAssoc = contact.campaigns.find(cp => cp.campaignId === campaignId);
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60; // 1-4 minutes
            
            const callLog: CallLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contactId: contact.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${contact.name}, this is Alex from our company calling about ${contact.painPoints[0] || 'your business needs'}...\n\n${contact.name}: ${intent === 'positive' ? 'Yes, I\'m interested! Tell me more.' : intent === 'no-interest' ? 'Not interested, thanks.' : 'Can you call back next week? We\'re busy right now.'}\n\nAI: ${intent === 'positive' ? 'Great! Let me share how we can help...' : intent === 'no-interest' ? 'I understand. Thank you for your time.' : 'Absolutely! I\'ll follow up next week.'}`,
              recordingUrl: '#',
              aiSummary: intent === 'positive' 
                ? `Prospect showed strong interest. Mentioned challenges with ${contact.painPoints[0] || 'their current solution'}. Ready for next steps.`
                : intent === 'no-interest'
                ? `Prospect declined. Not the right time. No clear pain points identified.`
                : `Prospect interested but needs more time. Requested follow-up next week.`,
              intentLabel: intent,
              painPointsDiscussed: contact.painPoints.slice(0, 2),
              uspsUsed: campaign.selectedUSPs.slice(0, 2)
            };

            newCallLogs.push(callLog);

            return {
              ...contact,
              campaigns: contact.campaigns.map(cp =>
                cp.campaignId === campaignId ? { ...cp, status: 'completed' as CallStatus } : cp
              ),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return contact;
        });

        const updatedCampaigns = prev.campaigns.map(c => {
          if (c.id === campaignId) {
            return {
              ...c,
              calledCount: c.totalContacts,
              pendingCount: 0,
              status: 'completed' as const
            };
          }
          return c;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData } from '../types';

export interface DataContextType {
  data: AppData;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'createdAt'>) => void;
  updateCampaign: (id: string, updates: Partial<Campaign>) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => void;
  updateUSP: (id: string, updates: Partial<USP>) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    // Convert pain_points string to array
    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!window.confirm('Start calling all pending contacts? (Simulated for 10 seconds)')) return;

    // TODO: Implement actual campaign run logic
    alert('Campaign simulation will be implemented with RingCentral integration');
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
              >
                <Play className="w-5 h-5" />
                Run Campaign
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={8} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2 max-w-xs truncate"
                        >
                          <span className="truncate">{contact.profile_summary || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            placeholder="Use ; to separate"
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group"
                        >
                          {contact.pain_points.length > 0 ? (
                            <div className="flex flex-wrap gap-1">
                              {contact.pain_points.map((point, idx) => (
                                <span key={idx} className="px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded">
                                  {point}
                                </span>
                              ))}
                            </div>
                          ) : (
                            <span className="text-gray-400">-</span>
                          )}
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 inline ml-2" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

     {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState } from 'react';
import { Plus, Upload, Phone, Clock, Trash2, Play } from 'lucide-react';
import { useData } from '../hooks/useData';
import type { Campaign } from '../types';
import CreateCampaignModal from '../components/common/CreateCampaignModal';
import UploadContactsModal from '../components/common/UploadContactsModal';

const CampaignsPage = () => {
  const { data, deleteCampaign, runCampaign } = useData();
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [selectedCampaign, setSelectedCampaign] = useState<Campaign | null>(null);
  const [showUploadModal, setShowUploadModal] = useState(false);

  const handleRunCampaign = (campaignId: string) => {
    if (window.confirm('Start calling all pending contacts in this campaign? Calls will complete in 10 seconds.')) {
      runCampaign(campaignId);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => setShowCreateModal(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      </div>

      {data.campaigns.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
          <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
          <button
            onClick={() => setShowCreateModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {data.campaigns.map(campaign => (
            <div key={campaign.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">{campaign.name}</h3>
                  <p className="text-gray-600 text-sm mb-3">{campaign.description}</p>
                  <div className="flex items-center gap-4 text-sm">
                    <span className={`px-3 py-1 rounded-full ${
                      campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                      campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-gray-100 text-gray-800'
                    }`}>
                      {campaign.status}
                    </span>
                    <span className="text-gray-600">
                      <Clock className="w-4 h-4 inline mr-1" />
                      {campaign.callWindow.startTime} - {campaign.callWindow.endTime} {campaign.callWindow.timezone}
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => deleteCampaign(campaign.id)}
                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                >
                  <Trash2 className="w-5 h-5" />
                </button>
              </div>

              <div className="grid grid-cols-3 gap-4 mb-4">
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-gray-900">{campaign.totalContacts}</div>
                  <div className="text-sm text-gray-600">Total Contacts</div>
                </div>
                <div className="bg-blue-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-blue-900">{campaign.pendingCount}</div>
                  <div className="text-sm text-blue-600">Pending</div>
                </div>
                <div className="bg-green-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-green-900">{campaign.calledCount}</div>
                  <div className="text-sm text-green-600">Called</div>
                </div>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    setSelectedCampaign(campaign);
                    setShowUploadModal(true);
                  }}
                  className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <Upload className="w-4 h-4" />
                  Upload Contacts
                </button>
                {campaign.pendingCount > 0 && (
                  <button
                    onClick={() => handleRunCampaign(campaign.id)}
                    className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    <Play className="w-4 h-4" />
                    Run Campaign
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      )}

      {showCreateModal && (
        <CreateCampaignModal onClose={() => setShowCreateModal(false)} />
      )}

      {showUploadModal && selectedCampaign && (
        <UploadContactsModal
          campaignId={selectedCampaign.id}
          onClose={() => {
            setShowUploadModal(false);
            setSelectedCampaign(null);
          }}
        />
      )}
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, Campaign, CallLog, IntentLabel } from '../types';

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts = (contactsData || []).map(contact => ({
        ...contact,
        campaign_name: (contact as any).campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
const ContactDetailModal = ({ contact, onClose }: { contact: ContactWithCampaign; onClose: () => void }) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <FileText className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        log.intent_label === 'positive' ? 'bg-green-100 text-green-800' :
                        log.intent_label === 'no-interest' ? 'bg-red-100 text-red-800' :
                        'bg-yellow-100 text-yellow-800'
                      }`}>
                        {log.intent_label}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
</file>

<file path="23jan2026.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
public/
  contacts.csv
  vite.svg
src/
  assets/
    react.svg
  components/
    campaigns/
      CampaignSettingsModal.tsx
    common/
      CreateCampaignModal.tsx
      UploadContactsModal.tsx
    layout/
      Layout.tsx
      Sidebar.tsx
  contexts/
    DataContext.tsx
    DataContextDefinition.ts
  hooks/
    useData.ts
  lib/
    supabase.ts
  pages/
    CampaignDetailPage.tsx
    CampaignsListPage.tsx
    CampaignsPage.tsx
    ContactsPage.tsx
    CreateCampaignPage.tsx
    OverviewPage.tsx
    USPLibraryPage.tsx
  types/
    index.ts
  App.css
  App.tsx
  index.css
  main.tsx
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/contacts.csv">
name,phone,company,email,profileSummary,painPoints
John Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs
Jane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/campaigns/CampaignSettingsModal.tsx">
import { useState, useEffect } from 'react';
import { X, Trash2 } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import { useNavigate } from 'react-router-dom';
import type { Campaign, USP } from '../../types';

interface CampaignSettingsModalProps {
  campaign: Campaign;
  onClose: () => void;
  onUpdate: () => void;
}

const CampaignSettingsModal = ({ campaign, onClose, onUpdate }: CampaignSettingsModalProps) => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: campaign.name,
    description: campaign.description || '',
    call_window_start: campaign.call_window_start,
    call_window_end: campaign.call_window_end,
    timezone: campaign.timezone,
    pause_between_calls: campaign.pause_between_calls,
    selected_usps: campaign.selected_usps,
    status: campaign.status
  });
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      const { error } = await supabase
        .from('campaigns')
        .update({
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        })
        .eq('id', campaign.id);

      if (error) throw error;

      onUpdate();
      onClose();
    } catch (err) {
      console.error('Error updating campaign:', err);
      alert('Failed to update campaign');
    } finally {
      setSaving(false);
    }
  };

  const handleDelete = async () => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs. This action cannot be undone.')) {
      return;
    }

    setDeleting(true);
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', campaign.id);

      if (error) throw error;

      navigate('/campaigns');
    } catch (err) {
      console.error('Error deleting campaign:', err);
      alert('Failed to delete campaign');
      setDeleting(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Campaign Settings</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
            </div>

            {/* Status */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Status</label>
              <select
                value={formData.status}
                onChange={e => setFormData({ ...formData, status: e.target.value as any })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              >
                <option value="active">Active</option>
                <option value="paused">Paused</option>
                <option value="completed">Completed</option>
              </select>
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Selected USPs
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={handleDelete}
              disabled={deleting || saving}
              className="flex items-center gap-2 px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50"
            >
              <Trash2 className="w-4 h-4" />
              {deleting ? 'Deleting...' : 'Delete Campaign'}
            </button>

            <div className="flex items-center gap-3">
              <button
                type="button"
                onClick={onClose}
                disabled={saving || deleting}
                className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={saving || deleting}
                className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
              >
                {saving ? 'Saving...' : 'Save Changes'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CampaignSettingsModal;
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { X } from 'lucide-react';
import { useData } from '../../hooks/useData';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const { data, addCampaign } = useData();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    selectedUSPs: [] as string[]
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    addCampaign({
      name: formData.name,
      description: formData.description,
      status: formData.status,
      callWindow: {
        startTime: formData.startTime,
        endTime: formData.endTime,
        timezone: formData.timezone
      },
      selectedUSPs: formData.selectedUSPs,
      totalContacts: 0,
      calledCount: 0,
      pendingCount: 0
    });
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.startTime}
                  onChange={e => setFormData({ ...formData, startTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.endTime}
                  onChange={e => setFormData({ ...formData, endTime: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {data.usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {data.usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selectedUSPs.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selectedUSPs: [...formData.selectedUSPs, usp.id] });
                          } else {
                            setFormData({ ...formData, selectedUSPs: formData.selectedUSPs.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              Create Campaign
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

interface ParsedContact {
  name: string;
  phone: string;
  company: string;
  email: string;
  profileSummary: string;
  painPoints: string[];
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      // Parse CSV
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      // Check required fields
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts: ParsedContact[] = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        // Handle pain points (could be comma-separated or single)
        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profileSummary: contactData.profilesummary || contactData['profile summary'] || '',
          painPoints: painPointsArray
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

<file path="src/components/layout/Layout.tsx">
import { Outlet, useLocation, useNavigate } from 'react-router-dom';
import Sidebar from './Sidebar';

const Layout = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const getCurrentPage = () => {
    const path = location.pathname;
    if (path.startsWith('/campaigns')) return 'campaigns';
    if (path.startsWith('/contacts')) return 'contacts';
    if (path.startsWith('/usps')) return 'usps';
    if (path.startsWith('/overview')) return 'overview';
    return 'overview';
  };

  const handleNavigate = (page: string) => {
    navigate(`/${page}`);
  };

  return (
    <div className="flex min-h-screen bg-gray-50">
      <Sidebar currentPage={getCurrentPage()} onNavigate={handleNavigate} />
      <main className="flex-1 ml-64">
        <div className="p-8">
          <Outlet />
        </div>
      </main>
    </div>
  );
};

export default Layout;
</file>

<file path="src/components/layout/Sidebar.tsx">
import { Phone, Users, Lightbulb, BarChart3 } from 'lucide-react';

interface SidebarProps {
  currentPage: string;
  onNavigate: (page: string) => void;
}

const Sidebar = ({ currentPage, onNavigate }: SidebarProps) => {
  const menuItems = [
    { id: 'overview', icon: BarChart3, label: 'Overview' },
    { id: 'campaigns', icon: Phone, label: 'Campaigns' },
    { id: 'contacts', icon: Users, label: 'Contacts' },
    { id: 'usps', icon: Lightbulb, label: 'USP Library' }
  ];

  return (
    <div className="fixed left-0 top-0 h-screen w-64 bg-white border-r border-gray-200 flex flex-col z-50">
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
            <Phone className="w-6 h-6 text-white" />
          </div>
          <h1 className="font-bold text-xl text-gray-900">AI Call Hub</h1>
        </div>
      </div>

      <nav className="flex-1 p-4 space-y-2">
        {menuItems.map(item => {
          const Icon = item.icon;
          const isActive = currentPage === item.id;
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                isActive ? 'bg-primary text-white' : 'text-gray-700 hover:bg-gray-100'
              }`}
            >
              <Icon className="w-5 h-5" />
              <span className="text-sm font-medium">{item.label}</span>
            </button>
          );
        })}
      </nav>
    </div>
  );
};

export default Sidebar;
</file>

<file path="src/contexts/DataContext.tsx">
import { useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData, CallStatus, IntentLabel } from '../types';
import { DataContext } from './DataContextDefinition';

export const DataProvider = ({ children }: { children: ReactNode }) => {
  const [data, setData] = useState<AppData>(() => {
    const saved = localStorage.getItem('aiCallAgentData');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      campaigns: [],
      contacts: [],
      usps: [],
      callLogs: []
    };
  });

  useEffect(() => {
    localStorage.setItem('aiCallAgentData', JSON.stringify(data));
  }, [data]);

  const addCampaign = (campaign: Omit<Campaign, 'id' | 'createdAt'>) => {
    const newCampaign: Campaign = {
      ...campaign,
      id: `camp_${Date.now()}`,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, campaigns: [...prev.campaigns, newCampaign] }));
  };

  const updateCampaign = (id: string, updates: Partial<Campaign>) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.map(c => c.id === id ? { ...c, ...updates } : c)
    }));
  };

  const deleteCampaign = (id: string) => {
    setData(prev => ({
      ...prev,
      campaigns: prev.campaigns.filter(c => c.id !== id),
      contacts: prev.contacts.map(contact => ({
        ...contact,
        campaigns: contact.campaigns.filter(cp => cp.campaignId !== id)
      })),
      callLogs: prev.callLogs.filter(log => log.campaignId !== id)
    }));
  };

  const addUSP = (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => {
    const newUSP: USP = {
      ...usp,
      id: `usp_${Date.now()}`,
      usageCount: 0,
      createdAt: new Date().toISOString()
    };
    setData(prev => ({ ...prev, usps: [...prev.usps, newUSP] }));
  };

  const updateUSP = (id: string, updates: Partial<USP>) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.map(u => u.id === id ? { ...u, ...updates } : u)
    }));
  };

  const deleteUSP = (id: string) => {
    setData(prev => ({
      ...prev,
      usps: prev.usps.filter(u => u.id !== id)
    }));
  };

  const addContacts = (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => {
    setData(prev => {
      const updatedContacts = [...prev.contacts];
      const campaign = campaignId ? prev.campaigns.find(c => c.id === campaignId) : null;

      contacts.forEach(newContact => {
        const existingIndex = updatedContacts.findIndex(c => c.phone === newContact.phone);
        
        if (existingIndex >= 0) {
          // Merge with existing contact
          const existing = updatedContacts[existingIndex];
          if (campaignId && campaign) {
            const hasAssociation = existing.campaigns.some(cp => cp.campaignId === campaignId);
            if (!hasAssociation) {
              existing.campaigns.push({
                campaignId,
                campaignName: campaign.name,
                status: 'pending',
                addedDate: new Date().toISOString()
              });
            }
          }
        } else {
          // Add new contact
          const contact: Contact = {
            ...newContact,
            id: `contact_${Date.now()}_${Math.random()}`,
            campaigns: campaignId && campaign ? [{
              campaignId,
              campaignName: campaign.name,
              status: 'pending',
              addedDate: new Date().toISOString()
            }] : []
          };
          updatedContacts.push(contact);
        }
      });

      // Update campaign counts
      const updatedCampaigns = prev.campaigns.map(c => {
        if (c.id === campaignId) {
          const contactsInCampaign = updatedContacts.filter(contact =>
            contact.campaigns.some(cp => cp.campaignId === campaignId)
          );
          return {
            ...c,
            totalContacts: contactsInCampaign.length,
            pendingCount: contactsInCampaign.filter(contact =>
              contact.campaigns.find(cp => cp.campaignId === campaignId)?.status === 'pending'
            ).length
          };
        }
        return c;
      });

      return { ...prev, contacts: updatedContacts, campaigns: updatedCampaigns };
    });
  };

  const runCampaign = (campaignId: string) => {
    const campaign = data.campaigns.find(c => c.id === campaignId);
    if (!campaign) return;

    // Simulate calls after 10 seconds
    setTimeout(() => {
      setData(prev => {
        const newCallLogs: CallLog[] = [];
        const intents: IntentLabel[] = ['positive', 'no-interest', 'follow-up'];
        
        const updatedContacts = prev.contacts.map(contact => {
          const campaignAssoc = contact.campaigns.find(cp => cp.campaignId === campaignId);
          if (campaignAssoc && campaignAssoc.status === 'pending') {
            const intent = intents[Math.floor(Math.random() * intents.length)];
            const duration = Math.floor(Math.random() * 180) + 60; // 1-4 minutes
            
            const callLog: CallLog = {
              id: `call_${Date.now()}_${Math.random()}`,
              contactId: contact.id,
              campaignId,
              campaignName: campaign.name,
              date: new Date().toISOString(),
              duration,
              transcript: `AI: Hi ${contact.name}, this is Alex from our company calling about ${contact.painPoints[0] || 'your business needs'}...\n\n${contact.name}: ${intent === 'positive' ? 'Yes, I\'m interested! Tell me more.' : intent === 'no-interest' ? 'Not interested, thanks.' : 'Can you call back next week? We\'re busy right now.'}\n\nAI: ${intent === 'positive' ? 'Great! Let me share how we can help...' : intent === 'no-interest' ? 'I understand. Thank you for your time.' : 'Absolutely! I\'ll follow up next week.'}`,
              recordingUrl: '#',
              aiSummary: intent === 'positive' 
                ? `Prospect showed strong interest. Mentioned challenges with ${contact.painPoints[0] || 'their current solution'}. Ready for next steps.`
                : intent === 'no-interest'
                ? `Prospect declined. Not the right time. No clear pain points identified.`
                : `Prospect interested but needs more time. Requested follow-up next week.`,
              intentLabel: intent,
              painPointsDiscussed: contact.painPoints.slice(0, 2),
              uspsUsed: campaign.selectedUSPs.slice(0, 2)
            };

            newCallLogs.push(callLog);

            return {
              ...contact,
              campaigns: contact.campaigns.map(cp =>
                cp.campaignId === campaignId ? { ...cp, status: 'completed' as CallStatus } : cp
              ),
              lastCallDate: new Date().toISOString(),
              lastIntent: intent
            };
          }
          return contact;
        });

        const updatedCampaigns = prev.campaigns.map(c => {
          if (c.id === campaignId) {
            return {
              ...c,
              calledCount: c.totalContacts,
              pendingCount: 0,
              status: 'completed' as const
            };
          }
          return c;
        });

        return {
          ...prev,
          contacts: updatedContacts,
          campaigns: updatedCampaigns,
          callLogs: [...prev.callLogs, ...newCallLogs]
        };
      });
    }, 10000);
  };

  return (
    <DataContext.Provider value={{ 
      data, 
      addCampaign, 
      updateCampaign, 
      deleteCampaign, 
      addUSP, 
      updateUSP, 
      deleteUSP, 
      addContacts, 
      runCampaign 
    }}>
      {children}
    </DataContext.Provider>
  );
};
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact, USP, CallLog, AppData } from '../types';

export interface DataContextType {
  data: AppData;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'createdAt'>) => void;
  updateCampaign: (id: string, updates: Partial<Campaign>) => void;
  deleteCampaign: (id: string) => void;
  addUSP: (usp: Omit<USP, 'id' | 'usageCount' | 'createdAt'>) => void;
  updateUSP: (id: string, updates: Partial<USP>) => void;
  deleteUSP: (id: string) => void;
  addContacts: (contacts: Omit<Contact, 'id' | 'campaigns'>[], campaignId?: string) => void;
  runCampaign: (campaignId: string) => void;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/hooks/useData.ts">
import { useContext } from 'react';
import { DataContext } from '../contexts/DataContextDefinition';

export const useData = () => {
  const context = useContext(DataContext);
  if (!context) throw new Error('useData must be used within DataProvider');
  return context;
};
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error('Missing Supabase environment variables');
}

export const supabase = createClient(supabaseUrl, supabaseAnonKey);
</file>

<file path="src/pages/CampaignDetailPage.tsx">
import { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { ArrowLeft, Plus, Settings, Play, Trash2, Edit2, Check, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import CampaignSettingsModal from '../components/campaigns/CampaignSettingsModal';
import type { Campaign, Contact } from '../types';

const CampaignDetailPage = () => {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  
  const [campaign, setCampaign] = useState<Campaign | null>(null);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);
  const [editingCell, setEditingCell] = useState<{ contactId: string; field: string } | null>(null);
  const [editValue, setEditValue] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [addingRow, setAddingRow] = useState(false);
  const [newContact, setNewContact] = useState({
    name: '',
    phone: '',
    company: '',
    email: '',
    profile_summary: '',
    pain_points: ''
  });

  useEffect(() => {
    if (id) {
      fetchCampaignData();
    }
  }, [id]);

  const fetchCampaignData = async () => {
    if (!id) return;

    try {
      setLoading(true);

      // Fetch campaign
      const { data: campaignData, error: campaignError } = await supabase
        .from('campaigns')
        .select('*')
        .eq('id', id)
        .single();

      if (campaignError) throw campaignError;
      setCampaign(campaignData);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .eq('campaign_id', id)
        .order('created_at', { ascending: false });

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching campaign data:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleCellClick = (contactId: string, field: string, currentValue: string | string[]) => {
    setEditingCell({ contactId, field });
    if (field === 'pain_points') {
      setEditValue(Array.isArray(currentValue) ? currentValue.join('; ') : '');
    } else {
      setEditValue(currentValue as string || '');
    }
  };

  const handleCellSave = async () => {
    if (!editingCell) return;

    const { contactId, field } = editingCell;
    let valueToSave: string | string[] = editValue;

    // Convert pain_points string to array
    if (field === 'pain_points') {
      valueToSave = editValue.split(';').map(p => p.trim()).filter(p => p);
    }

    const { error } = await supabase
      .from('contacts')
      .update({ [field]: valueToSave })
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }

    setEditingCell(null);
    setEditValue('');
  };

  const handleAddContact = async () => {
    if (!id || !newContact.name || !newContact.phone) {
      alert('Name and Phone are required');
      return;
    }

    const { error } = await supabase
      .from('contacts')
      .insert([{
        campaign_id: id,
        name: newContact.name,
        phone: newContact.phone,
        company: newContact.company || null,
        email: newContact.email || null,
        profile_summary: newContact.profile_summary || null,
        pain_points: newContact.pain_points 
          ? newContact.pain_points.split(';').map(p => p.trim()).filter(p => p)
          : []
      }]);

    if (!error) {
      setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
      setAddingRow(false);
      await fetchCampaignData();
    }
  };

  const handleDeleteContact = async (contactId: string) => {
    if (!window.confirm('Delete this contact?')) return;

    const { error } = await supabase
      .from('contacts')
      .delete()
      .eq('id', contactId);

    if (!error) {
      await fetchCampaignData();
    }
  };

  const runCampaign = async () => {
    if (!window.confirm('Start calling all pending contacts? (Simulated for 10 seconds)')) return;

    // TODO: Implement actual campaign run logic
    alert('Campaign simulation will be implemented with RingCentral integration');
  };

  const stats = {
    total: contacts.length,
    pending: contacts.filter(c => c.status === 'pending').length,
    calling: contacts.filter(c => c.status === 'calling').length,
    completed: contacts.filter(c => c.status === 'completed').length,
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading campaign...</div>
      </div>
    );
  }

  if (!campaign) {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen">
        <div className="text-gray-500 mb-4">Campaign not found</div>
        <button
          onClick={() => navigate('/campaigns')}
          className="text-primary hover:underline"
        >
          Back to Campaigns
        </button>
      </div>
    );
  }

  return (
    <div>
      {/* Header */}
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">{campaign.name}</h1>
            {campaign.description && (
              <p className="text-gray-600">{campaign.description}</p>
            )}
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setShowSettings(true)}
              className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <Settings className="w-5 h-5" />
              Settings
            </button>
            {stats.pending > 0 && (
              <button
                onClick={runCampaign}
                className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
              >
                <Play className="w-5 h-5" />
                Run Campaign
              </button>
            )}
          </div>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="text-2xl font-semibold text-gray-900">{stats.total}</div>
          <div className="text-sm text-gray-600">Total Contacts</div>
        </div>
        <div className="bg-blue-50 rounded-xl border border-blue-200 p-6">
          <div className="text-2xl font-semibold text-blue-900">{stats.pending}</div>
          <div className="text-sm text-blue-600">Pending</div>
        </div>
        <div className="bg-yellow-50 rounded-xl border border-yellow-200 p-6">
          <div className="text-2xl font-semibold text-yellow-900">{stats.calling}</div>
          <div className="text-sm text-yellow-600">Calling</div>
        </div>
        <div className="bg-green-50 rounded-xl border border-green-200 p-6">
          <div className="text-2xl font-semibold text-green-900">{stats.completed}</div>
          <div className="text-sm text-green-600">Completed</div>
        </div>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div className="p-6 border-b border-gray-200 flex items-center justify-between">
          <h2 className="text-lg font-semibold text-gray-900">Contacts</h2>
          <button
            onClick={() => setAddingRow(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-sm"
          >
            <Plus className="w-4 h-4" />
            Add Contact
          </button>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Name</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Email</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Profile Summary</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Pain Points</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-20">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {/* Add New Row */}
              {addingRow && (
                <tr className="bg-blue-50">
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.name}
                      onChange={(e) => setNewContact({ ...newContact, name: e.target.value })}
                      placeholder="Name *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                      autoFocus
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.phone}
                      onChange={(e) => setNewContact({ ...newContact, phone: e.target.value })}
                      placeholder="Phone *"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.company}
                      onChange={(e) => setNewContact({ ...newContact, company: e.target.value })}
                      placeholder="Company"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="email"
                      value={newContact.email}
                      onChange={(e) => setNewContact({ ...newContact, email: e.target.value })}
                      placeholder="Email"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.profile_summary}
                      onChange={(e) => setNewContact({ ...newContact, profile_summary: e.target.value })}
                      placeholder="Profile Summary"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <input
                      type="text"
                      value={newContact.pain_points}
                      onChange={(e) => setNewContact({ ...newContact, pain_points: e.target.value })}
                      placeholder="Pain points (use ; to separate)"
                      className="w-full px-2 py-1 border border-gray-300 rounded text-sm"
                    />
                  </td>
                  <td className="px-6 py-3">
                    <span className="text-xs text-gray-500">pending</span>
                  </td>
                  <td className="px-6 py-3">
                    <div className="flex items-center gap-1">
                      <button
                        onClick={handleAddContact}
                        className="p-1 text-green-600 hover:bg-green-50 rounded"
                      >
                        <Check className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => {
                          setAddingRow(false);
                          setNewContact({ name: '', phone: '', company: '', email: '', profile_summary: '', pain_points: '' });
                        }}
                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              )}

              {/* Existing Contacts */}
              {contacts.length === 0 && !addingRow ? (
                <tr>
                  <td colSpan={8} className="px-6 py-12 text-center text-gray-500">
                    No contacts yet. Add your first contact to get started.
                  </td>
                </tr>
              ) : (
                contacts.map((contact) => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'name' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'name', contact.name)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.name}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>
                    
                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'phone' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'phone', contact.phone)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.phone}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'company' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'company', contact.company || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.company || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'email' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="email"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'email', contact.email || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2"
                        >
                          <span>{contact.email || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'profile_summary' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'profile_summary', contact.profile_summary || '')}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group flex items-center gap-2 max-w-xs truncate"
                        >
                          <span className="truncate">{contact.profile_summary || '-'}</span>
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 flex-shrink-0" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      {editingCell?.contactId === contact.id && editingCell.field === 'pain_points' ? (
                        <div className="flex items-center gap-1">
                          <input
                            type="text"
                            value={editValue}
                            onChange={(e) => setEditValue(e.target.value)}
                            onKeyDown={(e) => e.key === 'Enter' && handleCellSave()}
                            placeholder="Use ; to separate"
                            className="w-full px-2 py-1 border border-primary rounded text-sm"
                            autoFocus
                          />
                          <button onClick={handleCellSave} className="p-1 text-green-600 hover:bg-green-50 rounded">
                            <Check className="w-4 h-4" />
                          </button>
                          <button onClick={() => setEditingCell(null)} className="p-1 text-red-600 hover:bg-red-50 rounded">
                            <X className="w-4 h-4" />
                          </button>
                        </div>
                      ) : (
                        <div
                          onClick={() => handleCellClick(contact.id, 'pain_points', contact.pain_points)}
                          className="cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-sm group"
                        >
                          {contact.pain_points.length > 0 ? (
                            <div className="flex flex-wrap gap-1">
                              {contact.pain_points.map((point, idx) => (
                                <span key={idx} className="px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded">
                                  {point}
                                </span>
                              ))}
                            </div>
                          ) : (
                            <span className="text-gray-400">-</span>
                          )}
                          <Edit2 className="w-3 h-3 opacity-0 group-hover:opacity-100 text-gray-400 inline ml-2" />
                        </div>
                      )}
                    </td>

                    <td className="px-6 py-3">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>

                    <td className="px-6 py-3">
                      <button
                        onClick={() => handleDeleteContact(contact.id)}
                        className="p-1 text-red-600 hover:bg-red-50 rounded transition-colors"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

     {/* Settings Modal */}
      {showSettings && (
        <CampaignSettingsModal
          campaign={campaign}
          onClose={() => setShowSettings(false)}
          onUpdate={fetchCampaignData}
        />
      )}
    </div>
  );
};

export default CampaignDetailPage;
</file>

<file path="src/pages/CampaignsListPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { Plus, Search, MoreVertical, Trash2 } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { CampaignWithStats } from '../types';

const CampaignsListPage = () => {
  const navigate = useNavigate();
  const [campaigns, setCampaigns] = useState<CampaignWithStats[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  const [showActionsMenu, setShowActionsMenu] = useState<string | null>(null);

  useEffect(() => {
    fetchCampaigns();
  }, []);

  const fetchCampaigns = async () => {
    try {
      setLoading(true);
      
      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;

      // Fetch contacts count for each campaign
      const campaignsWithStats = await Promise.all(
        (campaignsData || []).map(async (campaign) => {
          const { data: contacts } = await supabase
            .from('contacts')
            .select('id, status')
            .eq('campaign_id', campaign.id);

          const { data: callLogs } = await supabase
            .from('call_logs')
            .select('intent_label')
            .eq('campaign_id', campaign.id);

          return {
            ...campaign,
            total_contacts: contacts?.length || 0,
            pending_contacts: contacts?.filter(c => c.status === 'pending').length || 0,
            completed_contacts: contacts?.filter(c => c.status === 'completed').length || 0,
            positive_calls: callLogs?.filter(log => log.intent_label === 'positive').length || 0
          };
        })
      );

      setCampaigns(campaignsWithStats);
    } catch (err) {
      console.error('Error fetching campaigns:', err);
    } finally {
      setLoading(false);
    }
  };

  const toggleCampaignStatus = async (id: string, currentStatus: string) => {
    const newStatus = currentStatus === 'active' ? 'paused' : 'active';
    
    const { error } = await supabase
      .from('campaigns')
      .update({ status: newStatus })
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
    }
  };

  const deleteCampaign = async (id: string) => {
    if (!window.confirm('Delete this campaign? This will also delete all contacts and call logs.')) {
      return;
    }

    const { error } = await supabase
      .from('campaigns')
      .delete()
      .eq('id', id);

    if (!error) {
      fetchCampaigns();
      setShowActionsMenu(null);
    }
  };

  const filteredCampaigns = campaigns.filter(campaign => {
    const matchesSearch = campaign.name.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === 'all' || campaign.status === statusFilter;
    return matchesSearch && matchesStatus;
  });

  const getCampaignIcon = (name: string) => {
    // Simple logic to show different emojis based on keywords
    if (name.toLowerCase().includes('warm')) return '';
    if (name.toLowerCase().includes('cold')) return '';
    if (name.toLowerCase().includes('test')) return '';
    return '';
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => navigate('/campaigns/new')}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create campaign
          </button>
        </div>

        {/* Filters */}
        <div className="flex gap-4 mb-6">
          <div className="flex-1 relative">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
            <input
              type="text"
              placeholder="Search a campaign..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
          </div>

          <select
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            className="px-4 py-2.5 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          >
            <option value="all">Status: All</option>
            <option value="active">Active</option>
            <option value="paused">Paused</option>
            <option value="completed">Completed</option>
          </select>
        </div>
      </div>

      {/* Campaigns Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading campaigns...</div>
        ) : filteredCampaigns.length === 0 ? (
          <div className="p-12 text-center">
            <div className="text-4xl mb-4"></div>
            <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
            <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
            <button
              onClick={() => navigate('/campaigns/new')}
              className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
            >
              <Plus className="w-5 h-5" />
              Create campaign
            </button>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b border-gray-200">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-16">
                  Status
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Campaign Name
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Leads completed
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Positive
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                  Created at
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider w-24">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {filteredCampaigns.map(campaign => (
                <tr 
                  key={campaign.id} 
                  className="hover:bg-gray-50 cursor-pointer"
                  onClick={() => navigate(`/campaigns/${campaign.id}`)}
                >
                  <td className="px-6 py-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleCampaignStatus(campaign.id, campaign.status);
                      }}
                      className={`w-10 h-6 rounded-full transition-colors ${
                        campaign.status === 'active' ? 'bg-blue-500' : 'bg-gray-300'
                      }`}
                    >
                      <div className={`w-4 h-4 bg-white rounded-full transition-transform ${
                        campaign.status === 'active' ? 'translate-x-5' : 'translate-x-1'
                      }`} />
                    </button>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-3">
                      <span className="text-2xl">{getCampaignIcon(campaign.name)}</span>
                      <div>
                        <div className="font-medium text-gray-900">{campaign.name}</div>
                        {campaign.description && (
                          <div className="text-sm text-gray-500">{campaign.description}</div>
                        )}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className="text-gray-900">
                      {campaign.completed_contacts || 0}/{campaign.total_contacts || 0}
                    </span>
                  </td>
                  <td className="px-6 py-4">
                    {(campaign.positive_calls || 0) > 0 ? (
                      <span className="px-2.5 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                        {campaign.positive_calls} positive
                      </span>
                    ) : (
                      <span className="text-gray-400">-</span>
                    )}
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {new Date(campaign.created_at).toLocaleDateString()}
                  </td>
                  <td className="px-6 py-4">
                    <div className="relative">
                      <button
                        onClick={(e) => {
                          e.stopPropagation();
                          setShowActionsMenu(showActionsMenu === campaign.id ? null : campaign.id);
                        }}
                        className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                      >
                        <MoreVertical className="w-5 h-5 text-gray-600" />
                      </button>

                      {showActionsMenu === campaign.id && (
                        <>
                          <div 
                            className="fixed inset-0 z-10" 
                            onClick={(e) => {
                              e.stopPropagation();
                              setShowActionsMenu(null);
                            }}
                          />
                          <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                deleteCampaign(campaign.id);
                              }}
                              className="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
                            >
                              <Trash2 className="w-4 h-4" />
                              Delete Campaign
                            </button>
                          </div>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        )}
      </div>
    </div>
  );
};

export default CampaignsListPage;
</file>

<file path="src/pages/CampaignsPage.tsx">
import { useState } from 'react';
import { Plus, Upload, Phone, Clock, Trash2, Play } from 'lucide-react';
import { useData } from '../hooks/useData';
import type { Campaign } from '../types';
import CreateCampaignModal from '../components/common/CreateCampaignModal';
import UploadContactsModal from '../components/common/UploadContactsModal';

const CampaignsPage = () => {
  const { data, deleteCampaign, runCampaign } = useData();
  const [showCreateModal, setShowCreateModal] = useState(false);
  const [selectedCampaign, setSelectedCampaign] = useState<Campaign | null>(null);
  const [showUploadModal, setShowUploadModal] = useState(false);

  const handleRunCampaign = (campaignId: string) => {
    if (window.confirm('Start calling all pending contacts in this campaign? Calls will complete in 10 seconds.')) {
      runCampaign(campaignId);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Campaigns</h1>
            <p className="text-gray-600">Manage your AI calling campaigns</p>
          </div>
          <button
            onClick={() => setShowCreateModal(true)}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      </div>

      {data.campaigns.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No campaigns yet</h3>
          <p className="text-gray-500 mb-6">Create your first campaign to start making AI calls</p>
          <button
            onClick={() => setShowCreateModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Create Campaign
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {data.campaigns.map(campaign => (
            <div key={campaign.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <h3 className="text-xl font-semibold text-gray-900 mb-2">{campaign.name}</h3>
                  <p className="text-gray-600 text-sm mb-3">{campaign.description}</p>
                  <div className="flex items-center gap-4 text-sm">
                    <span className={`px-3 py-1 rounded-full ${
                      campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                      campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-gray-100 text-gray-800'
                    }`}>
                      {campaign.status}
                    </span>
                    <span className="text-gray-600">
                      <Clock className="w-4 h-4 inline mr-1" />
                      {campaign.callWindow.startTime} - {campaign.callWindow.endTime} {campaign.callWindow.timezone}
                    </span>
                  </div>
                </div>
                <button
                  onClick={() => deleteCampaign(campaign.id)}
                  className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                >
                  <Trash2 className="w-5 h-5" />
                </button>
              </div>

              <div className="grid grid-cols-3 gap-4 mb-4">
                <div className="bg-gray-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-gray-900">{campaign.totalContacts}</div>
                  <div className="text-sm text-gray-600">Total Contacts</div>
                </div>
                <div className="bg-blue-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-blue-900">{campaign.pendingCount}</div>
                  <div className="text-sm text-blue-600">Pending</div>
                </div>
                <div className="bg-green-50 rounded-lg p-4">
                  <div className="text-2xl font-semibold text-green-900">{campaign.calledCount}</div>
                  <div className="text-sm text-green-600">Called</div>
                </div>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => {
                    setSelectedCampaign(campaign);
                    setShowUploadModal(true);
                  }}
                  className="flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <Upload className="w-4 h-4" />
                  Upload Contacts
                </button>
                {campaign.pendingCount > 0 && (
                  <button
                    onClick={() => handleRunCampaign(campaign.id)}
                    className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
                  >
                    <Play className="w-4 h-4" />
                    Run Campaign
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      )}

      {showCreateModal && (
        <CreateCampaignModal onClose={() => setShowCreateModal(false)} />
      )}

      {showUploadModal && selectedCampaign && (
        <UploadContactsModal
          campaignId={selectedCampaign.id}
          onClose={() => {
            setShowUploadModal(false);
            setSelectedCampaign(null);
          }}
        />
      )}
    </div>
  );
};

export default CampaignsPage;
</file>

<file path="src/pages/ContactsPage.tsx">
import { useState, useEffect } from 'react';
import { Users, Search, Phone, Mail, Building2, FileText } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Contact, Campaign, CallLog, IntentLabel } from '../types';

interface ContactWithCampaign extends Contact {
  campaign_name?: string;
}

const ContactsPage = () => {
  const [contacts, setContacts] = useState<ContactWithCampaign[]>([]);
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  const [filterCampaign, setFilterCampaign] = useState<string>('all');
  const [filterStatus, setFilterStatus] = useState<string>('all');
  const [selectedContact, setSelectedContact] = useState<ContactWithCampaign | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData } = await supabase
        .from('campaigns')
        .select('*')
        .order('name');

      setCampaigns(campaignsData || []);

      // Fetch contacts with campaign names
      const { data: contactsData, error } = await supabase
        .from('contacts')
        .select(`
          *,
          campaigns!inner(name)
        `)
        .order('created_at', { ascending: false });

      if (error) throw error;

      // Transform data to include campaign_name
      const transformedContacts = (contactsData || []).map(contact => ({
        ...contact,
        campaign_name: (contact as any).campaigns?.name || 'Unknown'
      }));

      setContacts(transformedContacts);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const filteredContacts = contacts.filter(contact => {
    const matchesSearch = 
      contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (contact.company || '').toLowerCase().includes(searchQuery.toLowerCase()) ||
      contact.phone.includes(searchQuery);

    const matchesCampaign = filterCampaign === 'all' || contact.campaign_id === filterCampaign;
    const matchesStatus = filterStatus === 'all' || contact.status === filterStatus;

    return matchesSearch && matchesCampaign && matchesStatus;
  });

  // Calculate stats
  const stats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length,
    failed: contacts.filter(c => c.status === 'failed').length
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">Contacts</h1>
            <p className="text-gray-600">Master database of all contacts across campaigns</p>
          </div>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.total}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Called</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.called}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Pending</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.pending}</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-2">
            <div className="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-red-600" />
            </div>
            <span className="text-gray-600 text-sm">Failed</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{stats.failed}</p>
        </div>
      </div>

      {/* Filters */}
      <div className="mb-6 flex gap-4">
        <div className="flex-1 relative">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="Search by name, company, or phone..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
          />
        </div>

        <select
          value={filterCampaign}
          onChange={(e) => setFilterCampaign(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Campaigns</option>
          {campaigns.map(campaign => (
            <option key={campaign.id} value={campaign.id}>{campaign.name}</option>
          ))}
        </select>

        <select
          value={filterStatus}
          onChange={(e) => setFilterStatus(e.target.value)}
          className="px-4 py-3 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
        >
          <option value="all">All Status</option>
          <option value="pending">Pending</option>
          <option value="calling">Calling</option>
          <option value="completed">Completed</option>
          <option value="failed">Failed</option>
        </select>
      </div>

      {/* Contacts Table */}
      <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
        {loading ? (
          <div className="p-12 text-center text-gray-500">Loading contacts...</div>
        ) : filteredContacts.length === 0 ? (
          <div className="p-12 text-center">
            <Users className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <h3 className="text-lg font-medium text-gray-900 mb-2">No contacts found</h3>
            <p className="text-gray-500">
              {contacts.length === 0 
                ? 'Add contacts from the Campaigns page to get started'
                : 'Try adjusting your filters'
              }
            </p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b border-gray-200">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Contact</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Company</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Phone</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Campaign</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Status</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-gray-200">
                {filteredContacts.map(contact => (
                  <tr key={contact.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4">
                      <div className="font-medium text-gray-900">{contact.name}</div>
                      {contact.email && (
                        <div className="text-sm text-gray-500 flex items-center gap-1 mt-1">
                          <Mail className="w-3 h-3" />
                          {contact.email}
                        </div>
                      )}
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-2 text-gray-900">
                        <Building2 className="w-4 h-4 text-gray-400" />
                        {contact.company || '-'}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-gray-900">{contact.phone}</td>
                    <td className="px-6 py-4">
                      <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                        {contact.campaign_name}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                        contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                        contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {contact.status}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <button
                        onClick={() => setSelectedContact(contact)}
                        className="text-primary hover:underline text-sm font-medium"
                      >
                        View Details
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Contact Detail Modal */}
      {selectedContact && (
        <ContactDetailModal
          contact={selectedContact}
          onClose={() => setSelectedContact(null)}
        />
      )}
    </div>
  );
};

// Contact Detail Modal Component
const ContactDetailModal = ({ contact, onClose }: { contact: ContactWithCampaign; onClose: () => void }) => {
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchCallLogs();
  }, []);

  const fetchCallLogs = async () => {
    try {
      const { data, error } = await supabase
        .from('call_logs')
        .select('*')
        .eq('contact_id', contact.id)
        .order('call_date', { ascending: false });

      if (error) throw error;
      setCallLogs(data || []);
    } catch (err) {
      console.error('Error fetching call logs:', err);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div>
            <h2 className="text-2xl font-semibold text-gray-900">{contact.name}</h2>
            <p className="text-gray-600 mt-1">{contact.company}</p>
          </div>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <FileText className="w-6 h-6" />
          </button>
        </div>

        <div className="p-6">
          {/* Contact Info */}
          <div className="grid grid-cols-2 gap-6 mb-6">
            <div>
              <label className="text-sm font-medium text-gray-600">Phone</label>
              <p className="text-gray-900 mt-1">{contact.phone}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Email</label>
              <p className="text-gray-900 mt-1">{contact.email || '-'}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Campaign</label>
              <p className="text-gray-900 mt-1">{contact.campaign_name}</p>
            </div>
            <div>
              <label className="text-sm font-medium text-gray-600">Status</label>
              <p className="text-gray-900 mt-1">
                <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                  contact.status === 'completed' ? 'bg-green-100 text-green-800' :
                  contact.status === 'calling' ? 'bg-yellow-100 text-yellow-800' :
                  contact.status === 'failed' ? 'bg-red-100 text-red-800' :
                  'bg-blue-100 text-blue-800'
                }`}>
                  {contact.status}
                </span>
              </p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Profile Summary</label>
              <p className="text-gray-900 mt-1">{contact.profile_summary || 'No summary available'}</p>
            </div>
            <div className="col-span-2">
              <label className="text-sm font-medium text-gray-600">Pain Points</label>
              <div className="flex flex-wrap gap-2 mt-2">
                {contact.pain_points.length > 0 ? (
                  contact.pain_points.map((point, idx) => (
                    <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                      {point}
                    </span>
                  ))
                ) : (
                  <p className="text-gray-500 text-sm">No pain points identified</p>
                )}
              </div>
            </div>
          </div>

          {/* Call History */}
          <div>
            <h3 className="font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <Phone className="w-5 h-5" />
              Call History
            </h3>
            {loading ? (
              <p className="text-center py-8 text-gray-500 text-sm">Loading call history...</p>
            ) : callLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">No calls yet</p>
            ) : (
              <div className="space-y-4">
                {callLogs.map(log => (
                  <div key={log.id} className="border border-gray-200 rounded-lg p-4">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <p className="text-sm text-gray-500 mt-1">
                          {new Date(log.call_date).toLocaleString()}  {Math.floor(log.duration / 60)}m {log.duration % 60}s
                        </p>
                      </div>
                      <span className={`px-2.5 py-0.5 rounded-full text-xs font-medium ${
                        log.intent_label === 'positive' ? 'bg-green-100 text-green-800' :
                        log.intent_label === 'no-interest' ? 'bg-red-100 text-red-800' :
                        'bg-yellow-100 text-yellow-800'
                      }`}>
                        {log.intent_label}
                      </span>
                    </div>
                    <div className="mb-3">
                      <p className="text-sm font-medium text-gray-700 mb-1">AI Summary:</p>
                      <p className="text-sm text-gray-600">{log.ai_summary}</p>
                    </div>
                    <details className="text-sm">
                      <summary className="cursor-pointer text-primary hover:underline">View Transcript</summary>
                      <pre className="mt-2 p-3 bg-gray-50 rounded text-xs whitespace-pre-wrap">{log.transcript}</pre>
                    </details>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        <div className="p-6 border-t border-gray-200 flex justify-end">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
};

export default ContactsPage;
</file>

<file path="src/pages/CreateCampaignPage.tsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ArrowLeft } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP, CampaignStatus } from '../types';

const CreateCampaignPage = () => {
  const navigate = useNavigate();
  const [usps, setUsps] = useState<USP[]>([]);
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    call_window_start: '09:00',
    call_window_end: '17:00',
    timezone: 'PST',
    pause_between_calls: 60,
    selected_usps: [] as string[],
    status: 'active' as CampaignStatus
  });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    const { data } = await supabase
      .from('usps')
      .select('*')
      .order('title');
    
    setUsps(data || []);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          call_window_start: formData.call_window_start,
          call_window_end: formData.call_window_end,
          timezone: formData.timezone,
          pause_between_calls: formData.pause_between_calls,
          selected_usps: formData.selected_usps,
          status: formData.status
        }])
        .select()
        .single();

      if (error) throw error;

      // Navigate to the new campaign detail page
      navigate(`/campaigns/${data.id}`);
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Failed to create campaign');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div>
      <div className="mb-8">
        <button
          onClick={() => navigate('/campaigns')}
          className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4"
        >
          <ArrowLeft className="w-5 h-5" />
          Back to Campaigns
        </button>

        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Create New Campaign</h1>
        <p className="text-gray-600">Set up your AI calling campaign</p>
      </div>

      <div className="bg-white rounded-xl border border-gray-200 p-6 max-w-3xl">
        <form onSubmit={handleSubmit}>
          <div className="space-y-6">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Campaign Name <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.name}
                onChange={e => setFormData({ ...formData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Q1 Outreach"
              />
            </div>

            {/* Description */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
              <textarea
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={3}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Target enterprise customers in tech sector..."
              />
            </div>

            {/* Call Window */}
            <div className="grid grid-cols-3 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                <input
                  type="time"
                  value={formData.call_window_start}
                  onChange={e => setFormData({ ...formData, call_window_start: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                <input
                  type="time"
                  value={formData.call_window_end}
                  onChange={e => setFormData({ ...formData, call_window_end: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">Timezone</label>
                <select
                  value={formData.timezone}
                  onChange={e => setFormData({ ...formData, timezone: e.target.value })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                >
                  <option value="PST">PST</option>
                  <option value="MST">MST</option>
                  <option value="CST">CST</option>
                  <option value="EST">EST</option>
                  <option value="UTC">UTC</option>
                </select>
              </div>
            </div>

            {/* Pause Between Calls */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pause Between Calls (seconds)
              </label>
              <input
                type="number"
                min="0"
                value={formData.pause_between_calls}
                onChange={e => setFormData({ ...formData, pause_between_calls: parseInt(e.target.value) || 0 })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
              />
              <p className="text-xs text-gray-500 mt-1">Time to wait between each call attempt (default: 60 seconds)</p>
            </div>

            {/* USP Selection */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                Select USPs for this Campaign
              </label>
              {usps.length === 0 ? (
                <p className="text-sm text-gray-500">No USPs available. Create some in the USP Library first.</p>
              ) : (
                <div className="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-4">
                  {usps.map(usp => (
                    <label key={usp.id} className="flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded">
                      <input
                        type="checkbox"
                        checked={formData.selected_usps.includes(usp.id)}
                        onChange={e => {
                          if (e.target.checked) {
                            setFormData({ ...formData, selected_usps: [...formData.selected_usps, usp.id] });
                          } else {
                            setFormData({ ...formData, selected_usps: formData.selected_usps.filter(id => id !== usp.id) });
                          }
                        }}
                        className="mt-1"
                      />
                      <div>
                        <div className="font-medium text-gray-900 text-sm">{usp.title}</div>
                        <div className="text-xs text-gray-500">{usp.description}</div>
                      </div>
                    </label>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Footer */}
          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={() => navigate('/campaigns')}
              disabled={loading}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={loading}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {loading ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignPage;
</file>

<file path="src/pages/OverviewPage.tsx">
import { useState, useEffect } from 'react';
import { Phone, Users, TrendingUp, Calendar, Clock, CheckCircle } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact, CallLog } from '../types';

interface CampaignStats {
  total: number;
  active: number;
  paused: number;
  completed: number;
}

interface ContactStats {
  total: number;
  called: number;
  pending: number;
}

interface CallStats {
  total: number;
  positive: number;
  noInterest: number;
  followUp: number;
  conversionRate: number;
}

const OverviewPage = () => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [callLogs, setCallLogs] = useState<CallLog[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch all data in parallel
      const [campaignsRes, contactsRes, callLogsRes] = await Promise.all([
        supabase.from('campaigns').select('*').order('created_at', { ascending: false }),
        supabase.from('contacts').select('*'),
        supabase.from('call_logs').select('*').order('call_date', { ascending: false }).limit(5)
      ]);

      if (campaignsRes.error) throw campaignsRes.error;
      if (contactsRes.error) throw contactsRes.error;
      if (callLogsRes.error) throw callLogsRes.error;

      setCampaigns(campaignsRes.data || []);
      setContacts(contactsRes.data || []);
      setCallLogs(callLogsRes.data || []);
    } catch (err) {
      console.error('Error fetching overview data:', err);
    } finally {
      setLoading(false);
    }
  };

  // Calculate campaign stats
  const campaignStats: CampaignStats = {
    total: campaigns.length,
    active: campaigns.filter(c => c.status === 'active').length,
    paused: campaigns.filter(c => c.status === 'paused').length,
    completed: campaigns.filter(c => c.status === 'completed').length
  };

  // Calculate contact stats
  const contactStats: ContactStats = {
    total: contacts.length,
    called: contacts.filter(c => c.status === 'completed').length,
    pending: contacts.filter(c => c.status === 'pending').length
  };

  // Calculate call stats
  const allCallLogs = callLogs;
  const callStats: CallStats = {
    total: allCallLogs.length,
    positive: allCallLogs.filter(log => log.intent_label === 'positive').length,
    noInterest: allCallLogs.filter(log => log.intent_label === 'no-interest').length,
    followUp: allCallLogs.filter(log => log.intent_label === 'follow-up').length,
    conversionRate: allCallLogs.length > 0 
      ? Math.round((allCallLogs.filter(log => log.intent_label === 'positive').length / allCallLogs.length) * 100)
      : 0
  };

  // Intent distribution
  const intentCounts = {
    positive: callStats.positive,
    'no-interest': callStats.noInterest,
    'follow-up': callStats.followUp
  };

  const getIntentColor = (intent: string) => {
    switch (intent) {
      case 'positive': return 'text-green-600 bg-green-100';
      case 'no-interest': return 'text-red-600 bg-red-100';
      case 'follow-up': return 'text-yellow-600 bg-yellow-100';
      default: return 'text-gray-600 bg-gray-100';
    }
  };

  const getIntentLabel = (intent: string) => {
    switch (intent) {
      case 'positive': return 'Positive';
      case 'no-interest': return 'No Interest';
      case 'follow-up': return 'Follow-up';
      default: return intent;
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-gray-500">Loading overview...</div>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h1 className="text-3xl font-semibold text-gray-900 mb-2">Overview</h1>
        <p className="text-gray-600">Real-time performance metrics and activity</p>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-blue-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Campaigns</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{campaignStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{campaignStats.active} active</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
              <Users className="w-5 h-5 text-purple-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Contacts</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{contactStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{contactStats.called} contacted</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
              <Phone className="w-5 h-5 text-green-600" />
            </div>
            <span className="text-gray-600 text-sm">Total Calls</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.total}</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.positive} positive</p>
        </div>

        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
              <TrendingUp className="w-5 h-5 text-primary" />
            </div>
            <span className="text-gray-600 text-sm">Conversion Rate</span>
          </div>
          <p className="text-3xl font-semibold text-gray-900">{callStats.conversionRate}%</p>
          <p className="text-sm text-gray-500 mt-2">{callStats.followUp} follow-ups</p>
        </div>
      </div>

      <div className="grid grid-cols-3 gap-6 mb-8">
        {/* Intent Distribution */}
        <div className="bg-white rounded-xl border border-gray-200 p-6">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Intent Distribution
          </h3>
          {callStats.total === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No calls yet</p>
          ) : (
            <div className="space-y-4">
              {/* Positive */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Positive</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts.positive} ({Math.round((intentCounts.positive / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-green-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts.positive / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* No Interest */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">No Interest</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['no-interest']} ({Math.round((intentCounts['no-interest'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-red-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['no-interest'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>

              {/* Follow-up */}
              <div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm font-medium text-gray-700">Follow-up</span>
                  <span className="text-sm font-semibold text-gray-900">
                    {intentCounts['follow-up']} ({Math.round((intentCounts['follow-up'] / callStats.total) * 100)}%)
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-yellow-500 h-2 rounded-full transition-all"
                    style={{ width: `${(intentCounts['follow-up'] / callStats.total) * 100}%` }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Campaign Status */}
        <div className="bg-white rounded-xl border border-gray-200 p-6 col-span-2">
          <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <Calendar className="w-5 h-5" />
            Campaigns Overview
          </h3>
          {campaigns.length === 0 ? (
            <p className="text-center py-8 text-gray-500 text-sm">No campaigns yet</p>
          ) : (
            <div className="space-y-3">
              {campaigns.slice(0, 5).map(campaign => (
                <div key={campaign.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div className="flex-1">
                    <h4 className="font-medium text-gray-900">{campaign.name}</h4>
                    <p className="text-xs text-gray-500 mt-1">
                      {campaign.call_window_start} - {campaign.call_window_end} {campaign.timezone}
                    </p>
                  </div>
                  <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                    campaign.status === 'active' ? 'bg-green-100 text-green-800' :
                    campaign.status === 'paused' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-gray-100 text-gray-800'
                  }`}>
                    {campaign.status}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* Recent Activity */}
      <div className="bg-white rounded-xl border border-gray-200 p-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
          <Clock className="w-5 h-5" />
          Recent Activity
        </h3>
        {callLogs.length === 0 ? (
          <div className="text-center py-12">
            <Phone className="w-12 h-12 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">No activity yet</p>
            <p className="text-sm text-gray-400 mt-2">Start a campaign to see call activity here</p>
          </div>
        ) : (
          <div className="space-y-4">
            {callLogs.map(call => {
              const contact = contacts.find(c => c.id === call.contact_id);
              return (
                <div key={call.id} className="flex items-start gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${
                    call.intent_label === 'positive' ? 'bg-green-100' :
                    call.intent_label === 'no-interest' ? 'bg-red-100' : 'bg-yellow-100'
                  }`}>
                    {call.intent_label === 'positive' ? (
                      <CheckCircle className="w-5 h-5 text-green-600" />
                    ) : (
                      <Phone className="w-5 h-5 text-gray-600" />
                    )}
                  </div>
                  
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2 mb-1">
                      <p className="font-medium text-gray-900">{contact?.name || 'Unknown Contact'}</p>
                      <span className={`px-2 py-0.5 rounded-full text-xs font-medium ${getIntentColor(call.intent_label)}`}>
                        {getIntentLabel(call.intent_label)}
                      </span>
                    </div>
                    <p className="text-sm text-gray-600 mb-1">{call.ai_summary}</p>
                    <div className="flex items-center gap-4 text-xs text-gray-500">
                      <span>{new Date(call.call_date).toLocaleString()}</span>
                      <span></span>
                      <span>{Math.floor(call.duration / 60)}m {call.duration % 60}s</span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </div>
    </div>
  );
};

export default OverviewPage;
</file>

<file path="src/pages/USPLibraryPage.tsx">
import { useState, useEffect } from 'react';
import { Plus, Lightbulb, Edit2, Trash2, X } from 'lucide-react';
import { supabase } from '../lib/supabase';
import type { USP } from '../types';

const USPLibraryPage = () => {
  const [usps, setUsps] = useState<USP[]>([]);
  const [loading, setLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingUSP, setEditingUSP] = useState<USP | null>(null);

  useEffect(() => {
    fetchUSPs();
  }, []);

  const fetchUSPs = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('usps')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) throw error;
      setUsps(data || []);
    } catch (err) {
      console.error('Error fetching USPs:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleEdit = (usp: USP) => {
    setEditingUSP(usp);
    setShowModal(true);
  };

  const handleDelete = async (id: string) => {
    if (!window.confirm('Delete this USP? This action cannot be undone.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('usps')
        .delete()
        .eq('id', id);

      if (error) throw error;
      await fetchUSPs();
    } catch (err) {
      console.error('Error deleting USP:', err);
      alert('Failed to delete USP');
    }
  };

  return (
    <div>
      <div className="mb-8">
        <div className="flex items-center justify-between mb-4">
          <div>
            <h1 className="text-3xl font-semibold text-gray-900 mb-2">USP Library</h1>
            <p className="text-gray-600">Manage your Unique Selling Propositions for AI to use during calls</p>
          </div>
          <button
            onClick={() => {
              setEditingUSP(null);
              setShowModal(true);
            }}
            className="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add USP
          </button>
        </div>
      </div>

      {loading ? (
        <div className="text-center py-12 text-gray-500">Loading USPs...</div>
      ) : usps.length === 0 ? (
        <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
          <Lightbulb className="w-12 h-12 text-gray-300 mx-auto mb-4" />
          <h3 className="text-lg font-medium text-gray-900 mb-2">No USPs yet</h3>
          <p className="text-gray-500 mb-6">Create your first USP to help AI map solutions to prospect pain points</p>
          <button
            onClick={() => setShowModal(true)}
            className="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
          >
            <Plus className="w-5 h-5" />
            Add Your First USP
          </button>
        </div>
      ) : (
        <div className="grid gap-6">
          {usps.map(usp => (
            <div key={usp.id} className="bg-white rounded-xl border border-gray-200 p-6">
              <div className="flex items-start justify-between mb-4">
                <div className="flex-1">
                  <div className="flex items-center gap-3 mb-2">
                    <div className="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                      <Lightbulb className="w-5 h-5 text-yellow-600" />
                    </div>
                    <h3 className="text-xl font-semibold text-gray-900">{usp.title}</h3>
                  </div>
                  <p className="text-gray-600 mb-4">{usp.description}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {usp.pain_point_tags.map((tag, idx) => (
                      <span key={idx} className="px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>

                  <div className="text-sm text-gray-500">
                    Used in {usp.usage_count} campaigns
                  </div>
                </div>

                <div className="flex gap-2">
                  <button
                    onClick={() => handleEdit(usp)}
                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                  >
                    <Edit2 className="w-5 h-5" />
                  </button>
                  <button
                    onClick={() => handleDelete(usp.id)}
                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                  >
                    <Trash2 className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          ))}
        </div>
      )}

      {showModal && (
        <USPModal
          usp={editingUSP}
          onClose={() => {
            setShowModal(false);
            setEditingUSP(null);
          }}
          onSuccess={fetchUSPs}
        />
      )}
    </div>
  );
};

// USP Modal Component
const USPModal = ({ 
  usp, 
  onClose, 
  onSuccess 
}: { 
  usp: USP | null; 
  onClose: () => void; 
  onSuccess: () => void;
}) => {
  const [formData, setFormData] = useState({
    title: usp?.title || '',
    description: usp?.description || '',
    pain_point_tags: usp?.pain_point_tags || [] as string[]
  });
  const [tagInput, setTagInput] = useState('');
  const [saving, setSaving] = useState(false);

  const handleAddTag = () => {
    if (tagInput.trim() && !formData.pain_point_tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        pain_point_tags: [...formData.pain_point_tags, tagInput.trim()]
      });
      setTagInput('');
    }
  };

  const handleRemoveTag = (tag: string) => {
    setFormData({
      ...formData,
      pain_point_tags: formData.pain_point_tags.filter(t => t !== tag)
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setSaving(true);

    try {
      if (usp) {
        // Update existing
        const { error } = await supabase
          .from('usps')
          .update({
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          })
          .eq('id', usp.id);

        if (error) throw error;
      } else {
        // Create new
        const { error } = await supabase
          .from('usps')
          .insert([{
            title: formData.title,
            description: formData.description,
            pain_point_tags: formData.pain_point_tags
          }]);

        if (error) throw error;
      }

      onSuccess();
      onClose();
    } catch (err) {
      console.error('Error saving USP:', err);
      alert('Failed to save USP');
    } finally {
      setSaving(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">
            {usp ? 'Edit USP' : 'Add USP'}
          </h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Title <span className="text-red-500">*</span>
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={e => setFormData({ ...formData, title: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="24/7 Customer Support"
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Description <span className="text-red-500">*</span>
              </label>
              <textarea
                required
                value={formData.description}
                onChange={e => setFormData({ ...formData, description: e.target.value })}
                rows={4}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                placeholder="Our support team is available around the clock to help with any issues..."
              />
            </div>

            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Pain Point Tags
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="text"
                  value={tagInput}
                  onChange={e => setTagInput(e.target.value)}
                  onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddTag())}
                  className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
                  placeholder="e.g., poor support, downtime issues"
                />
                <button
                  type="button"
                  onClick={handleAddTag}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                >
                  Add
                </button>
              </div>
              <div className="flex flex-wrap gap-2">
                {formData.pain_point_tags.map(tag => (
                  <span 
                    key={tag}
                    className="inline-flex items-center gap-1 px-3 py-1 bg-red-100 text-red-700 text-sm rounded-full"
                  >
                    {tag}
                    <button
                      type="button"
                      onClick={() => handleRemoveTag(tag)}
                      className="hover:text-red-900"
                    >
                      <X className="w-3 h-3" />
                    </button>
                  </span>
                ))}
              </div>
            </div>
          </div>

          <div className="flex items-center justify-end gap-3 mt-8 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              disabled={saving}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={saving}
              className="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50"
            >
              {saving ? 'Saving...' : usp ? 'Update USP' : 'Add USP'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default USPLibraryPage;
</file>

<file path="src/types/index.ts">
export type CampaignStatus = 'active' | 'paused' | 'completed';
export type ContactStatus = 'pending' | 'calling' | 'completed' | 'failed';
export type IntentLabel = 'positive' | 'no-interest' | 'follow-up';

export interface Campaign {
  id: string;
  name: string;
  description: string | null;
  status: CampaignStatus;
  call_window_start: string;
  call_window_end: string;
  timezone: string;
  pause_between_calls: number;
  selected_usps: string[];
  created_at: string;
  updated_at: string;
}

export interface USP {
  id: string;
  title: string;
  description: string;
  pain_point_tags: string[];
  usage_count: number;
  created_at: string;
  updated_at: string;
}

export interface Contact {
  id: string;
  campaign_id: string;
  name: string;
  phone: string;
  company: string | null;
  email: string | null;
  profile_summary: string | null;
  pain_points: string[];
  status: ContactStatus;
  created_at: string;
  updated_at: string;
}

export interface CallLog {
  id: string;
  contact_id: string;
  campaign_id: string;
  call_date: string;
  duration: number;
  transcript: string;
  recording_url: string;
  ai_summary: string;
  intent_label: IntentLabel;
  pain_points_discussed: string[];
  usps_used: string[];
  created_at: string;
}

// Extended types for joins
export interface ContactWithCampaign extends Contact {
  campaign?: Campaign;
}

export interface CampaignWithStats extends Campaign {
  total_contacts?: number;
  pending_contacts?: number;
  completed_contacts?: number;
  positive_calls?: number;
}
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.tsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import Layout from './components/layout/Layout';
import OverviewPage from './pages/OverviewPage';
import CampaignsListPage from './pages/CampaignsListPage';
import CampaignDetailPage from './pages/CampaignDetailPage';
import CreateCampaignPage from './pages/CreateCampaignPage';
import ContactsPage from './pages/ContactsPage';
import USPLibraryPage from './pages/USPLibraryPage';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Layout />}>
          <Route index element={<Navigate to="/overview" replace />} />
          <Route path="overview" element={<OverviewPage />} />
          <Route path="campaigns" element={<CampaignsListPage />} />
          <Route path="campaigns/new" element={<CreateCampaignPage />} />
          <Route path="campaigns/:id" element={<CampaignDetailPage />} />
          <Route path="contacts" element={<ContactsPage />} />
          <Route path="usps" element={<USPLibraryPage />} />
        </Route>
      </Routes>
    </BrowserRouter>
  );
}

export default App;
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: #fafafa;
}
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

dbpass: yOeSKEFzrE5tCMyW
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

</files>
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-call-agent</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-call-agent",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.91.0",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.17",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.4.33",
    "tailwindcss": "^3.4.1",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.46.4",
    "vite": "^7.2.4"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: '#352654',
        'primary-light': '#4a3870',
        'primary-dark': '#2a1d42',
      },
    },
  },
  plugins: [],
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "types": ["vite/client"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src"]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vercel.json">
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "framework": "vite",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="src/contexts/DataContext.tsx">
import { createContext, useState, useEffect } from 'react';
import type { ReactNode } from 'react';
import { supabase } from '../lib/supabase';
import type { Campaign, Contact } from '../types';

interface DataContextType {
  campaigns: Campaign[];
  contacts: Contact[];
  loading: boolean;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'created_at' | 'updated_at'>) => Promise<void>;
  updateCampaign: (id: string, updates: Partial<Campaign>) => Promise<void>;
  deleteCampaign: (id: string) => Promise<void>;
  addContact: (contact: Omit<Contact, 'id' | 'created_at' | 'updated_at'>) => Promise<Contact | null>;
  updateContact: (id: string, updates: Partial<Contact>) => Promise<void>;
  deleteContact: (id: string) => Promise<void>;
  addContactToCampaign: (campaignId: string, contactId: string) => Promise<void>;
  removeContactFromCampaign: (campaignContactId: string) => Promise<void>;
  fetchData: () => Promise<void>;
}

export const DataContext = createContext<DataContextType | null>(null);

interface DataProviderProps {
  children: ReactNode;
}

export const DataProvider = ({ children }: DataProviderProps) => {
  const [campaigns, setCampaigns] = useState<Campaign[]>([]);
  const [contacts, setContacts] = useState<Contact[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    try {
      setLoading(true);

      // Fetch campaigns
      const { data: campaignsData, error: campaignsError } = await supabase
        .from('campaigns')
        .select('*')
        .order('created_at', { ascending: false });

      if (campaignsError) throw campaignsError;
      setCampaigns(campaignsData || []);

      // Fetch contacts
      const { data: contactsData, error: contactsError } = await supabase
        .from('contacts')
        .select('*')
        .order('name');

      if (contactsError) throw contactsError;
      setContacts(contactsData || []);
    } catch (err) {
      console.error('Error fetching data:', err);
    } finally {
      setLoading(false);
    }
  };

  const addCampaign = async (campaign: Omit<Campaign, 'id' | 'created_at' | 'updated_at'>) => {
    try {
      const { data, error } = await supabase
        .from('campaigns')
        .insert([campaign])
        .select()
        .single();

      if (error) throw error;
      if (data) {
        setCampaigns([data, ...campaigns]);
      }
    } catch (err) {
      console.error('Error adding campaign:', err);
      throw err;
    }
  };

  const updateCampaign = async (id: string, updates: Partial<Campaign>) => {
    try {
      const { error } = await supabase
        .from('campaigns')
        .update(updates)
        .eq('id', id);

      if (error) throw error;
      
      setCampaigns(campaigns.map(c => c.id === id ? { ...c, ...updates } : c));
    } catch (err) {
      console.error('Error updating campaign:', err);
      throw err;
    }
  };

  const deleteCampaign = async (id: string) => {
    try {
      const { error } = await supabase
        .from('campaigns')
        .delete()
        .eq('id', id);

      if (error) throw error;
      
      setCampaigns(campaigns.filter(c => c.id !== id));
    } catch (err) {
      console.error('Error deleting campaign:', err);
      throw err;
    }
  };

  const addContact = async (contact: Omit<Contact, 'id' | 'created_at' | 'updated_at'>): Promise<Contact | null> => {
    try {
      const { data, error } = await supabase
        .from('contacts')
        .insert([contact])
        .select()
        .single();

      if (error) throw error;
      
      if (data) {
        setContacts([data, ...contacts]);
        return data;
      }
      return null;
    } catch (err) {
      console.error('Error adding contact:', err);
      throw err;
    }
  };

  const updateContact = async (id: string, updates: Partial<Contact>) => {
    try {
      const { error } = await supabase
        .from('contacts')
        .update(updates)
        .eq('id', id);

      if (error) throw error;
      
      setContacts(contacts.map(c => c.id === id ? { ...c, ...updates } : c));
    } catch (err) {
      console.error('Error updating contact:', err);
      throw err;
    }
  };

  const deleteContact = async (id: string) => {
    try {
      const { error } = await supabase
        .from('contacts')
        .delete()
        .eq('id', id);

      if (error) throw error;
      
      setContacts(contacts.filter(c => c.id !== id));
    } catch (err) {
      console.error('Error deleting contact:', err);
      throw err;
    }
  };

  const addContactToCampaign = async (campaignId: string, contactId: string) => {
    try {
      const { error } = await supabase
        .from('campaign_contacts')
        .insert([{
          campaign_id: campaignId,
          contact_id: contactId,
          status: 'pending'
        }]);

      if (error) throw error;
    } catch (err) {
      console.error('Error adding contact to campaign:', err);
      throw err;
    }
  };

  const removeContactFromCampaign = async (campaignContactId: string) => {
    try {
      const { error } = await supabase
        .from('campaign_contacts')
        .delete()
        .eq('id', campaignContactId);

      if (error) throw error;
    } catch (err) {
      console.error('Error removing contact from campaign:', err);
      throw err;
    }
  };

  const value: DataContextType = {
    campaigns,
    contacts,
    loading,
    addCampaign,
    updateCampaign,
    deleteCampaign,
    addContact,
    updateContact,
    deleteContact,
    addContactToCampaign,
    removeContactFromCampaign,
    fetchData
  };

  return (
    <DataContext.Provider value={value}>
      {children}
    </DataContext.Provider>
  );
};

export default DataProvider;
</file>

<file path="src/contexts/DataContextDefinition.ts">
import { createContext } from 'react';
import type { Campaign, Contact } from '../types';

export interface DataContextType {
  campaigns: Campaign[];
  contacts: Contact[];
  loading: boolean;
  addCampaign: (campaign: Omit<Campaign, 'id' | 'created_at' | 'updated_at'>) => Promise<void>;
  updateCampaign: (id: string, updates: Partial<Campaign>) => Promise<void>;
  deleteCampaign: (id: string) => Promise<void>;
  addContact: (contact: Omit<Contact, 'id' | 'created_at' | 'updated_at'>) => Promise<Contact | null>;
  updateContact: (id: string, updates: Partial<Contact>) => Promise<void>;
  deleteContact: (id: string) => Promise<void>;
  addContactToCampaign: (campaignId: string, contactId: string) => Promise<void>;
  removeContactFromCampaign: (campaignContactId: string) => Promise<void>;
  fetchData: () => Promise<void>;
}

export const DataContext = createContext<DataContextType | null>(null);
</file>

<file path="src/components/common/CreateCampaignModal.tsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { X } from 'lucide-react';
import { supabase } from '../../lib/supabase';
import type { CampaignStatus } from '../../types';

interface CreateCampaignModalProps {
  onClose: () => void;
}

const CreateCampaignModal = ({ onClose }: CreateCampaignModalProps) => {
  const navigate = useNavigate();
  const [formData, setFormData] = useState({
    name: '',
    description: '',
    status: 'active' as CampaignStatus,
    startTime: '09:00',
    endTime: '17:00',
    timezone: 'PST',
    pauseBetweenCalls: 30,
    selectedUSPs: [] as string[]
  });
  const [creating, setCreating] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!formData.name) {
      alert('Campaign name is required');
      return;
    }

    try {
      setCreating(true);

      const { data, error } = await supabase
        .from('campaigns')
        .insert([{
          name: formData.name,
          description: formData.description || null,
          status: formData.status,
          call_window_start: formData.startTime,
          call_window_end: formData.endTime,
          timezone: formData.timezone,
          pause_between_calls: formData.pauseBetweenCalls,
          selected_usps: formData.selectedUSPs,
          total_contacts: 0,
          called_count: 0,
          pending_count: 0
        }])
        .select()
        .single();

      if (error) throw error;

      if (data) {
        // Navigate to the new campaign detail page
        navigate(`/campaigns/${data.id}`);
      }
    } catch (err) {
      console.error('Error creating campaign:', err);
      alert('Error creating campaign. Please try again.');
    } finally {
      setCreating(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Create New Campaign</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6 space-y-6">
          {/* Basic Information */}
          <div>
            <h3 className="text-lg font-semibold text-gray-900 mb-4">Basic Information</h3>
            
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Campaign Name *
                </label>
                <input
                  type="text"
                  value={formData.name}
                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                  placeholder="Q1 Outreach Campaign"
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Description
                </label>
                <textarea
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  placeholder="Brief description of campaign goals..."
                  rows={3}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Status
                </label>
                <select
                  value={formData.status}
                  onChange={(e) => setFormData({ ...formData, status: e.target.value as CampaignStatus })}
                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                >
                  <option value="active">Active</option>
                  <option value="paused">Paused</option>
                  <option value="completed">Completed</option>
                </select>
              </div>
            </div>
          </div>

          {/* Call Settings */}
          <div>
            <h3 className="text-lg font-semibold text-gray-900 mb-4">Call Settings</h3>
            
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Start Time
                  </label>
                  <input
                    type="time"
                    value={formData.startTime}
                    onChange={(e) => setFormData({ ...formData, startTime: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    End Time
                  </label>
                  <input
                    type="time"
                    value={formData.endTime}
                    onChange={(e) => setFormData({ ...formData, endTime: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Timezone
                  </label>
                  <select
                    value={formData.timezone}
                    onChange={(e) => setFormData({ ...formData, timezone: e.target.value })}
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                  >
                    <option value="PST">PST</option>
                    <option value="MST">MST</option>
                    <option value="CST">CST</option>
                    <option value="EST">EST</option>
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">
                    Pause Between Calls (seconds)
                  </label>
                  <input
                    type="number"
                    value={formData.pauseBetweenCalls}
                    onChange={(e) => setFormData({ ...formData, pauseBetweenCalls: parseInt(e.target.value) })}
                    min="0"
                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
                  />
                </div>
              </div>
            </div>
          </div>

          {/* Action Buttons */}
          <div className="flex gap-3 pt-4 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={creating}
              className="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {creating ? 'Creating...' : 'Create Campaign'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default CreateCampaignModal;
</file>

<file path="src/components/common/UploadContactsModal.tsx">
import { useState } from 'react';
import { X, Upload, AlertCircle } from 'lucide-react';
import { useData } from '../../hooks/useData';

interface UploadContactsModalProps {
  campaignId: string;
  onClose: () => void;
}

const UploadContactsModal = ({ campaignId, onClose }: UploadContactsModalProps) => {
  const { addContacts } = useData();
  const [csvText, setCsvText] = useState('');
  const [error, setError] = useState('');

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target?.result as string;
      setCsvText(text);
    };
    reader.readAsText(file);
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    try {
      const lines = csvText.trim().split('\n');
      if (lines.length < 2) {
        setError('CSV must have at least a header row and one data row');
        return;
      }

      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      
      const requiredFields = ['name', 'phone'];
      const missingFields = requiredFields.filter(field => !headers.includes(field));
      if (missingFields.length > 0) {
        setError(`Missing required fields: ${missingFields.join(', ')}`);
        return;
      }

      const contacts = lines.slice(1).map(line => {
        const values = line.split(',').map(v => v.trim());
        const contactData: Record<string, string> = {};
        
        headers.forEach((header, index) => {
          contactData[header] = values[index] || '';
        });

        const painPoints = contactData.painpoints || contactData['pain points'] || '';
        const painPointsArray = painPoints ? painPoints.split(';').map(p => p.trim()) : [];

        return {
          name: contactData.name,
          phone: contactData.phone,
          company: contactData.company || '',
          email: contactData.email || '',
          profile_summary: contactData.profilesummary || contactData['profile summary'] || '',
          pain_points: painPointsArray,
          status: 'pending' as const,
          campaign_id: campaignId,
          created_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        };
      });

      addContacts(contacts, campaignId);
      onClose();
    } catch (err) {
      console.error('CSV parsing error:', err);
      setError('Failed to parse CSV. Please check the format.');
    }
  };

  const downloadTemplate = () => {
    const template = 'name,phone,company,email,profileSummary,painPoints\nJohn Doe,555-1234,Acme Corp,john@acme.com,VP of Sales,slow support;high costs\nJane Smith,555-5678,Tech Inc,jane@tech.com,CTO,downtime issues;poor integration';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contact-template.csv';
    a.click();
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <h2 className="text-2xl font-semibold text-gray-900">Upload Contacts</h2>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
            <X className="w-6 h-6" />
          </button>
        </div>

        <form onSubmit={handleSubmit} className="p-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <label className="block text-sm font-medium text-gray-700">
                Upload CSV File
              </label>
              <button
                type="button"
                onClick={downloadTemplate}
                className="text-sm text-primary hover:underline"
              >
                Download Template
              </button>
            </div>
            
            <input
              type="file"
              accept=".csv"
              onChange={handleFileUpload}
              className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary"
            />
            
            <p className="mt-2 text-xs text-gray-500">
              Required columns: name, phone. Optional: company, email, profileSummary, painPoints (use semicolon to separate multiple pain points)
            </p>
          </div>

          {csvText && (
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                CSV Preview
              </label>
              <textarea
                value={csvText.split('\n').slice(0, 6).join('\n')}
                readOnly
                rows={6}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono"
              />
              <p className="mt-1 text-xs text-gray-500">
                Showing first 5 rows
              </p>
            </div>
          )}

          {error && (
            <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg flex items-start gap-3">
              <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="text-sm font-medium text-red-800">Error</p>
                <p className="text-sm text-red-600 mt-1">{error}</p>
              </div>
            </div>
          )}

          <div className="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
            <button
              type="button"
              onClick={onClose}
              className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={!csvText}
              className="flex items-center gap-2 px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <Upload className="w-4 h-4" />
              Upload Contacts
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default UploadContactsModal;
</file>

</files>
